{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø³Ù† -->
    <div class="mb-8">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div class="flex items-center space-x-4 space-x-reverse">
                <div class="p-3 bg-blue-100 dark:bg-blue-900 rounded-lg">
                    <i class="fas fa-tasks text-2xl text-blue-600 dark:text-blue-400"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white">ğŸ“‹ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ</h1>
                    <p class="text-gray-600 dark:text-gray-300 mt-2">
                        Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙŠØ¯ÙˆÙŠØ§Ù‹
                        <span class="text-blue-600 dark:text-blue-400 font-medium" id="tasks-live-time"></span>
                    </p>
                </div>
            </div>
            <div class="mt-4 md:mt-0 flex flex-col sm:flex-row gap-3">
                <button onclick="generateAutoTasks()" class="btn-primary flex items-center justify-center gap-2" id="generate-tasks-btn">
                    <i class="fas fa-robot"></i>
                    ØªÙˆÙ„ÙŠØ¯ Ù…Ù‡Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
                    <span id="new-tasks-count" class="hidden bg-white text-blue-600 text-xs px-2 py-1 rounded-full"></span>
                </button>
                <button onclick="createAdminTask()" class="btn-warning flex items-center justify-center gap-2">
                    <i class="fas fa-user-shield"></i>
                    Ù…Ù‡Ù…Ø© Ø£Ø¯Ù…Ù† Ø¬Ø¯ÙŠØ¯Ø©
                </button>
                <button onclick="showAddTaskModal()" class="btn-success flex items-center justify-center gap-2">
                    <i class="fas fa-plus"></i>
                    Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
                <button onclick="refreshTasks()" class="btn-secondary flex items-center justify-center gap-2">
                    <i class="fas fa-sync-alt"></i>
                    ØªØ­Ø¯ÙŠØ«
                </button>
                <button onclick="archiveCompletedTasks()" class="btn-info flex items-center justify-center gap-2">
                    <i class="fas fa-archive"></i>
                    Ø£Ø±Ø´ÙØ© Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
                </button>
            </div>
        </div>
    </div>

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© Ù…Ø­Ø³Ù†Ø© -->
    <div class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-6">
        <div class="card p-4 text-center hover:shadow-lg transition-shadow cursor-pointer" onclick="filterByStatus('all')">
            <div class="text-2xl font-bold text-gray-700 dark:text-gray-300">{{ stats.total }}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…</div>
        </div>
        <div class="card p-4 text-center hover:shadow-lg transition-shadow cursor-pointer" onclick="filterByStatus('pending')">
            <div class="text-2xl font-bold text-orange-600">{{ stats.pending }}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
        </div>
        <div class="card p-4 text-center hover:shadow-lg transition-shadow cursor-pointer" onclick="filterByPriority('high,critical')">
            <div class="text-2xl font-bold text-red-600">{{ stats.urgent }}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Ø¹Ø§Ø¬Ù„Ø©</div>
        </div>
        <div class="card p-4 text-center hover:shadow-lg transition-shadow cursor-pointer" onclick="filterByStatus('in_progress')">
            <div class="text-2xl font-bold text-blue-600">{{ stats.in_progress }}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</div>
        </div>
        <div class="card p-4 text-center hover:shadow-lg transition-shadow cursor-pointer" onclick="filterByStatus('completed')">
            <div class="text-2xl font-bold text-green-600">{{ stats.completed }}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Ù…ÙƒØªÙ…Ù„Ø©</div>
        </div>
        <div class="card p-4 text-center hover:shadow-lg transition-shadow cursor-pointer" onclick="filterByStatus('waiting_approval')">
            <div class="text-2xl font-bold text-yellow-600">{{ stats.waiting_approval }}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø©</div>
        </div>
    </div>

    <!-- ÙÙ„ØªØ±Ø© Ù…ØªÙ‚Ø¯Ù…Ø© -->
    <div class="card p-4 mb-6">
        <div class="flex flex-col lg:flex-row gap-4">
            <!-- ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© -->
            <div class="flex-1">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    <i class="fas fa-filter ml-1"></i>
                    Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø©
                </label>
                <select id="status-filter" onchange="filterTasks()" class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="all" {% if status_filter == 'all' %}selected{% endif %}>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                    <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                    <option value="in_progress" {% if status_filter == 'in_progress' %}selected{% endif %}>Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                    <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Ù…ÙƒØªÙ…Ù„Ø©</option>
                    <option value="suspended" {% if status_filter == 'suspended' %}selected{% endif %}>Ù…Ø¹Ù„Ù‚Ø©</option>
                    <option value="waiting_approval" {% if waiting_approval %}selected{% endif %}>Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</option>
                </select>
            </div>

            <!-- ÙÙ„ØªØ± Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© -->
            <div class="flex-1">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    <i class="fas fa-exclamation-circle ml-1"></i>
                    Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
                </label>
                <select id="priority-filter" onchange="filterTasks()" class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª</option>
                    <option value="low" {% if priority_filter == 'low' %}selected{% endif %}>Ù…Ù†Ø®ÙØ¶Ø©</option>
                    <option value="medium" {% if priority_filter == 'medium' %}selected{% endif %}>Ù…ØªÙˆØ³Ø·Ø©</option>
                    <option value="high" {% if priority_filter == 'high' %}selected{% endif %}>Ø¹Ø§Ù„ÙŠØ©</option>
                    <option value="critical" {% if priority_filter == 'critical' %}selected{% endif %}>Ø­Ø±Ø¬Ø©</option>
                </select>
            </div>

            <!-- ÙÙ„ØªØ± Ø§Ù„Ù†ÙˆØ¹ -->
            <div class="flex-1">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    <i class="fas fa-tag ml-1"></i>
                    Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©
                </label>
                <select id="type-filter" onchange="filterTasks()" class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                    <option value="debt" {% if task_type_filter == 'debt' %}selected{% endif %}>Ø¯ÙŠÙˆÙ†</option>
                    <option value="order" {% if task_type_filter == 'order' %}selected{% endif %}>Ø·Ù„Ø¨ÙŠØ§Øª</option>
                    <option value="worker" {% if task_type_filter == 'worker' %}selected{% endif %}>Ø¹Ù…Ø§Ù„</option>
                    <option value="expense" {% if task_type_filter == 'expense' %}selected{% endif %}>Ù…ØµØ§Ø±ÙŠÙ</option>
                    <option value="system" {% if task_type_filter == 'system' %}selected{% endif %}>Ù†Ø¸Ø§Ù…</option>
                    <option value="general" {% if task_type_filter == 'general' %}selected{% endif %}>Ø¹Ø§Ù…</option>
                </select>
            </div>

            <div class="flex-1">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    <i class="fas fa-layer-group ml-1"></i>
                    Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ù‡Ù…Ø©
                </label>
                <select id="scope-filter" onchange="filterTasks()" class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª</option>
                    <option value="system" {% if scope_filter == 'system' %}selected{% endif %}>Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…</option>
                    <option value="accountability" {% if scope_filter == 'accountability' %}selected{% endif %}>Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</option>
                    <option value="internal" {% if scope_filter == 'internal' %}selected{% endif %}>Ù…Ù‡Ø§Ù… Ø¯Ø§Ø®Ù„ÙŠØ©</option>
                    <option value="worker" {% if scope_filter == 'worker' %}selected{% endif %}>Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ù…Ø§Ù„</option>
                    <option value="admin_management" {% if scope_filter == 'admin_management' %}selected{% endif %}>Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø¯Ù…Ù†</option>
                </select>
            </div>

            <!-- ÙÙ„ØªØ± Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…Ø¹ÙŠÙ† -->
            <div class="flex-1">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    <i class="fas fa-user-shield ml-1"></i>
                    Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…Ø¹ÙŠÙ†
                </label>
                <select id="admin-filter" onchange="filterTasks()" class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù…Ù†</option>
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                </select>
            </div>

            <!-- ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® -->
            <div class="flex-1">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    <i class="fas fa-calendar ml-1"></i>
                    Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                </label>
                <select id="date-filter" onchange="filterTasks()" class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</option>
                    <option value="today" {% if date_filter == 'today' %}selected{% endif %}>Ø§Ù„ÙŠÙˆÙ…</option>
                    <option value="tomorrow" {% if date_filter == 'tomorrow' %}selected{% endif %}>ØºØ¯Ø§Ù‹</option>
                    <option value="week" {% if date_filter == 'week' %}selected{% endif %}>Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
                    <option value="overdue" {% if date_filter == 'overdue' %}selected{% endif %}>Ù…ØªØ£Ø®Ø±Ø©</option>
                    <option value="upcoming" {% if date_filter == 'upcoming' %}selected{% endif %}>Ù‚Ø§Ø¯Ù…Ø©</option>
                </select>
            </div>

            <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† -->
            <div class="flex items-end">
                <button onclick="resetFilters()" class="btn-secondary whitespace-nowrap">
                    <i class="fas fa-redo ml-1"></i>
                    Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
                </button>
            </div>
        </div>

        <!-- Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ -->
        <div class="mt-4">
            <div class="relative">
                <input type="text" id="task-search" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…..." 
                       class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-4 py-2 pl-10 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                       onkeyup="searchTasks()">
                <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
            </div>
        </div>
    </div>

    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù… -->
    <div class="card p-4 mb-6 hidden" id="progress-indicator">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3 space-x-reverse">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                <span class="text-gray-700 dark:text-gray-300" id="progress-text">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù‡Ø§Ù…...</span>
            </div>
            <div class="text-sm text-gray-500" id="progress-details"></div>
        </div>
    </div>

    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ù… -->
    <div class="card p-4">
        {% if tasks %}
        <div class="space-y-4" id="tasks-container">
            {% for task in tasks %}
            <div class="task-item flex items-start p-4 border rounded-lg transition-all duration-300 hover:shadow-md 
                {% if task.priority == 'critical' %}border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20
                {% elif task.priority == 'high' %}border-orange-200 bg-orange-50 dark:border-orange-800 dark:bg-orange-900/20
                {% elif task.priority == 'medium' %}border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-900/20
                {% else %}border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-900/20{% endif %}
                {% if task.status == 'completed' %}opacity-70{% endif %}"
                data-task-id="{{ task.id }}"
                data-priority="{{ task.priority }}"
                data-status="{{ task.status }}"
                data-type="{{ task.task_type }}"
                data-scope="{{ task.task_scope }}"
                data-due-date="{{ task.due_date.strftime('%Y-%m-%d') if task.due_date else '' }}"
                data-search-text="{{ task.title.lower() }} {{ task.description.lower() if task.description else '' }} {{ task.assigned_to.lower() if task.assigned_to else '' }} {{ task.worker.name.lower() if task.worker else '' }} {{ task.assigned_by_admin.lower() if task.assigned_by_admin else '' }}">
                
                <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø© - Ù…Ø®ÙÙŠ Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª -->
                {% if task.task_type != 'order' or not task.worker_id %}
                <div class="flex-shrink-0 mt-1 mr-3">
                    <div class="relative">
                        <input type="checkbox" 
                               {% if task.status == 'completed' %}checked{% endif %}
                               onchange="toggleTaskStatus({{ task.id }}, this.checked)"
                               class="h-5 w-5 text-green-600 rounded border-gray-300 focus:ring-green-500 cursor-pointer">
                        {% if task.auto_generated %}
                        <i class="fas fa-robot text-blue-500 text-xs absolute -top-1 -right-1"></i>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="flex-shrink-0 mt-1 mr-3 w-5"></div>
                {% endif %}

                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‡Ù…Ø© -->
                <div class="flex-1 min-w-0">
                    <div class="flex items-start justify-between">
                        <div class="min-w-0 flex-1">
                            <h3 class="font-semibold text-gray-900 dark:text-white text-lg truncate {% if task.status == 'completed' %}line-through{% endif %}">
                                {{ task.title }}
                                {% if task.is_overdue and task.status != 'completed' %}
                                <span class="text-red-500 text-sm ml-2" title="Ù…Ù‡Ù…Ø© Ù…ØªØ£Ø®Ø±Ø©">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </span>
                                {% endif %}
                            </h3>
                            
                            {% if task.description %}
                            <p class="text-gray-600 dark:text-gray-400 mt-1 text-sm line-clamp-2">{{ task.description }}</p>
                            {% endif %}
                        </div>
                        
                        <div class="flex items-center space-x-2 space-x-reverse ml-4 flex-shrink-0">
                            <!-- Ø¨Ø§Ø¯Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© -->
                            <span class="px-2 py-1 rounded-full text-xs font-medium 
                                {% if task.priority == 'critical' %}bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100
                                {% elif task.priority == 'high' %}bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-100
                                {% elif task.priority == 'medium' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100
                                {% else %}bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100{% endif %}">
                                {{ 'Ø­Ø±Ø¬Ø©' if task.priority == 'critical' else 'Ø¹Ø§Ù„ÙŠØ©' if task.priority == 'high' else 'Ù…ØªÙˆØ³Ø·Ø©' if task.priority == 'medium' else 'Ù…Ù†Ø®ÙØ¶Ø©' }}
                            </span>

                            <!-- Ø¨Ø§Ø¯Ø¬ Ø§Ù„Ù†ÙˆØ¹ -->
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">
                                {{ 'Ø¯ÙŠÙˆÙ†' if task.task_type == 'debt' else 'Ø·Ù„Ø¨ÙŠØ§Øª' if task.task_type == 'order' else 'Ø¹Ù…Ø§Ù„' if task.task_type == 'worker' else 'Ù…ØµØ§Ø±ÙŠÙ' if task.task_type == 'expense' else 'Ù†Ø¸Ø§Ù…' if task.task_type == 'system' else 'Ø¹Ø§Ù…' }}
                            </span>
                        </div>
                    </div>

                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
                    <div class="flex flex-wrap items-center justify-between mt-3">
                        <div class="flex items-center space-x-4 space-x-reverse text-sm text-gray-500 dark:text-gray-400">
                            {% if task.assigned_to %}
                            <span class="flex items-center">
                                <i class="fas fa-user ml-1"></i>
                                {{ task.assigned_to }}
                            </span>
                            {% endif %}
                            
                            {% if task.assigned_by_admin %}
                            <span class="flex items-center">
                                <i class="fas fa-user-shield ml-1"></i>
                                Ø§Ù„Ù…Ø¹ÙŠÙ† Ø¨ÙˆØ§Ø³Ø·Ø©: {{ task.assigned_by_admin }}
                            </span>
                            {% endif %}
                            
                            {% if task.due_date %}
                            <span class="flex items-center {% if task.is_overdue and task.status != 'completed' %}text-red-600 font-medium{% endif %}">
                                <i class="fas fa-calendar ml-1"></i>
                                {% if task.is_overdue and task.status != 'completed' %}ØªØ£Ø®Ø±Øª: {% endif %}
                                {{ task.due_date.strftime('%Y-%m-%d') }}
                                {% if task.days_until_due and not task.is_overdue %}
                                <span class="text-xs text-gray-400 mr-1">({{ task.days_until_due }} ÙŠÙˆÙ…)</span>
                                {% endif %}
                            </span>
                            {% endif %}

                            {% if task.related_entity_info %}
                            <span class="flex items-center">
                                <i class="fas fa-link ml-1"></i>
                                {{ task.related_entity_info }}
                            </span>
                            {% endif %}

                            <span class="flex items-center text-xs">
                                <i class="fas fa-clock ml-1"></i>
                                {{ task.created_at.strftime('%Y-%m-%d') }}
                            </span>
                        </div>

                        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø­Ø¯Ø«Ø© -->
                        <div class="flex items-center space-x-2 space-x-reverse mt-2 sm:mt-0">
                            {% if task.task_scope == 'admin_management' %}
                                <!-- Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ù„Ø£Ø¯Ù…Ù† -->
                                {% if task.status != 'completed' and task.status != 'suspended' %}
                                    {% if task.status == 'pending' %}
                                    <button onclick="acceptAdminTask({{ task.id }})" 
                                            class="text-green-600 hover:text-green-800 dark:hover:text-green-400 transition-colors p-1 rounded hover:bg-green-100 dark:hover:bg-green-900"
                                            title="Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°">
                                        <i class="fas fa-check-circle text-lg"></i>
                                    </button>
                                    {% endif %}
                                    
                                    <button onclick="suspendTask({{ task.id }})" 
                                            class="text-orange-600 hover:text-orange-800 dark:hover:text-orange-400 transition-colors p-1 rounded hover:bg-orange-100 dark:hover:bg-orange-900"
                                            title="ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ù…Ù‡Ù…Ø©">
                                        <i class="fas fa-pause text-lg"></i>
                                    </button>
                                    
                                    <button onclick="completeTask({{ task.id }})" 
                                            class="text-green-600 hover:text-green-800 dark:hover:text-green-400 transition-colors p-1 rounded hover:bg-green-100 dark:hover:bg-green-900"
                                            title="Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©">
                                        <i class="fas fa-check-double text-lg"></i>
                                    </button>
                                {% endif %}
                                
                                {% if task.status == 'suspended' %}
                                <button onclick="resumeTask({{ task.id }})" 
                                        class="text-green-600 hover:text-green-800 dark:hover:text-green-400 transition-colors p-1 rounded hover:bg-green-100 dark:hover:bg-green-900"
                                        title="Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù…Ù‡Ù…Ø©">
                                    <i class="fas fa-play text-lg"></i>
                                </button>
                                {% endif %}
                                
                            {% elif task.task_type == 'order' and task.worker_id %}
                                <!-- Ù…Ù‡Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª Ø§Ù„Ù…Ø¹ÙŠÙ†Ø© Ù„Ù„Ø¹Ø§Ù…Ù„ -->
                                <!-- Ù„Ø§ ØªØ¸Ù‡Ø± Ø£ÙŠ Ø£Ø²Ø±Ø§Ø± ØªØ­ÙƒÙ… -->
                                
                            {% else %}
                                <!-- Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© -->
                                {% if task.status != 'completed' and task.status != 'suspended' %}
                                <button onclick="startTask({{ task.id }})" 
                                        class="text-blue-600 hover:text-blue-800 dark:hover:text-blue-400 transition-colors p-1 rounded hover:bg-blue-100 dark:hover:bg-blue-900"
                                        title="Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°">
                                    <i class="fas fa-play-circle text-lg"></i>
                                </button>
                                
                                <button onclick="completeTask({{ task.id }})" 
                                        class="text-green-600 hover:text-green-800 dark:hover:text-green-400 transition-colors p-1 rounded hover:bg-green-100 dark:hover:bg-green-900"
                                        title="Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©">
                                    <i class="fas fa-check-circle text-lg"></i>
                                </button>
                                {% endif %}
                            {% endif %}

                            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© -->
                            {% if is_admin_user() and task.task_type != 'order' %}
                                {% if task.status == 'suspended' and task.task_scope != 'admin_management' %}
                                <button onclick="resumeTask({{ task.id }})" 
                                        class="text-green-600 hover:text-green-800 dark:hover:text-green-400 transition-colors p-1 rounded hover:bg-green-100 dark:hover:bg-green-900"
                                        title="Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù…Ù‡Ù…Ø©">
                                    <i class="fas fa-play text-lg"></i>
                                </button>
                                {% elif task.status != 'suspended' and task.task_scope != 'admin_management' %}
                                <button onclick="suspendTask({{ task.id }})" 
                                        class="text-orange-600 hover:text-orange-800 dark:hover:text-orange-400 transition-colors p-1 rounded hover:bg-orange-100 dark:hover:bg-orange-900"
                                        title="ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ù…Ù‡Ù…Ø©">
                                    <i class="fas fa-pause text-lg"></i>
                                </button>
                                {% endif %}
                                
                                {% if task.waiting_approval %}
                                <button onclick="approveTask({{ task.id }})" 
                                        class="text-green-600 hover:text-green-800 dark:hover:text-green-400 transition-colors p-1 rounded hover:bg-green-100 dark:hover:bg-green-900"
                                        title="Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©">
                                    <i class="fas fa-check-double text-lg"></i>
                                </button>
                                
                                <button onclick="rejectTask({{ task.id }})" 
                                        class="text-red-600 hover:text-red-800 dark:hover:text-red-400 transition-colors p-1 rounded hover:bg-red-100 dark:hover:bg-red-900"
                                        title="Ø±ÙØ¶ Ø§Ù„Ù…Ù‡Ù…Ø©">
                                    <i class="fas fa-times-circle text-lg"></i>
                                </button>
                                {% endif %}
                                
                                {% if task.task_type != 'order' %}
                                <button onclick="reassignTask({{ task.id }})" 
                                        class="text-purple-600 hover:text-purple-800 dark:hover:text-purple-400 transition-colors p-1 rounded hover:bg-purple-100 dark:hover:bg-purple-900"
                                        title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ù…Ø©">
                                    <i class="fas fa-user-friends text-lg"></i>
                                </button>
                                {% endif %}
                            {% endif %}
                            
                            <!-- Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ù…Ø®ÙÙŠ Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª) -->
                            {% if task.task_type != 'order' %}
                            <button onclick="editTask({{ task.id }})" 
                                    class="text-blue-600 hover:text-blue-800 dark:hover:text-blue-400 transition-colors p-1 rounded hover:bg-blue-100 dark:hover:bg-blue-900"
                                    title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©">
                                <i class="fas fa-edit text-lg"></i>
                            </button>
                            {% endif %}
                            
                            <!-- Ø²Ø± Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
                            <button onclick="showTaskDetails({{ task.id }})" 
                                    class="text-purple-600 hover:text-purple-800 dark:hover:text-purple-400 transition-colors p-1 rounded hover:bg-purple-100 dark:hover:bg-purple-900"
                                    title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                <i class="fas fa-eye text-lg"></i>
                            </button>
                            
                            <!-- Ø²Ø± Ø§Ù„Ø­Ø°Ù (Ù…Ø®ÙÙŠ Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª) -->
                            {% if task.task_type != 'order' %}
                            <button onclick="deleteTask({{ task.id }})" 
                                    class="text-red-600 hover:text-red-800 dark:hover:text-red-400 transition-colors p-1 rounded hover:bg-red-100 dark:hover:bg-red-900"
                                    title="Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©">
                                <i class="fas fa-trash text-lg"></i>
                            </button>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø© -->
                    <div class="mt-2 flex items-center space-x-2 space-x-reverse">
                        <span class="text-xs px-2 py-1 rounded-full 
                            {% if task.status == 'completed' %}bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100
                            {% elif task.status == 'in_progress' %}bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100
                            {% elif task.status == 'suspended' %}bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-100
                            {% else %}bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300{% endif %}">
                            {{ 'Ù…ÙƒØªÙ…Ù„Ø©' if task.status == 'completed' else 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' if task.status == 'in_progress' else 'Ù…Ø¹Ù„Ù‚Ø©' if task.status == 'suspended' else 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' }}
                        </span>
                        
                        {% if task.notes %}
                        <span class="text-xs text-gray-500 flex items-center cursor-help" title="{{ task.notes }}">
                            <i class="fas fa-sticky-note ml-1"></i>
                            Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                        </span>
                        {% endif %}
                        
                        {% if task.waiting_approval %}
                        <span class="text-xs px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100">
                            <i class="fas fa-clock ml-1"></i>
                            Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                        </span>
                        {% endif %}

                        <!-- Ø¨Ø§Ø¯Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ù‡Ù…Ø© -->
                        <span class="px-2 py-1 rounded-full text-xs font-medium 
                            {% if task.task_scope == 'system' %}bg-purple-100 text-purple-800 dark:bg-purple-800 dark:text-purple-100
                            {% elif task.task_scope == 'accountability' %}bg-indigo-100 text-indigo-800 dark:bg-indigo-800 dark:text-indigo-100
                            {% elif task.task_scope == 'worker' %}bg-teal-100 text-teal-800 dark:bg-teal-800 dark:text-teal-100
                            {% elif task.task_scope == 'admin_management' %}bg-pink-100 text-pink-800 dark:bg-pink-800 dark:text-pink-100
                            {% else %}bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300{% endif %}">
                            {{ 'Ù†Ø¸Ø§Ù…' if task.task_scope == 'system' else 'Ù…Ø­Ø§Ø³Ø¨Ø©' if task.task_scope == 'accountability' else 'Ø¹Ù…Ø§Ù„' if task.task_scope == 'worker' else 'Ø£Ø¯Ù…Ù†' if task.task_scope == 'admin_management' else 'Ø¯Ø§Ø®Ù„ÙŠØ©' }}
                        </span>
                    </div>

                    <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
                    {% if task.waiting_approval %}
                    <div class="mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-700">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-clock text-yellow-600 text-xl"></i>
                                <div>
                                    <h4 class="font-semibold text-yellow-800 dark:text-yellow-200">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h4>
                                    <p class="text-yellow-700 dark:text-yellow-300 text-sm">ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹ØªÙƒ</p>
                                    {% if task.completion_notes %}
                                    <p class="text-yellow-600 dark:text-yellow-400 mt-2 text-sm">
                                        <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡:</strong> {{ task.completion_notes }}
                                    </p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="approveTask({{ task.id }})" 
                                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2 text-sm">
                                    <i class="fas fa-check"></i>
                                    Ù…ÙˆØ§ÙÙ‚Ø©
                                </button>
                                <button onclick="rejectTask({{ task.id }})" 
                                        class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2 text-sm">
                                    <i class="fas fa-times"></i>
                                    Ø±ÙØ¶
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª -->
        <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
            <div class="text-sm text-gray-600 dark:text-gray-400">
                Ø¹Ø±Ø¶ <span class="font-medium">{{ tasks|length }}</span> Ù…Ù† Ø£ØµÙ„ <span class="font-medium">{{ stats.total }}</span> Ù…Ù‡Ù…Ø©
            </div>
            <div class="flex space-x-2 space-x-reverse">
                <button class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm disabled:opacity-50" disabled>
                    Ø§Ù„Ø³Ø§Ø¨Ù‚
                </button>
                <button class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm">
                    Ø§Ù„ØªØ§Ù„ÙŠ
                </button>
            </div>
        </div>
        {% else %}
        <div class="text-center py-12">
            <i class="fas fa-tasks text-4xl text-gray-400 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</h3>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ</p>
            <div class="flex justify-center space-x-3 space-x-reverse">
                <button onclick="showAddTaskModal()" class="btn-primary">
                    <i class="fas fa-plus ml-2"></i>
                    Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
                <button onclick="generateAutoTasks()" class="btn-secondary">
                    <i class="fas fa-robot ml-2"></i>
                    ØªÙˆÙ„ÙŠØ¯ Ù…Ù‡Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
                </button>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…Ù‡Ù…Ø© -->
<div id="task-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white dark:bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white" id="modal-title">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        </div>
        
        <form id="task-form" class="p-6">
            <input type="hidden" id="task-id" name="task_id">
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø© *</label>
                    <input type="text" id="task-title" name="title" required 
                           class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="task-description" name="description" rows="3"
                              class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                              placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…Ù‡Ù…Ø©..."></textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                        <select id="task-priority" name="priority" 
                                class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
                            <option value="medium" selected>Ù…ØªÙˆØ³Ø·Ø©</option>
                            <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
                            <option value="critical">Ø­Ø±Ø¬Ø©</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ù„Ù†ÙˆØ¹</label>
                        <select id="task-type" name="task_type" 
                                class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="general">Ø¹Ø§Ù…</option>
                            <option value="debt">Ø¯ÙŠÙˆÙ†</option>
                            <option value="order">Ø·Ù„Ø¨ÙŠØ§Øª</option>
                            <option value="worker">Ø¹Ù…Ø§Ù„</option>
                            <option value="expense">Ù…ØµØ§Ø±ÙŠÙ</option>
                            <option value="system">Ù†Ø¸Ø§Ù…</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                        <select id="task-scope" name="task_scope" 
                                class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="internal">Ø¯Ø§Ø®Ù„ÙŠØ©</option>
                            <option value="system">Ù†Ø¸Ø§Ù…</option>
                            <option value="accountability">Ù…Ø­Ø§Ø³Ø¨Ø©</option>
                            <option value="worker">Ø¹Ù…Ø§Ù„</option>
                            <option value="admin_management">Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø¯Ù…Ù†</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ØªØ¹ÙŠÙŠÙ† Ø¥Ù„Ù‰ Ø¹Ø§Ù…Ù„</label>
                        <select id="task-worker" name="worker_id" 
                                class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ØªØ¹ÙŠÙŠÙ† Ø¥Ù„Ù‰</label>
                        <input type="text" id="task-assigned" name="assigned_to" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„ÙØ±ÙŠÙ‚">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</label>
                        <input type="date" id="task-due-date" name="due_date" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                    <textarea id="task-notes" name="notes" rows="2"
                              class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                              placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 space-x-reverse mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button type="button" onclick="hideTaskModal()" class="btn-secondary">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="submit" class="btn-primary" id="modal-submit-btn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©</button>
            </div>
        </form>
    </div>
</div>

<!-- Ù†Ù…ÙˆØ°Ø¬ Ù…Ù‡Ù…Ø© Ø£Ø¯Ù…Ù† -->
<div id="admin-task-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white dark:bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ù…Ø© Ø£Ø¯Ù…Ù† Ø¬Ø¯ÙŠØ¯Ø©</h3>
        </div>
        
        <form id="admin-task-form" class="p-6">
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø© *</label>
                    <input type="text" name="title" required 
                           class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ù„ÙˆØµÙ</label>
                    <textarea name="description" rows="3"
                              class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                              placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©..."></textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                        <select name="priority" 
                                class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
                            <option value="medium" selected>Ù…ØªÙˆØ³Ø·Ø©</option>
                            <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
                            <option value="critical">Ø­Ø±Ø¬Ø©</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ØªØ¹ÙŠÙŠÙ† Ø¥Ù„Ù‰ Ø£Ø¯Ù…Ù†</label>
                        <select name="assigned_admin" required
                                class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¯Ù…Ù†</option>
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</label>
                        <input type="date" name="due_date" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                        <select name="task_scope" 
                                class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="admin_management" selected>Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø¯Ù…Ù†</option>
                            <option value="internal">Ù…Ù‡Ø§Ù… Ø¯Ø§Ø®Ù„ÙŠØ©</option>
                            <option value="system">Ù…Ù‡Ø§Ù… Ù†Ø¸Ø§Ù…</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 space-x-reverse mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button type="button" onclick="hideAdminTaskModal()" class="btn-secondary">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="submit" class="btn-primary">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©</button>
            </div>
        </form>
    </div>
</div>

<!-- Ù†Ù…ÙˆØ°Ø¬ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© -->
<div id="details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white dark:bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white" id="details-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©</h3>
        </div>
        
        <div class="p-6 space-y-4" id="task-details-content">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </div>
        
        <div class="flex justify-end p-6 border-t border-gray-200 dark:border-gray-700">
            <button onclick="hideDetailsModal()" class="btn-secondary">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
</div>

<!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ù…Ø© -->
<div id="reassign-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white dark:bg-gray-800 rounded-lg w-full max-w-md">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ù…Ø©</h3>
        </div>
        
        <form id="reassign-form" class="p-6">
            <input type="hidden" id="reassign-task-id" name="task_id">
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
                    <select id="reassign-worker" name="new_worker_id" required 
                            class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø³Ø¨Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</label>
                    <textarea id="reassign-reason" name="reason" rows="3" required
                              class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                              placeholder="Ø§Ø°ÙƒØ± Ø³Ø¨Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†..."></textarea>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 space-x-reverse mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button type="button" onclick="hideReassignModal()" class="btn-secondary">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="submit" class="btn-primary">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</button>
            </div>
        </form>
    </div>
</div>

<!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ø¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
<div id="completion-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white dark:bg-gray-800 rounded-lg w-full max-w-md">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white" id="completion-title">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©</h3>
        </div>
        
        <form id="completion-form" class="p-6">
            <input type="hidden" id="completion-task-id" name="task_id">
            
            <div class="space-y-4">
                <div id="completion-task-info" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                        Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                    </label>
                    <textarea id="completion-notes" name="completion_notes" rows="4"
                              class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                              placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù† Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ù‡Ù…Ø©..."></textarea>
                </div>
                
                <div id="approval-section" class="hidden">
                    <div class="flex items-center">
                        <input type="checkbox" id="require-approval" name="require_approval" checked
                               class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                        <label for="require-approval" class="mr-2 text-sm text-gray-700 dark:text-gray-300">
                            ØªØªØ·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                        </label>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                        Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø¨Ù„ Ø¥ØºÙ„Ø§Ù‚Ù‡Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
                    </p>
                </div>
                
                <div id="auto-approve-section" class="hidden">
                    <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-700">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-600 ml-2"></i>
                            <span class="text-green-800 dark:text-green-200 text-sm">
                                ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 space-x-reverse mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button type="button" onclick="hideCompletionModal()" class="btn-secondary">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="submit" class="btn-success" id="completion-submit-btn">
                    <i class="fas fa-check ml-2"></i>
                    ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// ==========================================
// ğŸ¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
// ==========================================

let currentFilters = {
    status: 'all',
    priority: 'all',
    type: 'all',
    scope: 'all',
    admin: 'all',
    date_filter: 'all'
};

// ==========================================
// ğŸ¯ Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
// ==========================================

/**
 * Ù‚Ø¨ÙˆÙ„ Ù…Ù‡Ù…Ø© Ø§Ù„Ø£Ø¯Ù…Ù† ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°
 */
async function acceptAdminTask(taskId) {
    try {
        showToast('Ø¬Ø§Ø±ÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°...', 'info');
        
        const response = await fetch(`/api/admin/tasks/${taskId}/accept`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨Ù†Ø¬Ø§Ø­', 'success');
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            showToast(data.error, 'error');
        }
    } catch (error) {
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
    }
}

/**
 * ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø©
 */
async function toggleTaskStatus(taskId, completed) {
    try {
        const newStatus = completed ? 'completed' : 'pending';
        const response = await fetch(`/api/tasks/${taskId}/status`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status: newStatus })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast(`ØªÙ… ${completed ? 'Ø¥ÙƒÙ…Ø§Ù„' : 'Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­'} Ø§Ù„Ù…Ù‡Ù…Ø©`, 'success');
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            showToast(data.error, 'error');
        }
    } catch (error) {
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
    }
}

/**
 * Ø¨Ø¯Ø¡ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø©
 */
async function startTask(taskId) {
    try {
        showToast('Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©...', 'info');
        
        const response = await fetch(`/api/tasks/${taskId}/status`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status: 'in_progress' })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast('ØªÙ… Ø¨Ø¯Ø¡ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø©', 'success');
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            showToast(data.error, 'error');
        }
    } catch (error) {
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
    }
}

/**
 * Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©
 */
async function completeTask(taskId) {
    await showCompletionModal(taskId);
}

/**
 * ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ù…Ù‡Ù…Ø©
 */
async function suspendTask(taskId) {
    const reason = prompt('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø³Ø¨Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚:');
    if (reason) {
        try {
            showToast('Ø¬Ø§Ø±ÙŠ ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ù…Ù‡Ù…Ø©...', 'info');
            
            const response = await fetch(`/api/admin/tasks/${taskId}/suspend`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ reason: reason })
            });
            
            const data = await response.json();
            
            if (data.success) {
                showToast('ØªÙ… ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                showToast(data.error, 'error');
            }
        } catch (error) {
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
        }
    }
}

/**
 * Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù…Ù‡Ù…Ø©
 */
async function resumeTask(taskId) {
    try {
        showToast('Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù…Ù‡Ù…Ø©...', 'info');
        
        const response = await fetch(`/api/admin/tasks/${taskId}/resume`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast('ØªÙ… Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            showToast(data.error, 'error');
        }
    } catch (error) {
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
    }
}

/**
 * Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©
 */
async function approveTask(taskId) {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆØ¥ØºÙ„Ø§Ù‚Ù‡Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) {
        try {
            showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©...', 'info');
            
            const response = await fetch(`/api/admin/tasks/${taskId}/approve`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                showToast('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                showToast(data.error, 'error');
            }
        } catch (error) {
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
        }
    }
}

/**
 * Ø±ÙØ¶ Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆØ¥Ø¹Ø§Ø¯ØªÙ‡Ø§ Ù„Ù„Ø¹Ø§Ù…Ù„
 */
async function rejectTask(taskId) {
    const reason = prompt('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶:');
    if (reason) {
        try {
            showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„Ø¹Ø§Ù…Ù„...', 'info');
            
            const response = await fetch(`/api/admin/tasks/${taskId}/reject`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ reason: reason })
            });
            
            const data = await response.json();
            
            if (data.success) {
                showToast('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„Ø¹Ø§Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                showToast(data.error, 'error');
            }
        } catch (error) {
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
        }
    }
}

/**
 * Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ù…Ø©
 */
async function reassignTask(taskId) {
    document.getElementById('reassign-task-id').value = taskId;
    await loadWorkersForReassign();
    document.getElementById('reassign-modal').classList.remove('hidden');
}

/**
 * ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©
 */
async function editTask(taskId) {
    showEditTaskModal(taskId);
}

/**
 * Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©
 */
async function deleteTask(taskId) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ')) {
        try {
            const response = await fetch(`/api/tasks/${taskId}`, {
                method: 'DELETE'
            });
            
            const data = await response.json();
            
            if (data.success) {
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                showToast(data.error, 'error');
            }
        } catch (error) {
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
        }
    }
}

// ==========================================
// ğŸ¯ Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø©
// ==========================================

/**
 * Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
 */
function showAddTaskModal() {
    document.getElementById('modal-title').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©';
    document.getElementById('modal-submit-btn').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©';
    document.getElementById('task-form').reset();
    document.getElementById('task-id').value = '';
    loadWorkersForSelect();
    document.getElementById('task-modal').classList.remove('hidden');
}

/**
 * Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù‡Ù…Ø©
 */
function showEditTaskModal(taskId) {
    const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
    if (taskElement) {
        document.getElementById('modal-title').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©';
        document.getElementById('modal-submit-btn').textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
        document.getElementById('task-id').value = taskId;
        
        // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø³ØªØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
        document.getElementById('task-title').value = taskElement.querySelector('h3').textContent.trim();
        
        loadWorkersForSelect();
        document.getElementById('task-modal').classList.remove('hidden');
    }
}

/**
 * Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù‡Ù…Ø©
 */
function hideTaskModal() {
    document.getElementById('task-modal').classList.add('hidden');
}

/**
 * Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ù…Ø© Ø£Ø¯Ù…Ù†
 */
function createAdminTask() {
    loadAdminsForSelect();
    const modal = document.getElementById('admin-task-modal');
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

/**
 * Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ù…Ù‡Ù…Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
 */
function hideAdminTaskModal() {
    const modal = document.getElementById('admin-task-modal');
    modal.classList.add('hidden');
    document.body.style.overflow = 'auto';
}

/**
 * Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
 */
function hideReassignModal() {
    document.getElementById('reassign-modal').classList.add('hidden');
}

/**
 * Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©
 */
function showTaskDetails(taskId) {
    const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
    if (taskElement) {
        const title = taskElement.querySelector('h3').textContent.trim();
        const description = taskElement.querySelector('p')?.textContent || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ';
        const priority = taskElement.getAttribute('data-priority');
        const status = taskElement.getAttribute('data-status');
        const type = taskElement.getAttribute('data-type');
        const scope = taskElement.getAttribute('data-scope');
        const dueDate = taskElement.getAttribute('data-due-date');
        
        const detailsContent = `
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                    <p class="text-gray-900 dark:text-white font-semibold">${title}</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ù„ÙˆØµÙ</label>
                    <p class="text-gray-600 dark:text-gray-400">${description}</p>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                        <span class="px-2 py-1 rounded-full text-xs font-medium 
                            ${getPriorityBadgeClass(priority)}">
                            ${getPriorityText(priority)}
                        </span>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                        <span class="px-2 py-1 rounded-full text-xs font-medium 
                            ${getStatusBadgeClass(status)}">
                            ${getStatusText(status)}
                        </span>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ù„Ù†ÙˆØ¹</label>
                        <p class="text-gray-600 dark:text-gray-400">${getTypeText(type)}</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ø§Ù„Ù†Ø·Ø§Ù‚</label>
                        <p class="text-gray-600 dark:text-gray-400">${getScopeText(scope)}</p>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</label>
                    <p class="text-gray-600 dark:text-gray-400">${dueDate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                </div>
            </div>
        `;
        
        document.getElementById('details-title').textContent = `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© #${taskId}`;
        document.getElementById('task-details-content').innerHTML = detailsContent;
        document.getElementById('details-modal').classList.remove('hidden');
    }
}

/**
 * Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙØ§ØµÙŠÙ„
 */
function hideDetailsModal() {
    document.getElementById('details-modal').classList.add('hidden');
}

/**
 * Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©
 */
async function showCompletionModal(taskId) {
    try {
        showProgress('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©...', 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª');
        
        const response = await fetch(`/api/tasks/${taskId}/completion_data`);
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('completion-task-id').value = taskId;
            
            // ØªØ¹Ø¨Ø¦Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©
            const taskInfo = document.getElementById('completion-task-info');
            taskInfo.innerHTML = `
                <div class="space-y-2">
                    <h4 class="font-semibold text-gray-900 dark:text-white">${data.task.title}</h4>
                    ${data.task.description ? `<p class="text-sm text-gray-600 dark:text-gray-400">${data.task.description}</p>` : ''}
                    ${data.task.assigned_to ? `<p class="text-xs text-gray-500 dark:text-gray-400">Ø§Ù„Ù…Ø¹ÙŠÙ†Ø© Ù„Ù€: ${data.task.assigned_to}</p>` : ''}
                    ${data.task.related_entity_info ? `<p class="text-xs text-blue-600 dark:text-blue-400">${data.task.related_entity_info}</p>` : ''}
                </div>
            `;
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
            const approvalSection = document.getElementById('approval-section');
            const autoApproveSection = document.getElementById('auto-approve-section');
            
            if (data.user_type === 'admin') {
                approvalSection.classList.add('hidden');
                autoApproveSection.classList.remove('hidden');
            } else {
                approvalSection.classList.remove('hidden');
                autoApproveSection.classList.add('hidden');
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('completion-notes').value = '';
            if (document.getElementById('require-approval')) {
                document.getElementById('require-approval').checked = true;
            }
            
            hideProgress();
            document.getElementById('completion-modal').classList.remove('hidden');
        } else {
            hideProgress();
            showToast(data.error, 'error');
        }
    } catch (error) {
        hideProgress();
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
    }
}

/**
 * Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„
 */
function hideCompletionModal() {
    document.getElementById('completion-modal').classList.add('hidden');
}

// ==========================================
// ğŸ¯ Ø¯ÙˆØ§Ù„ Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ø¨Ø­Ø«
// ==========================================

/**
 * ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
 */
function filterTasks() {
    const status = document.getElementById('status-filter').value;
    const priority = document.getElementById('priority-filter').value;
    const type = document.getElementById('type-filter').value;
    const scope = document.getElementById('scope-filter').value;
    const admin = document.getElementById('admin-filter')?.value || 'all';
    const dateFilter = document.getElementById('date-filter').value;
    
    let url = '/tasks/with_scopes?';
    let params = [];
    
    if (status !== 'all') params.push(`status=${status}`);
    if (priority !== 'all') params.push(`priority=${priority}`);
    if (type !== 'all') params.push(`type=${type}`);
    if (scope !== 'all') params.push(`scope=${scope}`);
    if (admin !== 'all') params.push(`admin=${admin}`);
    if (dateFilter !== 'all') params.push(`date_filter=${dateFilter}`);
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù…Ø© Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«
    params.push(`refresh=true`);
    
    if (params.length > 0) {
        url += params.join('&');
    }
    
    window.location.href = url;
}

/**
 * ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ø­Ø§Ù„Ø©
 */
function filterByStatus(status) {
    document.getElementById('status-filter').value = status;
    filterTasks();
}

/**
 * ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
 */
function filterByPriority(priority) {
    document.getElementById('priority-filter').value = priority;
    filterTasks();
}

/**
 * Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±
 */
function resetFilters() {
    document.getElementById('status-filter').value = 'all';
    document.getElementById('priority-filter').value = 'all';
    document.getElementById('type-filter').value = 'all';
    document.getElementById('scope-filter').value = 'all';
    if (document.getElementById('admin-filter')) {
        document.getElementById('admin-filter').value = 'all';
    }
    document.getElementById('date-filter').value = 'all';
    document.getElementById('task-search').value = '';
    filterTasks();
}

/**
 * Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…
 */
function searchTasks() {
    const searchTerm = document.getElementById('task-search').value.toLowerCase();
    const taskItems = document.querySelectorAll('.task-item');
    let visibleCount = 0;
    
    taskItems.forEach(item => {
        const searchText = item.getAttribute('data-search-text');
        if (searchText.includes(searchTerm)) {
            item.style.display = 'flex';
            visibleCount++;
        } else {
            item.style.display = 'none';
        }
    });
}

// ==========================================
// ğŸ¯ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„ØªÙ‡ÙŠØ¦Ø©
// ==========================================

/**
 * ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ Ù„Ù„Ù†Ù…Ø§Ø°Ø¬
 */
async function loadWorkersForSelect() {
    try {
        const response = await fetch('/api/workers/for_tasks');
        const data = await response.json();
        
        if (data.success) {
            const select = document.getElementById('task-worker');
            if (select) {
                select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„</option>';
                
                data.workers.forEach(worker => {
                    const option = document.createElement('option');
                    option.value = worker.id;
                    option.textContent = `${worker.name} - ${worker.phone}`;
                    select.appendChild(option);
                });
            }
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„:', error);
    }
}

/**
 * ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
 */
async function loadWorkersForReassign() {
    try {
        const response = await fetch('/api/workers/for_tasks');
        const data = await response.json();
        
        if (data.success) {
            const select = document.getElementById('reassign-worker');
            if (select) {
                select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„</option>';
                
                data.workers.forEach(worker => {
                    const option = document.createElement('option');
                    option.value = worker.id;
                    option.textContent = `${worker.name} - ${worker.phone}`;
                    select.appendChild(option);
                });
            }
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„:', error);
    }
}

/**
 * ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
 */
async function loadAdminsForSelect() {
    try {
        const response = await fetch('/api/admin/users');
        const data = await response.json();
        
        if (data.success) {
            const select = document.querySelector('select[name="assigned_admin"]');
            if (select) {
                select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¯Ù…Ù†</option>';
                
                data.admins.forEach(admin => {
                    const option = document.createElement('option');
                    option.value = admin.username;
                    option.textContent = `${admin.full_name} (${admin.role})`;
                    select.appendChild(option);
                });
            }
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯Ù…Ù†:', error);
    }
}

/**
 * ØªØ­Ù…ÙŠÙ„ ÙÙ„Ø§ØªØ± Ø§Ù„Ø£Ø¯Ù…Ù†
 */
async function loadAdminFilters() {
    try {
        const response = await fetch('/api/admin/users');
        const data = await response.json();
        
        if (data.success) {
            const adminFilter = document.getElementById('admin-filter');
            if (adminFilter) {
                // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                const currentValue = adminFilter.value;
                
                adminFilter.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù…Ù†</option>';
                
                data.admins.forEach(admin => {
                    const option = document.createElement('option');
                    option.value = admin.username;
                    option.textContent = admin.full_name;
                    adminFilter.appendChild(option);
                });
                
                // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                if (currentValue && currentValue !== 'all') {
                    adminFilter.value = currentValue;
                }
            }
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ÙÙ„Ø§ØªØ± Ø§Ù„Ø£Ø¯Ù…Ù†:', error);
    }
}

/**
 * ØªØ­Ù…ÙŠÙ„ ÙÙ„Ø§ØªØ± Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…Ø¹ÙŠÙ†ÙŠÙ†
 */
async function loadAdminAssignmentFilters() {
    try {
        const response = await fetch('/api/tasks/assigned_admins');
        const data = await response.json();
        
        if (data.success) {
            const adminFilter = document.getElementById('admin-filter');
            if (adminFilter) {
                const currentValue = adminFilter.value;
                
                adminFilter.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù…Ù†</option>';
                
                data.admins.forEach(admin => {
                    const option = document.createElement('option');
                    option.value = admin.username;
                    option.textContent = admin.full_name || admin.username;
                    adminFilter.appendChild(option);
                });
                
                // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                if (currentValue && currentValue !== 'all') {
                    adminFilter.value = currentValue;
                }
            }
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ÙÙ„Ø§ØªØ± Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…Ø¹ÙŠÙ†ÙŠÙ†:', error);
    }
}

// ==========================================
// ğŸ¯ Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
// ==========================================

/**
 * ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­ÙŠ
 */
function updateLiveTime() {
    const now = new Date();
    const timeString = now.toLocaleDateString('ar-EG', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
    
    const timeElement = document.getElementById('tasks-live-time');
    if (timeElement) {
        timeElement.textContent = timeString;
    }
}

/**
 * Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ù†ØµÙˆØµ
 */
function getPriorityText(priority) {
    const priorities = {
        'critical': 'Ø­Ø±Ø¬Ø©',
        'high': 'Ø¹Ø§Ù„ÙŠØ©', 
        'medium': 'Ù…ØªÙˆØ³Ø·Ø©',
        'low': 'Ù…Ù†Ø®ÙØ¶Ø©'
    };
    return priorities[priority] || priority;
}

function getStatusText(status) {
    const statuses = {
        'completed': 'Ù…ÙƒØªÙ…Ù„Ø©',
        'in_progress': 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',
        'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
        'suspended': 'Ù…Ø¹Ù„Ù‚Ø©'
    };
    return statuses[status] || status;
}

function getTypeText(type) {
    const types = {
        'debt': 'Ø¯ÙŠÙˆÙ†',
        'order': 'Ø·Ù„Ø¨ÙŠØ§Øª',
        'worker': 'Ø¹Ù…Ø§Ù„',
        'expense': 'Ù…ØµØ§Ø±ÙŠÙ',
        'system': 'Ù†Ø¸Ø§Ù…',
        'general': 'Ø¹Ø§Ù…'
    };
    return types[type] || type;
}

function getScopeText(scope) {
    const scopes = {
        'system': 'Ù†Ø¸Ø§Ù…',
        'accountability': 'Ù…Ø­Ø§Ø³Ø¨Ø©',
        'worker': 'Ø¹Ù…Ø§Ù„',
        'admin_management': 'Ø£Ø¯Ù…Ù†',
        'internal': 'Ø¯Ø§Ø®Ù„ÙŠØ©'
    };
    return scopes[scope] || scope;
}

function getPriorityBadgeClass(priority) {
    const classes = {
        'critical': 'bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100',
        'high': 'bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-100',
        'medium': 'bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100',
        'low': 'bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100'
    };
    return classes[priority] || 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';
}

function getStatusBadgeClass(status) {
    const classes = {
        'completed': 'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100',
        'in_progress': 'bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100',
        'suspended': 'bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-100',
        'pending': 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300'
    };
    return classes[status] || 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';
}

// ==========================================
// ğŸ¯ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
// ==========================================

/**
 * ØªÙˆÙ„ÙŠØ¯ Ù…Ù‡Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
 */
async function generateAutoTasks() {
    const btn = document.getElementById('generate-tasks-btn');
    const originalText = btn.innerHTML;
    
    try {
        showProgress('Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©...', 'ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...';
        
        const response = await fetch('/api/tasks/generate', {
            method: 'POST'
        });
        
        const data = await response.json();
        
        hideProgress();
        
        if (data.success) {
            const count = data.tasks_created || 0;
            if (count > 0) {
                showToast(`ØªÙ… ØªÙˆÙ„ÙŠØ¯ ${count} Ù…Ù‡Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©`, 'success');
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¤Ù‚Øª
                const counter = document.getElementById('new-tasks-count');
                counter.textContent = count;
                counter.classList.remove('hidden');
                
                setTimeout(() => {
                    counter.classList.add('hidden');
                }, 3000);
            } else {
                showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¬Ø¯ÙŠØ¯Ø© ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªÙˆÙ„ÙŠØ¯', 'info');
            }
            
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        } else {
            showToast(data.error, 'error');
        }
        
    } catch (error) {
        hideProgress();
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‡Ø§Ù…', 'error');
    } finally {
        btn.disabled = false;
        btn.innerHTML = originalText;
    }
}

/**
 * Ø£Ø±Ø´ÙØ© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
 */
async function archiveCompletedTasks() {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£Ø±Ø´ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©ØŸ')) {
        try {
            const response = await fetch('/api/tasks/archive_completed', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            
            const result = await response.json();
            
            if (result.success) {
                showToast(`ØªÙ… Ø£Ø±Ø´ÙØ© ${result.archived_count} Ù…Ù‡Ù…Ø©`, 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                showToast(result.error, 'error');
            }
        } catch (error) {
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø£Ø±Ø´ÙØ©', 'error');
        }
    }
}

/**
 * ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
 */
function refreshTasks() {
    showProgress('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'ØªØ­Ù…ÙŠÙ„ Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù‡Ø§Ù…');
    setTimeout(() => {
        window.location.reload();
    }, 500);
}

/**
 * Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù…
 */
function showProgress(text, details = '') {
    const indicator = document.getElementById('progress-indicator');
    const progressText = document.getElementById('progress-text');
    const progressDetails = document.getElementById('progress-details');
    
    if (progressText) progressText.textContent = text;
    if (progressDetails) progressDetails.textContent = details;
    if (indicator) indicator.classList.remove('hidden');
}

function hideProgress() {
    const indicator = document.getElementById('progress-indicator');
    if (indicator) indicator.classList.add('hidden');
}

/**
 * Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
 */
function showToast(message, type = 'success') {
    // ØªÙ†ÙÙŠØ° Ù…Ø¨Ø³Ø· Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    const toast = document.createElement('div');
    toast.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm transform transition-transform duration-300 translate-x-full ${
        type === 'success' ? 'bg-green-500' :
        type === 'error' ? 'bg-red-500' :
        type === 'warning' ? 'bg-orange-500' : 'bg-blue-500'
    }`;
    
    toast.innerHTML = `
        <div class="flex items-center">
            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} ml-2"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    setTimeout(() => {
        toast.classList.remove('translate-x-full');
        toast.classList.add('translate-x-0');
    }, 100);
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†
    setTimeout(() => {
        toast.classList.remove('translate-x-0');
        toast.classList.add('translate-x-full');
        setTimeout(() => {
            if (document.body.contains(toast)) {
                document.body.removeChild(toast);
            }
        }, 300);
    }, 3000);
}

// ==========================================
// ğŸ¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
// ==========================================

/**
 * Ù…Ø¹Ø§Ù„Ø¬ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©
 */
document.getElementById('task-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const taskId = document.getElementById('task-id').value;
    const url = taskId ? `/api/tasks/${taskId}` : '/tasks/add';
    const method = taskId ? 'PUT' : 'POST';
    
    try {
        const response = await fetch(url, {
            method: method,
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast(taskId ? 'ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            hideTaskModal();
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            showToast(data.error, 'error');
        }
    } catch (error) {
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
    }
});

/**
 * Ù…Ø¹Ø§Ù„Ø¬ Ù†Ù…ÙˆØ°Ø¬ Ù…Ù‡Ù…Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
 */
document.getElementById('admin-task-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = {
        title: formData.get('title'),
        description: formData.get('description'),
        priority: formData.get('priority'),
        assigned_admin: formData.get('assigned_admin'),
        due_date: formData.get('due_date'),
        task_scope: formData.get('task_scope') || 'admin_management'
    };
    
    try {
        const response = await fetch('/api/admin/tasks/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            hideAdminTaskModal();
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            showToast(result.error, 'error');
        }
    } catch (error) {
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
    }
});

/**
 * Ù…Ø¹Ø§Ù„Ø¬ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
 */
document.getElementById('reassign-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const taskId = formData.get('task_id');
    const data = {
        new_worker_id: parseInt(formData.get('new_worker_id')),
        reason: formData.get('reason')
    };
    
    try {
        const response = await fetch(`/api/admin/tasks/${taskId}/reassign`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            showToast('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            hideReassignModal();
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            showToast(result.error, 'error');
        }
    } catch (error) {
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†', 'error');
    }
});

/**
 * Ù…Ø¹Ø§Ù„Ø¬ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„
 */
document.getElementById('completion-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const taskId = document.getElementById('completion-task-id').value;
    const completionNotes = document.getElementById('completion-notes').value;
    const requireApproval = document.getElementById('require-approval')?.checked ?? true;
    
    const data = {
        completion_notes: completionNotes,
        require_approval: requireApproval
    };
    
    try {
        showProgress('Ø¬Ø§Ø±ÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©...', 'Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª');
        
        const response = await fetch(`/api/tasks/${taskId}/complete_enhanced`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        hideProgress();
        
        if (result.success) {
            let successMessage = result.message;
            
            if (result.requires_admin_approval) {
                successMessage += ' ğŸ“¨ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©';
            }
            
            showToast(successMessage, 'success');
            hideCompletionModal();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        } else {
            showToast(result.error, 'error');
        }
    } catch (error) {
        hideProgress();
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
    }
});

// ==========================================
// ğŸ¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø«
// ==========================================

/**
 * ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©
 */
function applyCurrentFilters() {
    const urlParams = new URLSearchParams(window.location.search);
    
    // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ… Ø§Ù„ÙÙ„Ø§ØªØ± Ù…Ù† URL
    const filters = ['status', 'priority', 'type', 'scope', 'admin', 'date_filter'];
    filters.forEach(filter => {
        const value = urlParams.get(filter);
        const element = document.getElementById(`${filter}-filter`);
        if (element && value) {
            element.value = value;
        }
    });
}

/**
 * ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©
 */
async function loadUnreadNotifications() {
    try {
        const response = await fetch('/api/notifications/unread');
        const data = await response.json();
        
        if (data.success && data.unread_count > 0) {
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹)
            const notificationBadge = document.getElementById('notification-badge');
            if (notificationBadge) {
                notificationBadge.textContent = data.unread_count;
                notificationBadge.classList.remove('hidden');
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            if (data.unread_count > 0) {
                showToast(`Ù„Ø¯ÙŠÙƒ ${data.unread_count} Ø¥Ø´Ø¹Ø§Ø± ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡`, 'info');
            }
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:', error);
    }
}

/**
 * ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­ÙŠØ©
 */
async function loadLiveStats() {
    try {
        const response = await fetch('/api/tasks/stats');
        const data = await response.json();
        
        if (data.success) {
            console.log('Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©:', data.stats);
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
    }
}

/**
 * ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
 */
document.addEventListener('DOMContentLoaded', function() {
    // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    updateLiveTime();
    setInterval(updateLiveTime, 60000);
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    loadUnreadNotifications();
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙ„Ø§ØªØ±
    loadAdminsForSelect();
    loadAdminFilters();
    loadAdminAssignmentFilters();
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    applyCurrentFilters();
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ù„Ù„Ø¹Ù†Ø§ØµØ±
    const taskItems = document.querySelectorAll('.task-item');
    taskItems.forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
    setInterval(loadUnreadNotifications, 60000);
    
    // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    const adminModal = document.getElementById('admin-task-modal');
    if (adminModal) {
        adminModal.addEventListener('click', function(e) {
            if (e.target === this) {
                hideAdminTaskModal();
            }
        });
    }
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª ØªØ­Ù…ÙŠÙ„
    const loaders = document.querySelectorAll('.loading-indicator');
    loaders.forEach(loader => {
        loader.innerHTML = '<i class="fas fa-spinner fa-spin ml-2"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
    });
});
</script>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.task-item {
    transition: all 0.3s ease;
}

.task-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
::-webkit-scrollbar {
    width: 6px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
@media (prefers-color-scheme: dark) {
    ::-webkit-scrollbar-track {
        background: #374151;
    }
    
    ::-webkit-scrollbar-thumb {
        background: #6b7280;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ */
@media (max-width: 768px) {
    .task-item {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .task-item > div:first-child {
        margin-bottom: 10px;
    }
    
    .flex-wrap {
        flex-direction: column;
        gap: 10px;
    }
    
    .flex-wrap > div:first-child {
        order: 2;
    }
    
    .flex-wrap > div:last-child {
        order: 1;
    }
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© */
.btn-primary, .btn-secondary, .btn-success, .btn-warning, .btn-info {
    transition: all 0.3s ease;
}

.btn-primary:hover, .btn-secondary:hover, .btn-success:hover, .btn-warning:hover, .btn-info:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

/* Ø£Ø²Ø±Ø§Ø± Ø¥Ø¶Ø§ÙÙŠØ© */
.btn-warning {
    background-color: #f59e0b;
    color: white;
}

.btn-warning:hover {
    background-color: #d97706;
}

.btn-info {
    background-color: #06b6d4;
    color: white;
}

.btn-info:hover {
    background-color: #0891b2;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
.dark .card {
    background: #1f2937;
    border-color: #374151;
}

.dark .border-gray-200 {
    border-color: #374151;
}

.dark .text-gray-600 {
    color: #d1d5db;
}

.dark .text-gray-400 {
    color: #9ca3af;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø±Ø³ÙˆÙ…Ø§Øª */
.task-item {
    position: relative;
}

.task-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: transparent;
    transition: background-color 0.3s ease;
}

.task-item:hover::before {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.task-item {
    animation: slideIn 0.3s ease-out;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„ */
@media (max-width: 640px) {
    .grid-cols-2 {
        grid-template-columns: 1fr;
    }
    
    .flex-col-mobile {
        flex-direction: column;
    }
    
    .space-x-reverse-mobile {
        margin-right: 0;
        margin-left: 0;
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ */
#completion-modal {
    animation: slideInUp 0.3s ease-out;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
.notification-badge {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.7;
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
.dark #completion-modal {
    background: #1f2937;
    border: 1px solid #374151;
}

.dark #completion-task-info {
    background: #374151;
    border: 1px solid #4b5563;
}

/* ØªØ®ØµÙŠØµØ§Øª Ù„Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø®Ø§ØµØ© */
.task-order-worker {
    opacity: 0.8;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
}

.dark .task-order-worker {
    background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
}

.task-admin-management {
    border-left: 4px solid #ec4899;
}

.dark .task-admin-management {
    border-left: 4px solid #db2777;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
@media (max-width: 1024px) {
    .grid-cols-6 {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 768px) {
    .grid-cols-6 {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .grid-cols-6 {
        grid-template-columns: 1fr;
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© */
.rtl-support {
    direction: rtl;
    text-align: right;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
.icon-spin {
    animation: icon-spin 2s infinite linear;
}

@keyframes icon-spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¸Ù„Ø§Ù„ */
.shadow-custom {
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø®Ø·ÙˆØ· */
.font-arabic {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ØªÙØ§Ø¹Ù„Ø§Øª */
.interactive-element {
    cursor: pointer;
    user-select: none;
}

.interactive-element:active {
    transform: scale(0.98);
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
.section-title {
    position: relative;
    padding-right: 1.5rem;
}

.section-title::before {
    content: '';
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 24px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 2px;
}
</style>
{% endblock %}