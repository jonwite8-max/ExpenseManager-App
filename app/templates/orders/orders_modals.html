<!-- templates/orders/orders_modals.html -->

<!-- ======================= -->
<!-- ๐ซ MODALS SECTION -->
<!-- ======================= -->

<!-- Order Add/Edit Modal -->
<div id="orderModal" class="modal" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
  <div class="modal-content modern-modal">
    <div class="modal-header">
      <h3 id="modalTitle" class="text-lg md:text-xl font-bold text-gray-900">โ ุฅุถุงูุฉ ุทูุจูุฉ ุฌุฏูุฏุฉ</h3>
      <button type="button" onclick="hideModal('orderModal')" class="modal-close-btn" aria-label="ุฅุบูุงู">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form id="orderForm" method="POST" class="modal-body">
      <input type="hidden" name="id" id="order_id">

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
        <div class="form-group">
          <label for="order_name" class="form-label">ุงูุงุณู *</label>
          <input name="name" id="order_name" required class="form-input" placeholder="ุงุณู ุงูุนููู">
        </div>
        <div class="form-group">
          <label for="order_phone" class="form-label">ุฑูู ุงููุงุชู *</label>
          <input type="tel" name="phones" id="order_phone" required class="form-input" placeholder="+213 XXX XX XX XX">
        </div>
        <div class="form-group">
          <label for="order_wilaya" class="form-label">ุงูููุงูุฉ *</label>
          <input name="wilaya" id="order_wilaya" required class="form-input" placeholder="ุงุณู ุงูููุงูุฉ">
        </div>
        <div class="form-group">
          <label for="order_product" class="form-label">ุงูููุชุฌ *</label>
          <input name="product" id="order_product" required class="form-input" placeholder="ุงุณู ุงูููุชุฌ">
        </div>
        <div class="form-group">
          <label for="order_paid" class="form-label">ุงููุฏููุน *</label>
          <input name="paid" id="order_paid" type="number" step="0.01" required class="form-input" value="0" min="0">
        </div>
        <div class="form-group">
          <label for="order_total" class="form-label">ุงูุฅุฌูุงูู *</label>
          <input name="total" id="order_total" type="number" step="0.01" required class="form-input" value="0" min="1">
        </div>
        <div class="form-group">
          <label for="expected_cost" class="form-label">ุงูุชูููุฉ ุงููุชููุนุฉ</label>
          <input name="expected_cost" id="expected_cost" type="number" step="0.01" class="form-input" placeholder="ุณูุชู ุงุญุชุณุงุจูุง ุชููุงุฆูุงู">
        </div>
        <div class="form-group">
          <label for="estimated_days" class="form-label">ุงูุฃูุงู ุงููุชููุนุฉ</label>
          <input name="estimated_days" id="estimated_days" type="number" class="form-input" placeholder="ุนุฏุฏ ุฃูุงู ุงูุชูููุฐ ุงููุชููุนุฉ">
        </div>
        <div class="md:col-span-2 form-group">
          <label for="order_note" class="form-label">ุงูููุงุญุธุงุช</label>
          <textarea name="note" id="order_note" rows="3" class="form-textarea" placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ ุญูู ุงูุทูุจูุฉ..."></textarea>
        </div>
        <div class="md:col-span-2 form-group">
          <label for="order_status" class="form-label">ุงูุญุงูุฉ</label>
          <div class="flex gap-2">
            <select name="status" id="order_status" class="form-select flex-1">
              <option value="">-- ุงุฎุชุฑ ุงูุญุงูุฉ --</option>
              {% for s in statuses %}
              <option value="{{ s.id }}">{{ s.name }}</option>
              {% endfor %}
            </select>
            <button type="button" onclick="showAddStatusModal()" class="form-action-btn min-h-[44px] min-w-[44px] flex items-center justify-center" aria-label="ุฅุถุงูุฉ ุญุงูุฉ ุฌุฏูุฏุฉ">
              <i class="fas fa-plus"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" onclick="hideModal('orderModal')" class="btn-secondary min-h-[44px]">ุฅูุบุงุก</button>
        <button type="submit" class="btn-primary min-h-[44px]">ุญูุธ ุงูุทูุจูุฉ</button>
      </div>
    </form>
  </div>
</div>

<!-- ======================= -->
<!-- ๐ COSTS REPORT MODAL  -->
<!-- ======================= -->
<div id="costsReportModal" class="modal">
    <div class="modal-content modern-modal xlarge">
        <div class="modal-header">
            <div>
                <h3 class="text-lg md:text-xl font-bold text-white">๐ ุชูุฑูุฑ ุงูุชูุงููู ุงูุชูุตููู</h3>
                <p class="text-sm text-purple-100 mt-1 hidden md:block">ุชุญููู ุงูุชูุงููู ุญุณุจ ุงูุชุตูููุงุช ูุงููุณุชุฎุฏููู</p>
            </div>
            <button type="button" onclick="hideModal('costsReportModal')" class="modal-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <!-- ๐ ููุงุชุฑ ุงูุชูุฑูุฑ -->
            <div class="filters-section mb-4 md:mb-6">
                <div class="section-header">
                    <h4 class="section-title">
                        <i class="fas fa-filter"></i>
                        ๐ ุชุตููุฉ ุงูุชูุฑูุฑ
                    </h4>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 p-3 md:p-4 bg-gray-50 rounded-lg">
                    <!-- ููุชุฑ ุงููุณุชุฎุฏู -->
                    <div class="form-group">
                        <label for="costReportUserFilter" class="form-label">ุงููุณุชุฎุฏู</label>
                        <select id="costReportUserFilter" class="form-select" onchange="loadCostsReport()">
                            <option value="">ุฌููุน ุงููุณุชุฎุฏููู</option>
                            {% for user in users %}
                            <option value="{{ user.username }}">{{ user.username }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- ููุชุฑ ุงูุชุงุฑูุฎ ูู -->
                    <div class="form-group">
                        <label for="costReportDateFrom" class="form-label">ูู ุชุงุฑูุฎ</label>
                        <input type="date" id="costReportDateFrom" class="form-input" onchange="loadCostsReport()">
                    </div>
                    
                    <!-- ููุชุฑ ุงูุชุงุฑูุฎ ุฅูู -->
                    <div class="form-group">
                        <label for="costReportDateTo" class="form-label">ุฅูู ุชุงุฑูุฎ</label>
                        <input type="date" id="costReportDateTo" class="form-input" onchange="loadCostsReport()">
                    </div>
                </div>
                
                <!-- ุฒุฑ ุฅุนุงุฏุฉ ุงูุชุนููู -->
                <div class="text-center mt-3 md:mt-4">
                    <button type="button" onclick="resetCostsReportFilters()" class="btn-outline min-h-[44px]">
                        <i class="fas fa-refresh ml-2"></i>
                        ุฅุนุงุฏุฉ ุงูุชุนููู
                    </button>
                </div>
            </div>

            <!-- ๐ ุจุทุงูุงุช ุงูุชุตูููุงุช -->
            <div class="section-header mb-3 md:mb-4">
                <h4 class="section-title">
                    <i class="fas fa-chart-pie"></i>
                    ๐ ุงูุชูุงููู ุญุณุจ ุงูุชุตูููุงุช
                </h4>
                <span class="history-stats text-sm" id="costsReportStats">0 ุชุตููู</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4 mb-4 md:mb-6" id="costsCategoriesGrid">
                <!-- ุณูุชู ููุคู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                <div class="empty-state">
                    <i class="fas fa-chart-bar"></i>
                    <p>ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...</p>
                </div>
            </div>

            <!-- ๐ ุฌุฏูู ุงูุชูุงุตูู -->
            <div class="section-header mb-3 md:mb-4">
                <h4 class="section-title">
                    <i class="fas fa-table"></i>
                    ๐ ุงูุชูุงุตูู ุงููุงููุฉ
                </h4>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="table-header">
                        <tr>
                            <th class="p-2 md:p-3 text-xs md:text-sm">ุงูุชุตููู</th>
                            <th class="p-2 md:p-3 text-xs md:text-sm">ุงููุณุชุฎุฏู</th>
                            <th class="p-2 md:p-3 text-xs md:text-sm">ุนุฏุฏ ุงูุนูููุงุช</th>
                            <th class="p-2 md:p-3 text-xs md:text-sm">ุฅุฌูุงูู ุงูุชูููุฉ</th>
                            <th class="p-2 md:p-3 text-xs md:text-sm">ุงููุณุจุฉ</th>
                            <th class="p-2 md:p-3 text-xs md:text-sm">ุงูุฅุฌุฑุงุกุงุช</th>
                        </tr>
                    </thead>
                    <tbody id="costsDetailsTable">
                        <!-- ุณูุชู ููุคู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                        <tr>
                            <td colspan="6" class="p-4 md:p-6 text-center text-gray-500">
                                <i class="fas fa-chart-bar text-2xl md:text-4xl mb-2 md:mb-3 text-gray-300"></i>
                                <p class="text-sm">ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="modal-actions">
            <button type="button" onclick="hideModal('costsReportModal')" class="btn-secondary min-h-[44px]">
                ุฅุบูุงู
            </button>
            <button type="button" onclick="exportCostsReport()" class="btn-primary min-h-[44px]">
                <i class="fas fa-download ml-2"></i>
                ุชุตุฏูุฑ ุงูุชูุฑูุฑ
            </button>
        </div>
    </div>
</div>

<!-- ======================= -->
<!-- ๐ฐ ORDERS DEBTS MODAL  -->
<!-- ======================= -->
<div id="ordersDebtsModal" class="modal">
  <div class="modal-content modern-modal xlarge">
    <div class="modal-header">
      <div>
        <h3 class="text-lg md:text-xl font-bold text-white">๐ ุงูุทูุจูุงุช ุงููุชุฃุซุฑุฉ ุจุงูุฏููู</h3>
        <p class="text-sm text-purple-100 mt-1" id="ordersDebtsSummary">0 ุทูุจูุฉ ุจุฅุฌูุงูู 0 ุฏุฌ ุฏููู</p>
      </div>
      <button type="button" onclick="hideModal('ordersDebtsModal')" class="modal-close-btn">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mb-4 md:mb-6">
        <div class="stat-card bg-red-500 text-white">
          <div class="stat-label text-xs">ุฅุฌูุงูู ุงูุฏููู</div>
          <div class="stat-value text-lg md:text-xl" id="modalTotalDebts">0 ุฏุฌ</div>
        </div>
        <div class="stat-card bg-orange-500 text-white">
          <div class="stat-label text-xs">ุงูุทูุจูุงุช ุงููุชุฃุซุฑุฉ</div>
          <div class="stat-value text-lg md:text-xl" id="modalAffectedOrders">0</div>
        </div>
        <div class="stat-card bg-yellow-500 text-white">
          <div class="stat-label text-xs">ูุชูุณุท ุงูุฏูู</div>
          <div class="stat-value text-lg md:text-xl" id="modalAverageDebt">0 ุฏุฌ</div>
        </div>
        <div class="stat-card bg-green-500 text-white">
          <div class="stat-label text-xs">ุทูุจูุงุช ุจุฏูู ุฏููู</div>
          <div class="stat-value text-lg md:text-xl" id="modalDebtFreeOrders">0</div>
        </div>
      </div>

      <!-- ุฌุฏูู ุงูุทูุจูุงุช -->
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="table-header">
            <tr>
              <th class="p-2 md:p-3 text-xs md:text-sm"># ุงูุทูุจูุฉ</th>
              <th class="p-2 md:p-3 text-xs md:text-sm">ุงูุนููู</th>
              <th class="p-2 md:p-3 text-xs md:text-sm">ุฅุฌูุงูู ุงูุทูุจูุฉ</th>
              <th class="p-2 md:p-3 text-xs md:text-sm">ูุจูุบ ุงูุฏูู</th>
              <th class="p-2 md:p-3 text-xs md:text-sm">ูุณุจุฉ ุงูุฏูู</th>
              <th class="p-2 md:p-3 text-xs md:text-sm">ุงูุญุงูุฉ</th>
              <th class="p-2 md:p-3 text-xs md:text-sm">ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody id="ordersDebtsList">
            <!-- ุณูุชู ููุคู ุจุงูุฌุงูุงุณูุฑูุจุช -->
            <tr>
              <td colspan="7" class="p-4 md:p-6 text-center text-gray-500">
                <i class="fas fa-check-circle text-2xl md:text-4xl mb-2 md:mb-3 text-green-300"></i>
                <p class="text-sm">ูุง ุชูุฌุฏ ุทูุจูุงุช ุจูุง ุฏููู</p>
                <p class="text-xs text-gray-400 mt-1">ุฌููุน ุงูุทูุจูุงุช ุณูููุฉ ูุงููุงู</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="modal-actions">
      <button type="button" onclick="hideModal('ordersDebtsModal')" class="btn-secondary min-h-[44px]">
        ุฅุบูุงู
      </button>
      <button type="button" onclick="exportDebtsReport()" class="btn-primary min-h-[44px]">
        <i class="fas fa-download ml-2"></i>
        ุชุตุฏูุฑ ุงูุชูุฑูุฑ
      </button>
    </div>
  </div>
</div>

<!-- Mobile Phone Options Modal -->
<div id="mobilePhoneModal" class="modal" role="dialog" aria-hidden="true">
  <div class="modal-content modern-modal compact">
    <div class="modal-header">
      <h3 class="text-base md:text-lg font-bold text-gray-900">ุฎูุงุฑุงุช ุงููุงุชู</h3>
      <button type="button" onclick="hideModal('mobilePhoneModal')" class="modal-close-btn" aria-label="ุฅุบูุงู">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="flex justify-center gap-4 md:gap-6 py-4">
        <a id="mobileCallBtn" href="#" class="action-btn success large min-h-[60px] min-w-[60px] flex items-center justify-center text-xl" aria-label="ุงุชุตุงู">
          <i class="fas fa-phone"></i>
        </a>
        <a id="mobileWhatsappBtn" href="#" target="_blank" class="action-btn whatsapp large min-h-[60px] min-w-[60px] flex items-center justify-center text-xl" aria-label="ูุงุชุณุงุจ">
          <i class="fab fa-whatsapp"></i>
        </a>
        <button id="mobileCopyBtn" class="action-btn primary large min-h-[60px] min-w-[60px] flex items-center justify-center text-xl" aria-label="ูุณุฎ ุงูุฑูู">
          <i class="fas fa-copy"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Order Details Modal -->
<div id="detailsModal" class="modal" role="dialog" aria-labelledby="detailsOrderId" aria-hidden="true">
  <div class="modal-content modern-modal large">
    <div class="modal-header">
      <div>
        <h3 class="text-lg md:text-xl font-bold text-gray-900">๐ ุชูุงุตูู ุงูุทูุจูุฉ #<span id="detailsOrderId"></span></h3>
        <p class="text-sm text-gray-500 mt-1" id="detailsCustomerName"></p>
      </div>
      <button type="button" onclick="hideModal('detailsModal')" class="modal-close-btn" aria-label="ุฅุบูุงู">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">
        <!-- Worker Assignment Section -->
        <div class="space-y-4 md:space-y-6">
          <div class="feature-section blue">
            <h4 class="section-title">
              <i class="fas fa-users"></i>
              ๐ฅ ุฅุฏุงุฑุฉ ุชุนููู ุงูุนูุงู
            </h4>
            
            <!-- Current Assignments -->
            <div class="mb-4 md:mb-6">
              <h5 class="section-subtitle">ุงูุชุนูููุงุช ุงููุดุทุฉ:</h5>
              <div id="currentAssignments" class="space-y-2 md:space-y-3">
                <div class="empty-state">
                  <i class="fas fa-user-clock"></i>
                  <p>ูุง ุชูุฌุฏ ุชุนูููุงุช ุญุงููุฉ</p>
                  <p class="text-xs">ุงุณุชุฎุฏู ุงููููุฐุฌ ุฃุฏูุงู ูุฅุถุงูุฉ ุชุนููู ุฌุฏูุฏ</p>
                </div>
              </div>
            </div>
            
            <!-- New Assignment Form -->
            <div class="form-container">
              <h5 class="section-subtitle">ุฅุถุงูุฉ ุชุนููู ุฌุฏูุฏ:</h5>
              <form id="assignWorkerForm" class="space-y-3 md:space-y-4">
                <input type="hidden" id="assign_order_id">
                
                <div class="form-group">
                  <label for="assign_worker_id" class="form-label">ุงุฎุชุฑ ุงูุนุงูู</label>
                  <select id="assign_worker_id" class="form-select" required>
                    <option value="">-- ุงุฎุชุฑ ุงูุนุงูู --</option>
                    {% for worker in workers %}
                      <option value="{{ worker.id }}">{{ worker.name }} - {{ worker.phone }}</option>
                    {% endfor %}
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="assign_type" class="form-label">ููุน ุงููููุฉ</label>
                  <select id="assign_type" class="form-select" required>
                    <option value="workshop">ุนูู ุฏุงุฎู ุงููุฑุดุฉ</option>
                    <option value="travel">ุณูุฑ ูุชุฑููุจ</option>
                    <option value="installation">ุชุฑููุจ ููุท</option>
                    <option value="maintenance">ุตูุงูุฉ ูุฅุตูุงุญ</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="assign_notes" class="form-label">ููุงุญุธุงุช ุงูุชุนููู</label>
                  <textarea id="assign_notes" rows="3" class="form-textarea" placeholder="ุฃุถู ุชูุงุตูู ุนู ุงููููุฉ..."></textarea>
                </div>
                
                <button type="submit" class="btn-success w-full min-h-[44px]">
                  <i class="fas fa-user-plus ml-2"></i>
                  ุชุนููู ุงูุนุงูู
                </button>
              </form>
            </div>
          </div>
        </div>
        
        <!-- Additional Details Section -->
        <div class="space-y-4 md:space-y-6">
          <div class="feature-section purple">
            <h4 class="section-title">
              <i class="fas fa-clipboard-list"></i>
              ๐ ุงูุชูุงุตูู ุงูุฅุถุงููุฉ
            </h4>
            
            <div class="space-y-3 md:space-y-4">
              <div class="form-group">
                <label for="production_details" class="form-label">ุชูุงุตูู ุงูุฅูุชุงุฌ</label>
                <textarea id="production_details" rows="4" class="form-textarea" placeholder="ุฃุถู ุชูุงุตูู ุนู ุณูุฑ ุงูุนููุ ุงูููุงุฏ ุงููุณุชุฎุฏูุฉุ ุงูููุงุญุธุงุช ุงููููุฉ..."></textarea>
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                <div class="form-group">
                  <label for="start_date" class="form-label">ุชุงุฑูุฎ ุงูุจุฏุก</label>
                  <input type="date" id="start_date" class="form-input">
                </div>
                <div class="form-group">
                  <label for="expected_delivery" class="form-label">ุชุงุฑูุฎ ุงูุชุณููู ุงููุชููุน</label>
                  <input type="date" id="expected_delivery" class="form-input">
                </div>
              </div>
              
              <div class="form-group">
                <label for="actual_delivery" class="form-label">ุชุงุฑูุฎ ุงูุชุณููู ุงููุนูู</label>
                <input type="date" id="actual_delivery" class="form-input">
              </div>
            </div>
          </div>
          
          <!-- Quick Attachments Access -->
          <div class="feature-section orange">
            <h4 class="section-title">
              <i class="fas fa-paperclip"></i>
              ๐ ุงููุตูู ุงูุณุฑูุน ูููุฑููุงุช
            </h4>
            <div class="text-center">
              <button onclick="showAttachments(currentOrderId)" class="btn-warning w-full min-h-[44px]">
                <i class="fas fa-external-link-alt ml-2"></i>
                ูุชุญ ูุงูุฐุฉ ุงููุฑููุงุช
              </button>
              <p class="text-xs text-gray-500 mt-2">ุฅุฏุงุฑุฉ ูุงููุฉ ูุฌููุน ุงููุฑููุงุช ูุงูุตูุฑ</p>
            </div>
          </div>
        </div>

        <!-- Performance Evaluation Section -->
        <div class="space-y-4 md:space-y-6">
          <div class="feature-section green">
            <h4 class="section-title">
              <i class="fas fa-chart-line"></i>
              โญ ุชูููู ุฃุฏุงุก ุงูุทูุจูุฉ
            </h4>
            
            <div class="space-y-3 md:space-y-4">
              <!-- Auto Performance Evaluation -->
              <div class="form-group">
                <label class="form-label">๐ ุงูุชูููู ุงูุชููุงุฆู</label>
                <div class="bg-white p-3 md:p-4 rounded-lg border border-gray-200">
                  <div class="grid grid-cols-2 gap-3 md:gap-4 mb-3 md:mb-4">
                    <div class="text-center">
                      <div class="text-xl md:text-2xl font-bold text-blue-600" id="autoTimeScore">0%</div>
                      <div class="text-xs text-gray-600">ุงูุงูุชุฒุงู ุจุงูููุช</div>
                    </div>
                    <div class="text-center">
                      <div class="text-xl md:text-2xl font-bold text-green-600" id="autoCostScore">0%</div>
                      <div class="text-xs text-gray-600">ุงูุงูุชุฒุงู ุจุงูููุฒุงููุฉ</div>
                    </div>
                  </div>
                  <div class="grid grid-cols-2 gap-3 md:gap-4">
                    <div class="text-center">
                      <div class="text-xl md:text-2xl font-bold text-purple-600" id="autoQualityScore">0%</div>
                      <div class="text-xs text-gray-600">ุฌูุฏุฉ ุงูุนูู</div>
                    </div>
                    <div class="text-center">
                      <div class="text-xl md:text-2xl font-bold text-orange-600" id="autoWorkerScore">0%</div>
                      <div class="text-xs text-gray-600">ุฃุฏุงุก ุงูุนูุงู</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Performance Insights -->
              <div class="form-group">
                <label class="form-label">๐ก ุชุญููู ุงูุฃุฏุงุก</label>
                <div id="performanceInsights" class="space-y-2 text-sm">
                  <div class="empty-state">
                    <i class="fas fa-chart-bar"></i>
                    <p>ุฌุงุฑู ุชุญููู ุฃุฏุงุก ุงูุทูุจูุฉ...</p>
                  </div>
                </div>
              </div>

              <!-- Post-Installation Issues -->
              <div class="form-group">
                <label class="form-label">โ๏ธ ูุดุงูู ูุง ุจุนุฏ ุงูุชุฑููุจ</label>
                <div class="space-y-2 md:space-y-3">
                  <div id="postInstallationIssues">
                    <div class="empty-state">
                      <i class="fas fa-tools"></i>
                      <p>ูุง ุชูุฌุฏ ูุดุงูู ูุณุฌูุฉ</p>
                    </div>
                  </div>
                  <button type="button" onclick="showIssueReportModal()" class="btn-warning w-full min-h-[44px]">
                    <i class="fas fa-exclamation-triangle ml-2"></i>
                    ุชุณุฌูู ูุดููุฉ ุฌุฏูุฏุฉ
                  </button>
                </div>
              </div>

              <!-- Root Cause Analysis -->
              <div class="form-group">
                <label class="form-label">๐ ุชุญููู ุงูุฃุณุจุงุจ ุงูุฌุฐุฑูุฉ</label>
                <div id="rootCauseAnalysis" class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                  <p class="text-sm text-yellow-800 text-center">ุณูุธูุฑ ุชุญููู ุงูุฃุณุจุงุจ ููุง ุนูุฏ ุชุณุฌูู ุงููุดุงูู</p>
                </div>
              </div>

              <!-- Overall Score -->
              <div class="bg-gray-50 p-3 md:p-4 rounded-lg">
                <div class="flex justify-between items-center">
                  <span class="font-semibold text-sm md:text-base">ุงูุชูููู ุงูููุงุฆู:</span>
                  <span id="overall_score" class="text-xl md:text-2xl font-bold text-green-600">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                  <div id="score_progress" class="h-2 rounded-full bg-green-500 transition-all duration-500" style="width: 0%"></div>
                </div>
                <div class="text-xs text-gray-500 mt-2 text-center" id="performanceSummary">ุฌุงุฑู ุงูุชูููู...</div>
              </div>

              <button type="button" onclick="refreshAutoEvaluation()" class="btn-success w-full min-h-[44px]">
                <i class="fas fa-sync-alt ml-2"></i>
                ุชุญุฏูุซ ุงูุชูููู ุงูุชููุงุฆู
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal-actions">
      <button type="button" onclick="hideModal('detailsModal')" class="btn-secondary min-h-[44px]">
        <i class="fas fa-times ml-2"></i>
        ุฅุบูุงู
      </button>
      <button type="button" onclick="saveOrderDetails()" class="btn-primary min-h-[44px]">
        <i class="fas fa-save ml-2"></i>
        ุญูุธ ุฌููุน ุงูุชุบููุฑุงุช
      </button>
    </div>
  </div>
</div>

<!-- Issue Report Modal -->
<div id="issueReportModal" class="modal" role="dialog" aria-hidden="true">
  <div class="modal-content modern-modal">
    <div class="modal-header">
      <h3 class="text-lg md:text-xl font-bold text-gray-900">โ๏ธ ุชุณุฌูู ูุดููุฉ ุจุนุฏ ุงูุชุฑููุจ</h3>
      <button type="button" onclick="hideModal('issueReportModal')" class="modal-close-btn" aria-label="ุฅุบูุงู">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form id="issueReportForm" class="modal-body">
      <input type="hidden" id="issue_order_id">
      
      <div class="space-y-3 md:space-y-4">
        <div class="form-group">
          <label for="issue_type" class="form-label">ููุน ุงููุดููุฉ *</label>
          <select id="issue_type" class="form-select" required>
            <option value="">-- ุงุฎุชุฑ ููุน ุงููุดููุฉ --</option>
            <option value="welding_issue">ูุดููุฉ ูู ุงููุญุงู</option>
            <option value="material_issue">ูุดููุฉ ูู ุงูููุงุฏ</option>
            <option value="design_issue">ูุดููุฉ ูู ุงูุชุตููู</option>
            <option value="installation_issue">ูุดููุฉ ูู ุงูุชุฑููุจ</option>
            <option value="finishing_issue">ูุดููุฉ ูู ุงูุชุดุทูุจ</option>
            <option value="transport_issue">ูุดููุฉ ูู ุงูููู</option>
            <option value="other">ุฃุฎุฑู</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="issue_severity" class="form-label">ุดุฏุฉ ุงููุดููุฉ *</label>
          <select id="issue_severity" class="form-select" required>
            <option value="low">ููุฎูุถุฉ</option>
            <option value="medium">ูุชูุณุทุฉ</option>
            <option value="high">ุนุงููุฉ</option>
            <option value="critical">ุญุฑุฌุฉ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="issue_description" class="form-label">ูุตู ุงููุดููุฉ *</label>
          <textarea id="issue_description" rows="4" class="form-textarea" placeholder="ุตู ุงููุดููุฉ ุจุงูุชูุตูู..." required></textarea>
        </div>
        
        <div class="form-group">
          <label for="issue_cause" class="form-label">ุงูุณุจุจ ุงููุญุชูู</label>
          <textarea id="issue_cause" rows="3" class="form-textarea" placeholder="ูุง ูู ุงูุณุจุจ ุงููุญุชูู ูููุดููุฉุ"></textarea>
        </div>
        
        <div class="form-group">
          <label for="issue_solution" class="form-label">ุงูุญู ุงูููุชุฑุญ</label>
          <textarea id="issue_solution" rows="3" class="form-textarea" placeholder="ูุง ูู ุงูุญู ุงูููุชุฑุญุ"></textarea>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
          <div class="form-group">
            <label for="issue_date" class="form-label">ุชุงุฑูุฎ ุงูุชุดุงู ุงููุดููุฉ</label>
            <input type="date" id="issue_date" class="form-input" required>
          </div>
          <div class="form-group">
            <label for="estimated_repair_time" class="form-label">ุงูููุช ุงููุชููุน ููุฅุตูุงุญ (ุฃูุงู)</label>
            <input type="number" id="estimated_repair_time" class="form-input" min="1" value="1">
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">ูู ุชู ุฅุตูุงุญ ุงููุดููุฉุ</label>
          <div class="flex gap-3 md:gap-4">
            <label class="flex items-center">
              <input type="radio" name="issue_resolved" value="yes" class="mr-2">
              <span>ูุนู</span>
            </label>
            <label class="flex items-center">
              <input type="radio" name="issue_resolved" value="no" checked class="mr-2">
              <span>ูุง</span>
            </label>
          </div>
        </div>
      </div>
      
      <div class="modal-actions">
        <button type="button" onclick="hideModal('issueReportModal')" class="btn-secondary min-h-[44px]">ุฅูุบุงุก</button>
        <button type="submit" class="btn-primary min-h-[44px]">ุญูุธ ุงููุดููุฉ</button>
      </div>
    </form>
  </div>
</div>

<!-- Order History Modal -->
<div id="historyModal" class="modal" role="dialog" aria-labelledby="historyOrderId" aria-hidden="true">
  <div class="modal-content modern-modal xlarge">
    <div class="modal-header">
      <div>
        <h3 class="text-lg md:text-xl font-bold text-gray-900">๐ ุงูุณุฌู ุงููุงูู ููุทูุจูุฉ #<span id="historyOrderId"></span></h3>
        <p class="text-sm text-gray-500 mt-1" id="historyOrderInfo"></p>
      </div>
      <button type="button" onclick="hideModal('historyModal')" class="modal-close-btn" aria-label="ุฅุบูุงู">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="grid grid-cols-2 md:grid-cols-7 gap-2 md:gap-3 mb-4 md:mb-6">
        <!-- Total -->
        <div class="stat-card purple">
            <div class="stat-label text-xs">ุงูุฅุฌูุงูู</div>
            <div class="stat-value text-sm md:text-base" id="historyTotalAmount">0 ุฏุฌ</div>
        </div>
        
        <!-- Paid -->
        <div class="stat-card green">
            <div class="stat-label text-xs">ุงููุฏููุน</div>
            <div class="stat-value text-sm md:text-base" id="historyPaidAmount">0 ุฏุฌ</div>
        </div>
        
        <!-- Remaining -->
        <div class="stat-card orange">
            <div class="stat-label text-xs">ุงููุชุจูู</div>
            <div class="stat-value text-sm md:text-base" id="historyRemainingAmount">0 ุฏุฌ</div>
        </div>
        
        <!-- Cost -->
        <div class="stat-card red">
            <div class="stat-label text-xs">ุงูุชูููุฉ</div>
            <div class="stat-value text-sm md:text-base" id="historyCostAmount">0 ุฏุฌ</div>
        </div>
        
        <!-- Debt Card -->
        <div class="stat-card bg-gradient-to-r from-red-500 to-pink-600 text-white cursor-pointer"
             onclick="showDebtDetails(currentOrderId)"
             id="orderDebtCard">
          <div class="stat-label text-xs">
            ุฏููู ุงูุทูุจูุฉ 
            <i class="fas fa-sync-alt ml-1 text-xs" id="debtRefreshIcon"></i>
          </div>
          <div class="stat-value text-sm md:text-base" id="historyOrderDebt">0 ุฏุฌ</div>
          <div class="text-xs opacity-80 mt-1" id="debtStatusText">ุฌุงุฑู ุงูุชุญุฏูุซ...</div>
        </div>

        <!-- Profit -->
        <div class="stat-card green">
            <div class="stat-label text-xs">ุงูุฑุจุญ</div>
            <div class="stat-value text-sm md:text-base" id="historyProfitAmount">0 ุฏุฌ</div>
        </div>
        
        <!-- Profit Percentage -->
        <div class="stat-card blue">
            <div class="stat-label text-xs">ูุณุจุฉ ุงูุฑุจุญ</div>
            <div class="stat-value text-sm md:text-base" id="historyProfitPercentage">0%</div>
        </div>
      </div>

      <!-- Visual Progress Bar -->
      <div class="progress-section">
          <div class="progress-labels text-xs">
              <span>ุงูุชูููุฉ</span>
              <span>ุงูุฅุฌูุงูู</span>
              <span>ุงูุฑุจุญ</span>
          </div>
          <div class="progress-bar-container">
              <div class="absolute left-0 top-0 h-3 md:h-4 bg-red-500 rounded-l-full" id="costBar"></div>
              <div class="absolute left-0 top-0 h-3 md:h-4 bg-green-500" id="profitBar"></div>
          </div>
          <div class="progress-percentages text-xs">
              <span id="costPercentage">0%</span>
              <span id="profitPercentage">0%</span>
          </div>
      </div>
      
      <!-- ๐ ุญููู ุงูุชุตููุฉ -->
      <div class="filters-section mb-4 md:mb-6">
        <div class="section-header">
            <h4 class="section-title">
                <i class="fas fa-filter"></i>
                ๐ ุชุตููุฉ ุงูุณุฌู
            </h4>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 p-3 md:p-4 bg-gray-50 rounded-lg">
            <!-- ููุชุฑ ุญุณุจ ุงููุณุชุฎุฏู -->
            <div class="form-group">
                <label for="historyUserFilter" class="form-label">ุงููุณุชุฎุฏู</label>
                <select id="historyUserFilter" class="form-select" onchange="applyHistoryFilters()">
                    <option value="">ุฌููุน ุงููุณุชุฎุฏููู</option>
                    {% for user in all_users %}
                    <option value="{{ user.username }}">{{ user.username }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- ููุชุฑ ููุน ุงูุนูููุฉ -->
            <div class="form-group">
                <label for="historyTypeFilter" class="form-label">ููุน ุงูุนูููุฉ</label>
                <select id="historyTypeFilter" class="form-select" onchange="applySmartHistoryFilters()">
                    <option value="">ุฌููุน ุงูุนูููุงุช</option>
                    <option value="ุฏูุนุฉ">ุฏูุนุงุช ูุงููุฉ</option>
                    <option value="ูุตุฑูู">ูุตุงุฑูู</option>
                    <option value="ููู">ุชูุงููู ููู</option>
                    <option value="ุฏููู">ุงูุฏููู</option>
                    <option value="ุชุนููู">ุชุนูููุงุช ุนูุงู</option>
                    <option value="ุชุนุฏูู">ุชุนุฏููุงุช</option>
                    <option value="ุฅูุดุงุก">ุฅูุดุงุก ุทูุจูุงุช</option>
                    <option value="ุญุฐู">ุนูููุงุช ุญุฐู</option>
                    <option value="ุชูููู">ุชููููุงุช ุฃุฏุงุก</option>
                    <option value="ูุดููุฉ">ูุดุงูู ูุง ุจุนุฏ ุงูุชุฑููุจ</option>
                    <option value="ุฃุฎุฑู">ุนูููุงุช ุฃุฎุฑู</option>
                </select>
            </div>
            
            <!-- ุฒุฑ ุฅุนุงุฏุฉ ุงูุชุนููู -->
            <div class="form-group flex items-end">
                <button type="button" onclick="resetHistoryFilters()" class="btn-outline w-full min-h-[44px]">
                    <i class="fas fa-refresh ml-2"></i>
                    ุฅุนุงุฏุฉ ุงูุชุนููู
                </button>
            </div>
        </div>
      </div>

      <!-- ุงูุณุฌู ุงูููุญุฏ -->
      <div class="history-section">
        <div class="section-header">
          <h4 class="section-title">
            <i class="fas fa-stream"></i>
            ุงูุณุฌู ุงูุฒููู ุงูููุญุฏ
          </h4>
          <span class="history-stats text-sm" id="historyStats">0 ุนูููุฉ</span>
        </div>
        <div id="unifiedHistoryContent" class="history-content">
          <div class="empty-state">
            <i class="fas fa-history"></i>
            <p>ุฌุงุฑู ุชุญููู ุงูุณุฌู...</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal-actions">
      <button type="button" onclick="hideModal('historyModal')" class="btn-secondary min-h-[44px]">
        ุฅุบูุงู ุงูุณุฌู
      </button>
    </div>
  </div>
</div>

<!-- Payment Modal -->
<div id="paymentModal" class="modal" role="dialog" aria-labelledby="paymentTitle" aria-hidden="true">
  <div class="modal-content modern-modal compact">
    <form id="paymentForm" method="POST" class="modal-body">
      <div class="modal-header">
        <h3 class="text-base md:text-lg font-bold text-gray-900">๐ฐ ุฅุถุงูุฉ ุฏูุนุฉ</h3>
        <button type="button" onclick="hideModal('paymentModal')" class="modal-close-btn" aria-label="ุฅุบูุงู">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <input type="hidden" name="order_id" id="payment_order_id">
      
      <div class="info-banner blue">
        <p class="text-sm">ุงููุจูุบ ุงููุชุจูู: <span id="remainingAmount" class="font-bold">0</span> ุฏุฌ</p>
      </div>

      <div class="form-group">
        <label for="payment_amount" class="form-label">ูุจูุบ ุงูุฏูุนุฉ *</label>
        <input type="number" name="amount" id="payment_amount" step="0.01" required 
               class="form-input"
               placeholder="ุฃุฏุฎู ูุจูุบ ุงูุฏูุนุฉ">
      </div>

      <div class="form-group">
        <label for="payment_date" class="form-label">ุชุงุฑูุฎ ุงูุฏูุนุฉ</label>
        <input type="date" name="payment_date" id="payment_date" required 
               class="form-input"
               value="{{ now.strftime('%Y-%m-%d') if now else '' }}">
      </div>

      <div class="form-group">
        <label for="payment_method" class="form-label">ุทุฑููุฉ ุงูุฏูุน</label>
        <select name="payment_method" id="payment_method" class="form-select">
            <option value="ููุฏู">ููุฏู</option>
            <option value="ุชุญููู ุจููู">ุชุญููู ุจููู</option>
            <option value="ุดูู">ุดูู</option>
        </select>
      </div>

      <div class="form-group">
        <label for="payment_notes" class="form-label">ููุงุญุธุงุช</label>
        <textarea name="notes" id="payment_notes" rows="2" class="form-textarea" placeholder="ููุงุญุธุงุช ุญูู ุงูุฏูุนุฉ..."></textarea>
      </div>

      <div class="modal-actions">
        <button type="button" onclick="hideModal('paymentModal')" class="btn-secondary min-h-[44px]">ุฅูุบุงุก</button>
        <button type="submit" class="btn-success min-h-[44px]">ุฅุถุงูุฉ ุงูุฏูุนุฉ</button>
      </div>
    </form>
  </div>
</div>

<!-- ๐ง ุงูุชุตููู ุงููุญุณู ููุงูุฐุฉ ุงููุฑููุงุช -->
<!-- ๐ง ูุงูุฐุฉ ุงููุฑููุงุช ุงููุญุณูุฉ -->
<div id="attachmentsModal" class="modal hidden">
    <div class="modal-content modern-modal xlarge attachments-modal-enhanced">
        <div class="modal-header">
            <h3 class="text-lg md:text-xl font-bold text-gray-900">
                <i class="fas fa-paperclip ml-2"></i>
                ุงููุฑููุงุช - ุงูุทูุจูุฉ #<span id="attachmentsOrderId">0</span>
            </h3>
            <button type="button" onclick="hideModal('attachmentsModal')" class="modal-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <!-- โ ูุณู ุงูุจุญุซ ูุงูุชุญูู -->
            <div class="control-section mb-4 md:mb-6">
                <div class="flex flex-col md:flex-row gap-3 md:gap-4 justify-between items-start md:items-center">
                    <!-- ุงูุจุญุซ -->
                    <div class="flex-1 w-full md:w-auto">
                        <div class="relative">
                            <input type="text" 
                                   id="attachmentsSearch" 
                                   class="search-input-professional w-full"
                                   placeholder="๐ ุงุจุญุซ ูู ุงููุฑููุงุช...">
                            <div class="absolute left-3 top-1/2 transform -translate-y-1/2">
                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full" 
                                      id="attachmentsCount">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ุฃุฒุฑุงุฑ ุงูุชุญูู -->
                    <div class="flex gap-2 w-full md:w-auto mt-3 md:mt-0">
                        <button onclick="clearUploadSelection()" class="btn-secondary flex items-center gap-2 min-h-[44px] flex-1 md:flex-none">
                            <i class="fas fa-times"></i>
                            <span class="hidden md:inline">ุฅูุบุงุก ุงูุฑูุน</span>
                            <span class="md:hidden">ุฅูุบุงุก</span>
                        </button>
                        <button onclick="uploadSelectedFiles()" class="btn-primary flex items-center gap-2 min-h-[44px] flex-1 md:flex-none">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span class="hidden md:inline">ุฑูุน ุงููููุงุช</span>
                            <span class="md:hidden">ุฑูุน</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- โ ูุณู ุงูุฑูุน - ุชุตููู ูุฏูุฌ ููุญุณูู -->
            <div class="upload-section-enhanced mb-4 md:mb-6">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-dashed border-blue-300 rounded-2xl p-4 md:p-6 transition-all duration-300 hover:border-blue-400 hover:from-blue-100 hover:to-indigo-100">
                    <div class="flex flex-col lg:flex-row gap-4 md:gap-6 items-center">
                        <!-- ุงุฎุชูุงุฑ ุงููููุงุช - ุชุตููู ูุญุณูู -->
                        <div class="flex-1 text-center lg:text-right">
                            <label class="upload-area-enhanced cursor-pointer block">
                                <input type="file" 
                                       id="newFileInput" 
                                       multiple 
                                       class="hidden" 
                                       onchange="handleFileSelection(event)">
                                <div class="upload-content-enhanced py-6 md:py-8">
                                    <div class="upload-icon-enhanced mb-3 md:mb-4">
                                        <i class="fas fa-cloud-upload-alt text-4xl md:text-5xl text-blue-500 mb-2 md:mb-3"></i>
                                    </div>
                                    <div class="upload-text-enhanced">
                                        <h4 class="text-lg md:text-xl font-bold text-gray-800 mb-2">ุฑูุน ุงููููุงุช</h4>
                                        <p class="text-gray-600 mb-2 md:mb-3 text-sm md:text-base">ุงุณุญุจ ุงููููุงุช ููุง ุฃู ุงููุฑ ููุงุฎุชูุงุฑ</p>
                                        <div class="upload-features grid grid-cols-1 md:grid-cols-3 gap-2 text-xs md:text-sm text-gray-500">
                                            <div class="feature-item flex items-center justify-center gap-1">
                                                <i class="fas fa-image text-green-500"></i>
                                                <span>ุงูุตูุฑ</span>
                                            </div>
                                            <div class="feature-item flex items-center justify-center gap-1">
                                                <i class="fas fa-video text-purple-500"></i>
                                                <span>ุงูููุฏูููุงุช</span>
                                            </div>
                                            <div class="feature-item flex items-center justify-center gap-1">
                                                <i class="fas fa-file-pdf text-red-500"></i>
                                                <span>PDF</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </label>
                        </div>
                        
                        <!-- ูุนูููุงุช ุงูุฑูุน - ุชุตููู ุฌุงูุจู -->
                        <div class="upload-info-enhanced bg-white rounded-xl p-3 md:p-4 border border-blue-200 shadow-sm w-full lg:w-auto">
                            <h5 class="font-semibold text-gray-800 mb-2 md:mb-3 flex items-center gap-2">
                                <i class="fas fa-info-circle text-blue-500"></i>
                                ูุนูููุงุช ุงูุฑูุน
                            </h5>
                            <div class="space-y-2 text-xs md:text-sm">
                                <div class="info-item flex items-center gap-2 text-gray-600">
                                    <i class="fas fa-check-circle text-green-500"></i>
                                    <span>ุงูุญุฏ ุงูุฃูุตู ููููู: <strong>10MB</strong></span>
                                </div>
                                <div class="info-item flex items-center gap-2 text-gray-600">
                                    <i class="fas fa-check-circle text-green-500"></i>
                                    <span>ุฅุฌูุงูู ุงูุญุฏ: <strong>40MB</strong></span>
                                </div>
                                <div class="info-item flex items-center gap-2 text-gray-600">
                                    <i class="fas fa-check-circle text-green-500"></i>
                                    <span>ุงูุตูุบ ุงููุฏุนููุฉ: <strong>PNG, JPG, MP4, PDF</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- โ ูุนุงููุฉ ุงููููุงุช ุงููุฎุชุงุฑุฉ - ุชุตููู ูุญุณูู -->
                    <div id="uploadPreview" class="hidden mt-4 md:mt-6">
                        <div class="preview-header-enhanced flex items-center justify-between mb-3 md:mb-4 p-3 bg-white rounded-lg border border-blue-200">
                            <div class="flex items-center gap-2 md:gap-3">
                                <i class="fas fa-images text-blue-500 text-lg md:text-xl"></i>
                                <div>
                                    <h5 class="font-semibold text-gray-800 text-sm md:text-base">ุงููููุงุช ุงููุฎุชุงุฑุฉ</h5>
                                    <p class="text-xs text-gray-600" id="filesCount">0 ููู</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-gray-500">ุงูุญุฌู ุงูุฅุฌูุงูู:</span>
                                <span class="font-semibold text-blue-600 text-sm" id="totalSize">0 MB</span>
                            </div>
                        </div>
                        
                        <!-- โ ุญูู ุงูุชุณููุฉ - ูุธูุฑ ููุท ุนูุฏ ุงุฎุชูุงุฑ ุงููููุงุช -->
                        <div id="attachmentLabelSection" class="hidden mb-3 md:mb-4">
                            <div class="form-group">
                                <label for="attachmentLabel" class="form-label flex items-center gap-2">
                                    <i class="fas fa-tag text-blue-500"></i>
                                    ุชุณููุฉ ููุญุฏุฉ ูููููุงุช
                                </label>
                                <input type="text" 
                                       id="attachmentLabel" 
                                       class="form-input" 
                                       placeholder="ุฃุฏุฎู ุชุณููุฉ ููุญุฏุฉ ูุฌููุน ุงููููุงุช ุงููุฑููุนุฉ...">
                                <div class="text-xs text-gray-500 mt-1 flex justify-between">
                                    <span>ุณูุชู ุชุทุจูู ูุฐู ุงูุชุณููุฉ ุนูู ุฌููุน ุงููููุงุช</span>
                                    <span id="labelCounter">0/50</span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="previewContainer" class="preview-grid-enhanced"></div>
                    </div>
                </div>
            </div>

            <!-- โ ูุณู ุงููุฑููุงุช ุงูุญุงููุฉ -->
            <div class="current-attachments-section">
                <div class="section-header mb-3 md:mb-4">
                    <h4 class="section-title">
                        <i class="fas fa-folder-open ml-2"></i>
                        ุงููุฑููุงุช ุงูุญุงููุฉ
                        <span class="bg-blue-100 text-blue-800 text-xs md:text-sm font-medium px-2 py-1 rounded-full ml-2" id="currentAttachmentsCount">0</span>
                    </h4>
                </div>
                <div id="currentAttachmentsList" class="attachments-grid-enhanced">
                    <!-- ุณูุชู ุชุนุจุฆุชู ุฏููุงููููุงู -->
                </div>
            </div>

            <!-- โ ูุณู ุงูููุงุญุธุงุช - ุชุตููู ูุจุณุท -->
            <div class="notes-section-simplified mt-6 md:mt-8">
                <div class="section-header mb-3 md:mb-4">
                    <h4 class="section-title">
                        <i class="fas fa-sticky-note ml-2"></i>
                        ููุงุญุธุงุช ุงููุฑููุงุช
                    </h4>
                    <button onclick="showAddNoteModal()" class="btn-outline flex items-center gap-2 min-h-[44px]">
                        <i class="fas fa-plus"></i>
                        <span class="hidden md:inline">ุฅุถุงูุฉ ููุงุญุธุฉ ุฌุฏูุฏุฉ</span>
                        <span class="md:hidden">ุฅุถุงูุฉ ููุงุญุธุฉ</span>
                    </button>
                </div>
                
                <!-- โ ุงูููุงุญุธุงุช ุงููุญููุธุฉ -->
                <div id="savedNotesDisplay" class="bg-gray-50 rounded-xl p-3 md:p-4 border border-gray-200">
                    <!-- ุณูุชู ุชุนุจุฆุชู ุฏููุงููููุงู -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ๐ง ูุนุงููุฉ ูุงููุฉ ุงูุดุงุดุฉ -->
<div id="fullScreenViewer" class="full-screen-viewer hidden">
    <div class="viewer-header">
        <h3 class="viewer-title text-base md:text-lg" id="viewerImageTitle"></h3>
        <button onclick="closeFullScreenViewer()" class="viewer-close-btn">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="viewer-content">
        <img src="" alt="" class="viewer-image" id="viewerImage">
    </div>
    <div class="viewer-footer">
        <button onclick="closeFullScreenViewer()" class="btn-primary min-h-[44px]">
            <i class="fas fa-times ml-2"></i>
            ุฅุบูุงู
        </button>
        <a href="#" class="btn-success min-h-[44px] flex items-center justify-center" id="viewerDownloadBtn">
            <i class="fas fa-download ml-2"></i>
            ุชุญููู
        </a>
    </div>
</div>

<!-- ุดุฑูุท ุงูุชุญููู ููููุงุชู -->
<div id="mobileLoader" class="mobile-loader hidden">
  <div class="loader-content">
    <div class="loader-spinner"></div>
    <p class="loader-text">ุฌุงุฑู ุงูุชุญููู...</p>
  </div>
</div>

<!-- ุฒุฑ ุงูุนูุฏุฉ ููุฃุนูู ููููุงุชู -->
<button id="scrollToTop" class="scroll-to-top hidden" aria-label="ุงูุนูุฏุฉ ููุฃุนูู">
  <i class="fas fa-arrow-up"></i>
</button>

<!-- Add Status Modal -->
<div id="addStatusModal" class="modal" role="dialog" aria-hidden="true">
  <div class="modal-content modern-modal compact">
    <div class="modal-header">
      <h3 class="text-base md:text-lg font-bold text-gray-900">โ ุฅุถุงูุฉ ุญุงูุฉ ุฌุฏูุฏุฉ</h3>
      <button type="button" onclick="hideModal('addStatusModal')" class="modal-close-btn" aria-label="ุฅุบูุงู">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form id="addStatusForm" class="modal-body">
      <div class="form-group">
        <label for="status_name" class="form-label">ุงุณู ุงูุญุงูุฉ *</label>
        <input type="text" id="status_name" class="form-input" required placeholder="ุงุณู ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ">
      </div>
      
      <div class="form-group">
        <label for="status_color" class="form-label">ููู ุงูุญุงูุฉ</label>
        <input type="color" id="status_color" class="form-input h-10" value="#3b82f6">
      </div>
      
      <div class="form-group">
        <label for="status_description" class="form-label">ูุตู ุงูุญุงูุฉ</label>
        <textarea id="status_description" rows="3" class="form-textarea" placeholder="ูุตู ูุฎุชุตุฑ ููุญุงูุฉ..."></textarea>
      </div>
      
      <div class="modal-actions">
        <button type="button" onclick="hideModal('addStatusModal')" class="btn-secondary min-h-[44px]">ุฅูุบุงุก</button>
        <button type="submit" class="btn-primary min-h-[44px]">ุฅุถุงูุฉ ุงูุญุงูุฉ</button>
      </div>
    </form>
  </div>
</div>

<script>
// ุชุญุณููุงุช ุงูุฌูุงู ููููุงูุฐ
function initializeMobileModals() {
    // ุชุญุณูู ุฅุบูุงู ุงูููุงูุฐ ุจุงูููุณ
    const modals = document.querySelectorAll('.modal');
    
    modals.forEach(modal => {
        modal.addEventListener('touchstart', function(e) {
            if (e.target === this) {
                this.style.backgroundColor = 'rgba(0, 0, 0, 0.6)';
            }
        });
        
        modal.addEventListener('touchend', function(e) {
            if (e.target === this) {
                this.style.backgroundColor = '';
            }
        });
    });
    
    // ุชุญุณููุงุช ุงูุฃุฒุฑุงุฑ ุฏุงุฎู ุงูููุงูุฐ
    const modalButtons = document.querySelectorAll('.modal-actions button, .form-action-btn, .btn-primary, .btn-secondary, .btn-success, .btn-warning, .btn-outline');
    modalButtons.forEach(button => {
        button.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.95)';
        });
        
        button.addEventListener('touchend', function() {
            this.style.transform = 'scale(1)';
        });
    });
    
    // ุชุญุณููุงุช ุงูุฅุฏุฎุงู ูู ุงูููุงูุฐ
    const modalInputs = document.querySelectorAll('.modal .form-input, .modal .form-select, .modal .form-textarea');
    modalInputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.style.fontSize = '16px'; // ููุน ุงูุชูุจูุฑ ูู iOS
        });
    });
    
    // ุชุญุณููุงุช ุฎุงุตุฉ ุจูุงูุฐุฉ ุงููุฑููุงุช
    const attachmentCards = document.querySelectorAll('.attachment-card-enhanced');
    attachmentCards.forEach(card => {
        card.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.98)';
        });
        
        card.addEventListener('touchend', function() {
            this.style.transform = 'scale(1)';
        });
    });
}

// ุชููุฆุฉ ุชุญุณููุงุช ุงูุฌูุงู ููููุงูุฐ
document.addEventListener('DOMContentLoaded', function() {
    initializeMobileModals();
});

// ุฏุงูุฉ ูุญุณูุฉ ูุฅุธูุงุฑ ุงูููุงูุฐ ูู ุงูุฌูุงู
function showModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.add('active');
        document.body.classList.add('modal-open');
        
        // ุฅุถุงูุฉ ุชุฃุซูุฑ ููุฌูุงู
        if (window.innerWidth < 768) {
            modal.style.padding = '0.5rem';
        }
    }
}

// ุฏุงูุฉ ูุญุณูุฉ ูุฅุฎูุงุก ุงูููุงูุฐ ูู ุงูุฌูุงู
function hideModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.remove('active');
        document.body.classList.remove('modal-open');
    }
}

// ุชุญุณููุงุช ุงูููุณ ูุฒุฑ ุงูุนูุฏุฉ ููุฃุนูู
const scrollToTopBtn = document.getElementById('scrollToTop');
if (scrollToTopBtn) {
    scrollToTopBtn.addEventListener('touchstart', function() {
        this.style.transform = 'scale(0.9)';
    });
    
    scrollToTopBtn.addEventListener('touchend', function() {
        this.style.transform = 'scale(1)';
    });
}

// ุชุญุณููุงุช ุฎุงุตุฉ ุจุงูุดุงุดุงุช ุงูุตุบูุฑุฉ ุฌุฏุงู
function handleVerySmallScreens() {
    const width = window.innerWidth;
    
    if (width < 360) {
        // ุชุนุฏูู ุฃุญุฌุงู ุงูุฎุทูุท ููุดุงุดุงุช ุงูุตุบูุฑุฉ ุฌุฏุงู
        document.querySelectorAll('.modal-header h3').forEach(title => {
            title.classList.add('text-base');
        });
        
        // ุชุนุฏูู padding ููููุงูุฐ
        document.querySelectorAll('.modal-body').forEach(body => {
            body.classList.add('p-3');
        });
    }
}

// ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ ูุชุบููุฑ ุงูุญุฌู
window.addEventListener('load', handleVerySmallScreens);
window.addEventListener('resize', handleVerySmallScreens);
</script>