<!-- templates/settings.html -->
{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto">
  <!-- ุฑุฃุณ ุงูุตูุญุฉ -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white">โ๏ธ ูุฑูุฒ ุงูุชุญูู ูุงูุฅุนุฏุงุฏุงุช ุงูุดุงูู</h1>
      <p class="text-gray-600 dark:text-gray-400 mt-2">ุฅุฏุงุฑุฉ ูุงููุฉ ูููุธุงู ูุงููุณุชุฎุฏููู ูุงูุฅุนุฏุงุฏุงุช ูุงูุตูุงุญูุงุช</p>
    </div>
    
    <div class="flex items-center gap-4">
      <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl px-6 py-3 shadow-lg">
        <div class="text-sm font-medium">ุงููุณุชุฎุฏููู ุงููุดุทูู</div>
        <div class="text-2xl font-bold mt-1">{{ users|length }}</div>
      </div>
    </div>
  </div>

  <!-- ุชุจููุจุงุช ุงูุฅุนุฏุงุฏุงุช -->
  <div class="card p-2 mb-8">
    <div class="flex flex-wrap border-b border-gray-200 dark:border-gray-700">
      <button onclick="showTab('users')" 
              class="tab-btn px-6 py-3 border-b-2 font-medium text-sm transition-colors border-blue-500 text-blue-600 dark:text-blue-400"
              data-tab="users">
        <i class="fas fa-users mr-2"></i>
        ุฅุฏุงุฑุฉ ุงููุฏูุฑูู
      </button>
      <button onclick="showTab('system')" 
              class="tab-btn px-6 py-3 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 dark:text-gray-400"
              data-tab="system">
        <i class="fas fa-cog mr-2"></i>
        ุฅุนุฏุงุฏุงุช ุงููุธุงู
      </button>
      <button onclick="showTab('statuses')" 
              class="tab-btn px-6 py-3 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 dark:text-gray-400"
              data-tab="statuses">
        <i class="fas fa-tags mr-2"></i>
        ุญุงูุงุช ุงูุทูุจูุงุช
      </button>
      <button onclick="showTab('suppliers')" 
              class="tab-btn px-6 py-3 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 dark:text-gray-400"
              data-tab="suppliers">
        <i class="fas fa-truck mr-2"></i>
        ุฅุฏุงุฑุฉ ุงูููุฑุฏูู
      </button>
      <button onclick="showTab('products')" 
              class="tab-btn px-6 py-3 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 dark:text-gray-400"
              data-tab="products">
        <i class="fas fa-box mr-2"></i>
        ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช
      </button>
      <button onclick="showTab('categories')" 
              class="tab-btn px-6 py-3 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 dark:text-gray-400"
              data-tab="categories">
        <i class="fas fa-folder mr-2"></i>
        ุงูุชุตูููุงุช
      </button>
      <button onclick="showTab('workers')" 
              class="tab-btn px-6 py-3 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 dark:text-gray-400"
              data-tab="workers">
        <i class="fas fa-user-cog mr-2"></i>
        ุฅุฏุงุฑุฉ ุงูุนูุงู
      </button>
      <button onclick="showTab('backup')" 
              class="tab-btn px-6 py-3 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 dark:text-gray-400"
              data-tab="backup">
        <i class="fas fa-database mr-2"></i>
        ุงููุณุฎ ุงูุงุญุชูุงุทู
      </button>
    </div>
  </div>

  <!-- ูุญุชูู ุงูุชุจููุจุงุช -->
  <div id="tabContent">
    
    <!-- ุชุจููุจ ุฅุฏุงุฑุฉ ุงููุฏูุฑูู -->
    <div id="users-tab" class="tab-content active">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
        <div>
          <h3 class="text-xl font-bold text-gray-900 dark:text-white">๐ฅ ุฅุฏุงุฑุฉ ูุฏูุฑู ุงููุธุงู</h3>
          <p class="text-gray-600 dark:text-gray-400 mt-1">ุฅุฏุงุฑุฉ ุญุณุงุจุงุช ูุฏูุฑู ุงููุธุงู ูุงูุตูุงุญูุงุช - ุฌููุน ุงููุฏูุฑูู ููุง ูุฏููู ุตูุงุญูุงุช ูุงููุฉ</p>
        </div>
        <div class="flex gap-2">
          <div class="relative">
            <input type="text" id="usersSearch" placeholder="ุจุญุซ ูู ุงููุฏูุฑูู..." 
                   class="form-input pr-10 dark:bg-gray-700 dark:border-gray-600 dark:text-white" onkeyup="searchTable('usersSearch', 'usersTable')">
            <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <button onclick="showModal('addUserModal')" class="btn-success flex items-center gap-2">
            <i class="fas fa-user-plus"></i>
            ุฅุถุงูุฉ ูุฏูุฑ ุดุงูู
          </button>
        </div>
      </div>

      <!-- ุฅุญุตุงุฆูุงุช ุงููุฏูุฑูู -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-blue-600">{{ users|length }}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ุฅุฌูุงูู ุงููุฏูุฑูู</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-green-600">{{ users|selectattr('is_active', 'equalto', true)|list|length }}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ูุดุทูู</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-purple-600">{{ users|selectattr('last_login')|list|length }}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ุฏุฎููุง ุงููุธุงู</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-orange-600">{{ users|rejectattr('is_active')|list|length }}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ุบูุฑ ูุดุทูู</div>
        </div>
      </div>

      <!-- ุฌุฏูู ุงููุฏูุฑูู -->
      <div class="table-container">
        <table class="w-full" id="usersTable">
          <thead class="table-header dark:bg-gray-800">
            <tr>
              <th class="p-4 text-right cursor-pointer" onclick="sortTable('usersTable', 0)"># <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 text-right cursor-pointer" onclick="sortTable('usersTable', 1)">ุงููุฏูุฑ <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 text-right">ูุนูููุงุช ุงูุงุชุตุงู</th>
              <th class="p-4 text-right cursor-pointer" onclick="sortTable('usersTable', 3)">ุงูุฏูุฑ <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 text-right cursor-pointer" onclick="sortTable('usersTable', 4)">ุงูุญุงูุฉ <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 text-right cursor-pointer" onclick="sortTable('usersTable', 5)">ุขุฎุฑ ูุดุงุท <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 text-right">ุงูุนูููุงุช</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors border-b border-gray-100 dark:border-gray-600">
              <td class="p-4">
                <div class="font-mono text-sm text-gray-500 dark:text-gray-400">#{{ user.id }}</div>
              </td>
              
              <td class="p-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-semibold">
                    {{ user.username[0]|upper }}
                  </div>
                  <div>
                    <div class="font-semibold text-gray-900 dark:text-white">{{ user.username }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">{{ user.full_name or "ุจุฏูู ุงุณู" }}</div>
                  </div>
                </div>
              </td>
              
              <td class="p-4">
                <div class="space-y-1 text-sm">
                  <div class="text-gray-600 dark:text-gray-300 flex items-center gap-2">
                    <i class="fas fa-envelope text-gray-400"></i>
                    {{ user.email or "ุจุฏูู ุจุฑูุฏ" }}
                  </div>
                  <div class="text-gray-500 dark:text-gray-400 flex items-center gap-2">
                    <i class="fas fa-phone text-gray-400"></i>
                    {{ user.phone or "ุจุฏูู ูุงุชู" }}
                  </div>
                </div>
              </td>
              
              <td class="p-4">
                <div class="space-y-2">
                  <span class="badge badge-success">
                    <i class="fas fa-crown ml-1"></i>
                    ูุฏูุฑ ุดุงูู
                  </span>
                  <div class="text-xs text-gray-500 dark:text-gray-400">
                    ุฌููุน ุงูุตูุงุญูุงุช
                  </div>
                </div>
              </td>
              
              <td class="p-4">
                {% if user.is_active %}
                <span class="badge badge-success flex items-center gap-1 w-fit">
                  <i class="fas fa-check-circle"></i>
                  ูุดุท
                </span>
                {% else %}
                <span class="badge badge-danger flex items-center gap-1 w-fit">
                  <i class="fas fa-pause-circle"></i>
                  ุบูุฑ ูุดุท
                </span>
                {% endif %}
              </td>
              
              <td class="p-4">
                <div class="text-sm text-gray-600 dark:text-gray-300">
                  {% if user.last_login %}
                  <div>{{ user.last_login.strftime('%Y-%m-%d') }}</div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">{{ user.last_login.strftime('%H:%M') }}</div>
                  {% else %}
                  <span class="text-gray-400">ูู ูุณุฌู ุฏุฎูู</span>
                  {% endif %}
                </div>
              </td>
              
              <td class="p-4">
                <div class="flex flex-col gap-2 min-w-[120px]">
                  <!-- ุฒุฑ ุงูุชุนุฏูู -->
                  <button onclick="editUser({{ user.id }})" 
                          class="flex items-center gap-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 p-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors text-sm">
                    <i class="fas fa-edit text-xs"></i>
                    ุชุนุฏูู
                  </button>
                  
                  <!-- ุฒุฑ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ -->
                  <button onclick="resetUserPassword({{ user.id }}, '{{ user.username }}')"
                         class="flex items-center gap-2 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300 p-2 rounded-lg hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors text-sm">
                    <i class="fas fa-key text-xs"></i>
                    ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ
                  </button>
                  
                  <!-- ุฒุฑ ุฅููุงู/ุชูุนูู -->
                  {% if user.username != session.user %}
                  <button onclick="toggleUserStatus({{ user.id }}, {{ user.is_active|lower }})"
                         class="flex items-center gap-2 {% if user.is_active %}text-orange-600 hover:text-orange-800 dark:text-orange-400 dark:hover:text-orange-300{% else %}text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300{% endif %} p-2 rounded-lg hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-colors text-sm">
                    <i class="fas {% if user.is_active %}fa-pause{% else %}fa-play{% endif %} text-xs"></i>
                    {{ "ุฅููุงู" if user.is_active else "ุชูุนูู" }}
                  </button>
                  
                  <!-- ุฒุฑ ุงูุญุฐู -->
                  <button onclick="confirmDeleteUser({{ user.id }}, '{{ user.username }}')"
                         class="flex items-center gap-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors text-sm">
                    <i class="fas fa-trash text-xs"></i>
                    ุญุฐู
                  </button>
                  {% else %}
                  <span class="text-gray-400 text-sm p-2 text-center">ุญุณุงุจู ุงูุญุงูู</span>
                  {% endif %}
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- ุฑุณุงูุฉ ุฅุฐุง ูู ููู ููุงู ูุฏูุฑูู -->
      {% if not users %}
      <div class="card p-8 text-center">
        <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">ูุง ููุฌุฏ ูุฏูุฑูู</h3>
        <p class="text-gray-500 dark:text-gray-400 mb-4">ุงุจุฏุฃ ุจุฅุถุงูุฉ ุฃูู ูุฏูุฑ ุดุงูู ุฅูู ุงููุธุงู</p>
        <button onclick="showModal('addUserModal')" class="btn-primary">
          <i class="fas fa-user-plus ml-2"></i>
          ุฅุถุงูุฉ ุฃูู ูุฏูุฑ ุดุงูู
        </button>
      </div>
      {% endif %}
    </div>

    <!-- ุชุจููุจ ุฅุนุฏุงุฏุงุช ุงููุธุงู -->
    <div id="system-tab" class="tab-content">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
              <i class="fas fa-globe text-blue-600 dark:text-blue-400 text-xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">ุฅุนุฏุงุฏุงุช ุฃุณุงุณูุฉ ูููุธุงู</p>
            </div>
          </div>
          
          <form method="POST" action="{{ url_for('update_system_settings') }}" class="space-y-6" id="generalSettingsForm">
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  <i class="fas fa-building ml-2 text-gray-400"></i>
                  ุงุณู ุงูุดุฑูุฉ
                </label>
                <input type="text" name="company_name" value="{{ settings.company_name if settings else 'SOFAZI' }}" 
                       class="form-input dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="ุงุณู ุงูุดุฑูุฉ ุฃู ุงููุคุณุณุฉ" required>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ุงูุนููุฉ</label>
                  <select name="currency" class="form-select dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <option value="DZD" {% if settings and settings.currency == 'DZD' %}selected{% endif %}>ุฏููุงุฑ ุฌุฒุงุฆุฑู (DZD)</option>
                    <option value="USD" {% if settings and settings.currency == 'USD' %}selected{% endif %}>ุฏููุงุฑ ุฃูุฑููู (USD)</option>
                    <option value="EUR" {% if settings and settings.currency == 'EUR' %}selected{% endif %}>ููุฑู (EUR)</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ุงููุบุฉ</label>
                  <select name="language" class="form-select dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <option value="ar" {% if settings and settings.language == 'ar' %}selected{% endif %}>ุงูุนุฑุจูุฉ</option>
                    <option value="en" {% if settings and settings.language == 'en' %}selected{% endif %}>English</option>
                    <option value="fr" {% if settings and settings.language == 'fr' %}selected{% endif %}>Franรงais</option>
                  </select>
                </div>
              </div>
            </div>
            
            <button type="submit" class="btn-primary w-full flex items-center justify-center gap-2">
              <i class="fas fa-save"></i>
              ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ
            </button>
          </form>
        </div>

        <!-- ุฅุนุฏุงุฏุงุช ุงูุฃูุงู -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center">
              <i class="fas fa-shield-alt text-red-600 dark:text-red-400 text-xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">ุฅุนุฏุงุฏุงุช ุงูุฃูุงู</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">ุญูุงูุฉ ุงููุธุงู ูุงูุญุณุงุจุงุช</p>
            </div>
          </div>
          
          <form method="POST" action="{{ url_for('update_security_settings') }}" class="space-y-6" id="securitySettingsForm">
            <div class="space-y-4">
              <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div>
                  <div class="font-medium text-gray-900 dark:text-white">ุงูุชุญูู ุจุฎุทูุชูู</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">ุฒูุงุฏุฉ ุฃูุงู ุญุณุงุจุงุช ุงููุณุชุฎุฏููู</div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" name="two_factor" value="on" class="sr-only peer" {% if settings and settings.two_factor %}checked{% endif %}>
                  <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
              </div>
              
              <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div>
                  <div class="font-medium text-gray-900 dark:text-white">ุชุณุฌูู ุงููุดุงุท</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">ุชุณุฌูู ุฌููุน ุนูููุงุช ุงูุฏุฎูู ูุงููุดุงุทุงุช</div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" name="activity_logging" value="on" class="sr-only peer" {% if settings and settings.activity_logging %}checked{% endif %}>
                  <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ูุฏุฉ ุงูุชูุงุก ุงูุฌูุณุฉ (ุฏูุงุฆู)</label>
                <input type="number" name="session_timeout" value="{{ settings.session_timeout if settings else 30 }}" 
                       class="form-input dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="5" max="1440" required>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ุงููุฏุฉ ูุจู ุงูุชูุงุก ุฌูุณุฉ ุงููุณุชุฎุฏู ุชููุงุฆูุงู</p>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ููุฉ ูููุฉ ุงููุฑูุฑ</label>
                <select name="password_strength" class="form-select dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                  <option value="low" {% if settings and settings.password_strength == 'low' %}selected{% endif %}>ููุฎูุถุฉ (6 ุฃุญุฑู)</option>
                  <option value="medium" {% if settings and settings.password_strength == 'medium' %}selected{% endif %}>ูุชูุณุทุฉ (8 ุฃุญุฑู + ุฃุฑูุงู)</option>
                  <option value="high" {% if settings and settings.password_strength == 'high' %}selected{% endif %}>ุนุงููุฉ (10 ุฃุญุฑู + ุฃุฑูุงู + ุฑููุฒ)</option>
                </select>
              </div>
            </div>
            
            <button type="submit" class="btn-primary w-full flex items-center justify-center gap-2">
              <i class="fas fa-shield-alt"></i>
              ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุฃูุงู
            </button>
          </form>
        </div>

        <!-- ุฅุนุฏุงุฏุงุช ุงููุงุฌูุฉ -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
              <i class="fas fa-palette text-purple-600 dark:text-purple-400 text-xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">ุฅุนุฏุงุฏุงุช ุงููุงุฌูุฉ</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">ุชุฎุตูุต ูุธูุฑ ุงููุธุงู</p>
            </div>
          </div>
          
          <form method="POST" action="{{ url_for('update_ui_settings') }}" class="space-y-6" id="uiSettingsForm">
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ุงูุณูุฉ</label>
                <select name="theme" class="form-select dark:bg-gray-700 dark:border-gray-600 dark:text-white" onchange="previewTheme(this.value)">
                  <option value="light" {% if settings and settings.theme == 'light' %}selected{% endif %}>ูุงุชุญุฉ</option>
                  <option value="dark" {% if settings and settings.theme == 'dark' %}selected{% endif %}>ุฏุงููุฉ</option>
                  <option value="auto" {% if settings and settings.theme == 'auto' %}selected{% endif %}>ุชููุงุฆูุฉ</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ุงูููู ุงูุฃุณุงุณู</label>
                <div class="flex gap-3 items-center">
                  <input type="color" name="primary_color" value="{{ settings.primary_color if settings else '#3B82F6' }}" 
                         class="w-12 h-12 rounded cursor-pointer border dark:border-gray-600" id="colorPicker">
                  <input type="text" name="primary_color_hex" value="{{ settings.primary_color if settings else '#3B82F6' }}" 
                         class="form-input flex-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="#3B82F6" id="colorText" maxlength="7">
                  <div class="w-8 h-8 rounded border dark:border-gray-600" id="colorPreview" style="background-color: {{ settings.primary_color if settings else '#3B82F6' }}"></div>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ุนุฏุฏ ุงูุตููู ูู ุงูุฌุฏุงูู</label>
                <select name="rows_per_page" class="form-select dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                  <option value="10" {% if settings and settings.rows_per_page == 10 %}selected{% endif %}>10 ุตููู</option>
                  <option value="25" {% if settings and settings.rows_per_page == 25 %}selected{% endif %}>25 ุตู</option>
                  <option value="50" {% if settings and settings.rows_per_page == 50 %}selected{% endif %}>50 ุตู</option>
                  <option value="100" {% if settings and settings.rows_per_page == 100 %}selected{% endif %}>100 ุตู</option>
                </select>
              </div>
              
              <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div>
                  <div class="font-medium text-gray-900 dark:text-white">ูุถุน ุงูุถุบุท</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">ุฅุธูุงุฑ ูุงุฌูุฉ ูุฏูุฌุฉ</div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" name="compact_mode" value="on" class="sr-only peer" {% if settings and settings.compact_mode %}checked{% endif %}>
                  <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
              </div>
            </div>
            
            <button type="submit" class="btn-primary w-full flex items-center justify-center gap-2">
              <i class="fas fa-palette"></i>
              ุญูุธ ุฅุนุฏุงุฏุงุช ุงููุงุฌูุฉ
            </button>
          </form>
        </div>

        <!-- ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
              <i class="fas fa-bell text-green-600 dark:text-green-400 text-xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">ุงูุชุญูู ูู ุงูุฅุดุนุงุฑุงุช ูุงูุชูุจููุงุช</p>
            </div>
          </div>
          
          <form method="POST" action="{{ url_for('update_notification_settings') }}" class="space-y-6" id="notificationSettingsForm">
            <div class="space-y-4">
              <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div>
                  <div class="font-medium text-gray-900 dark:text-white">ุฅุดุนุงุฑุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" name="email_notifications" value="on" class="sr-only peer" {% if settings and settings.email_notifications %}checked{% endif %}>
                  <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
              </div>
              
              <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div>
                  <div class="font-medium text-gray-900 dark:text-white">ุฅุดุนุงุฑุงุช ุงูุฏูุน</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">ุฅุดุนุงุฑุงุช ุจููุงุนูุฏ ุงูุฏูุน ูุงูุฏููู</div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" name="payment_notifications" value="on" class="sr-only peer" {% if settings and settings.payment_notifications %}checked{% endif %}>
                  <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
              </div>
              
              <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div>
                  <div class="font-medium text-gray-900 dark:text-white">ุฅุดุนุงุฑุงุช ุงููุฎุฒูู</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">ุชูุจููุงุช ุจููุงุฏ ุงูููุชุฌุงุช</div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" name="inventory_notifications" value="on" class="sr-only peer" {% if settings and settings.inventory_notifications %}checked{% endif %}>
                  <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ุชูููุช ุงูุฅุดุนุงุฑุงุช</label>
                <select name="notification_time" class="form-select dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                  <option value="instant" {% if settings and settings.notification_time == 'instant' %}selected{% endif %}>ููุฑู</option>
                  <option value="daily" {% if settings and settings.notification_time == 'daily' %}selected{% endif %}>ูููู</option>
                  <option value="weekly" {% if settings and settings.notification_time == 'weekly' %}selected{% endif %}>ุฃุณุจูุนู</option>
                </select>
              </div>
            </div>
            
            <button type="submit" class="btn-primary w-full flex items-center justify-center gap-2">
              <i class="fas fa-bell"></i>
              ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช
            </button>
          </form>
        </div>
      </div>

      <!-- ุฅุนุฏุงุฏุงุช ูุชูุฏูุฉ -->
      <div class="card p-6 mt-8">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center">
            <i class="fas fa-cogs text-orange-600 dark:text-orange-400 text-xl"></i>
          </div>
          <div>
            <h3 class="text-xl font-bold text-gray-900 dark:text-white">ุงูุฅุนุฏุงุฏุงุช ุงููุชูุฏูุฉ</h3>
            <p class="text-gray-600 dark:text-gray-400 text-sm">ุฅุนุฏุงุฏุงุช ูุชูุฏูุฉ ูููุธุงู</p>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-4">
            <button type="button" onclick="clearSystemCache()" class="w-full btn-warning flex items-center justify-center gap-2">
              <i class="fas fa-broom"></i>
              ูุณุญ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช
            </button>
            
            <button type="button" onclick="exportSystemData()" class="w-full btn-success flex items-center justify-center gap-2">
              <i class="fas fa-download"></i>
              ุชุตุฏูุฑ ุจูุงูุงุช ุงููุธุงู
            </button>
          </div>
          
          <div class="space-y-4">
            <button type="button" onclick="showSystemLogs()" class="w-full btn-info flex items-center justify-center gap-2">
              <i class="fas fa-file-alt"></i>
              ุนุฑุถ ุณุฌูุงุช ุงููุธุงู
            </button>
            
            <button type="button" onclick="showDatabaseInfo()" class="w-full btn-primary flex items-center justify-center gap-2">
              <i class="fas fa-database"></i>
              ูุนูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ุชุจููุจ ุญุงูุงุช ุงูุทูุจูุงุช -->
    <div id="statuses-tab" class="tab-content">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
        <div>
          <h3 class="text-xl font-bold text-gray-900 dark:text-white">๐ท๏ธ ุฅุฏุงุฑุฉ ุญุงูุงุช ุงูุทูุจูุงุช</h3>
          <p class="text-gray-600 dark:text-gray-400 mt-1">ุฅุถุงูุฉ ูุชุนุฏูู ุญุงูุงุช ุงูุทูุจูุงุช ูู ุงููุธุงู</p>
        </div>
        <div class="flex gap-2">
          <div class="relative">
            <input type="text" id="statusesSearch" placeholder="ุจุญุซ ูู ุงูุญุงูุงุช..." 
                   class="form-input pr-10 dark:bg-gray-700 dark:border-gray-600 dark:text-white" onkeyup="searchTable('statusesSearch', 'statusesTable')">
            <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
        </div>
      </div>

      <!-- ูููุฐุฌ ุฅุถุงูุฉ ุญุงูุฉ -->
      <div class="card p-6 mb-6">
        <h4 class="font-medium mb-4 flex items-center gap-2 text-gray-900 dark:text-white">
          <i class="fas fa-plus-circle text-green-600"></i>
          ุฅุถุงูุฉ ุญุงูุฉ ุฌุฏูุฏุฉ
        </h4>
        <form method="POST" action="{{ url_for('add_status') }}" class="flex flex-col md:flex-row gap-3" id="addStatusForm">
          <div class="flex-1">
            <input name="name" placeholder="ุงุณู ุงูุญุงูุฉ (ูุซุงู: ููุฏ ุงูุชูููุฐ)" required 
                   class="form-input w-full dark:bg-gray-700 dark:border-gray-600 dark:text-white" pattern=".{2,50}" title="ูุฌุจ ุฃู ูููู ุงูุงุณู ุจูู 2 ู 50 ุญุฑู">
          </div>
          <div class="flex gap-2">
            <input name="color" type="color" value="#FFC107" class="w-16 h-12 rounded cursor-pointer border dark:border-gray-600">
            <button type="submit" class="btn-warning flex items-center gap-2">
              <i class="fas fa-plus"></i>
              ุฅุถุงูุฉ
            </button>
          </div>
        </form>
      </div>

      <!-- ุฌุฏูู ุงูุญุงูุงุช -->
      <div class="table-container">
        <table class="w-full" id="statusesTable">
          <thead class="table-header dark:bg-gray-800">
            <tr>
              <th class="p-4 cursor-pointer" onclick="sortTable('statusesTable', 0)"># <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 cursor-pointer" onclick="sortTable('statusesTable', 1)">ุงูุงุณู <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4">ุงูููู</th>
              <th class="p-4 cursor-pointer" onclick="sortTable('statusesTable', 3)">ุนุฏุฏ ุงูุทูุจูุงุช <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4">ุงูููุน</th>
              <th class="p-4">ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody>
            {% for s in statuses %}
            <tr class="border-t hover:bg-gray-50 dark:hover:bg-gray-700 dark:border-gray-600">
              <td class="p-4 font-mono text-sm text-gray-500 dark:text-gray-400">#{{ s.id }}</td>
              <td class="p-4 font-medium text-gray-900 dark:text-white">{{ s.name }}</td>
              <td class="p-4">
                <div class="flex items-center gap-2">
                  <div class="w-6 h-6 rounded border dark:border-gray-600" style="background:{{ s.color }}"></div>
                  <span class="text-sm font-mono text-gray-500 dark:text-gray-400">{{ s.color }}</span>
                </div>
              </td>
              <td class="p-4 text-center">
                <span class="badge {% if s.orders|length > 0 %}badge-info{% else %}badge-gray{% endif %}">
                  {{ s.orders|length }}
                </span>
              </td>
              <td class="p-4">
                {% if s.is_system %}
                <span class="badge badge-warning">ูุธุงู</span>
                {% else %}
                <span class="badge badge-success">ูุฎุตุต</span>
                {% endif %}
              </td>
              <td class="p-4">
                {% if not s.is_system %}
                <div class="flex flex-col gap-2">
                  <button onclick="editStatus({{ s.id }})" class="btn-warning text-sm flex items-center gap-1">
                    <i class="fas fa-edit"></i>
                    ุชุนุฏูู
                  </button>
                  <button onclick="confirmDeleteStatus({{ s.id }}, '{{ s.name }}')" 
                         class="btn-danger text-sm flex items-center gap-1" {% if s.orders|length > 0 %}disabled title="ูุง ูููู ุญุฐู ุญุงูุฉ ูุฑุชุจุทุฉ ุจุทูุจูุงุช"{% endif %}>
                    <i class="fas fa-trash"></i>
                    ุญุฐู
                  </button>
                </div>
                {% else %}
                <span class="text-gray-400 text-sm">ุญุงูุฉ ูุธุงู</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- ุฑุณุงูุฉ ุฅุฐุง ูู ููู ููุงู ุญุงูุงุช -->
      {% if not statuses %}
      <div class="card p-8 text-center">
        <i class="fas fa-tags text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">ูุง ุชูุฌุฏ ุญุงูุงุช</h3>
        <p class="text-gray-500 dark:text-gray-400 mb-4">ุงุจุฏุฃ ุจุฅุถุงูุฉ ุฃูู ุญุงูุฉ ุฅูู ุงููุธุงู</p>
      </div>
      {% endif %}
    </div>

    <!-- ุชุจููุจ ุฅุฏุงุฑุฉ ุงูููุฑุฏูู -->
    <div id="suppliers-tab" class="tab-content">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
        <div>
          <h3 class="text-xl font-bold text-gray-900 dark:text-white">๐ข ุฅุฏุงุฑุฉ ุงูููุฑุฏูู</h3>
          <p class="text-gray-600 dark:text-gray-400 mt-1">ุฅุฏุงุฑุฉ ููุฑุฏูู ุงูููุงุฏ ูุงูููุชุฌุงุช</p>
        </div>
        <div class="flex gap-2">
          <div class="relative">
            <input type="text" id="suppliersSearch" placeholder="ุจุญุซ ูู ุงูููุฑุฏูู..." 
                   class="form-input pr-10 dark:bg-gray-700 dark:border-gray-600 dark:text-white" onkeyup="searchTable('suppliersSearch', 'suppliersTable')">
            <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <button onclick="showModal('addSupplierModal')" class="btn-success flex items-center gap-2">
            <i class="fas fa-plus"></i>
            ุฅุถุงูุฉ ููุฑุฏ
          </button>
        </div>
      </div>

      <!-- ุฅุญุตุงุฆูุงุช ุงูููุฑุฏูู -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-blue-600">{{ suppliers|length }}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ุฅุฌูุงูู ุงูููุฑุฏูู</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-green-600">
            {{ suppliers|selectattr('supplier_purchases')|selectattr('supplier_purchases', 'length')|sum }}
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ุฅุฌูุงูู ุงููุดุชุฑูุงุช</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-purple-600">
            {{ suppliers|map(attribute='phone')|select|list|length }}
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ููุฑุฏูู ุจูุงุชู</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-orange-600">
            {{ suppliers|map(attribute='address')|select|list|length }}
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ููุฑุฏูู ุจุนููุงู</div>
        </div>
      </div>

      <!-- ุฌุฏูู ุงูููุฑุฏูู -->
      <div class="table-container">
        <table class="w-full" id="suppliersTable">
          <thead class="table-header dark:bg-gray-800">
            <tr>
              <th class="p-4 cursor-pointer" onclick="sortTable('suppliersTable', 0)"># <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 cursor-pointer" onclick="sortTable('suppliersTable', 1)">ุงุณู ุงูููุฑุฏ <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4">ูุนูููุงุช ุงูุงุชุตุงู</th>
              <th class="p-4 cursor-pointer" onclick="sortTable('suppliersTable', 3)">ุนุฏุฏ ุงููุดุชุฑูุงุช <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4">ุชุงุฑูุฎ ุงูุฅุถุงูุฉ</th>
              <th class="p-4">ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody>
            {% for supplier in suppliers %}
            <tr class="border-t hover:bg-gray-50 dark:hover:bg-gray-700 dark:border-gray-600">
              <td class="p-4 font-mono text-sm text-gray-500 dark:text-gray-400">#{{ supplier.id }}</td>
              <td class="p-4">
                <div class="font-semibold text-gray-900 dark:text-white">{{ supplier.name }}</div>
              </td>
              <td class="p-4">
                <div class="space-y-1 text-sm">
                  {% if supplier.phone %}
                  <div class="text-gray-600 dark:text-gray-300 flex items-center gap-2">
                    <i class="fas fa-phone text-gray-400"></i>
                    {{ supplier.phone }}
                  </div>
                  {% endif %}
                  {% if supplier.address %}
                  <div class="text-gray-500 dark:text-gray-400 flex items-center gap-2">
                    <i class="fas fa-map-marker-alt text-gray-400"></i>
                    {{ supplier.address }}
                  </div>
                  {% endif %}
                </div>
              </td>
              <td class="p-4 text-center">
                <span class="badge {% if supplier.supplier_purchases|length > 0 %}badge-info{% else %}badge-gray{% endif %}">
                  {{ supplier.supplier_purchases|length }}
                </span>
              </td>
              <td class="p-4 text-sm text-gray-600 dark:text-gray-400">
                {{ supplier.created_at.strftime('%Y-%m-%d') }}
              </td>
              <td class="p-4">
                <div class="flex flex-col gap-2">
                  <button onclick="editSupplier({{ supplier.id }})" class="btn-warning text-sm flex items-center gap-1">
                    <i class="fas fa-edit"></i>
                    ุชุนุฏูู
                  </button>
                  <button onclick="confirmDeleteSupplier({{ supplier.id }}, '{{ supplier.name }}')" 
                         class="btn-danger text-sm flex items-center gap-1" 
                         {% if supplier.supplier_purchases|length > 0 %}disabled title="ูุง ูููู ุญุฐู ููุฑุฏ ูุฑุชุจุท ุจูุดุชุฑูุงุช"{% endif %}>
                    <i class="fas fa-trash"></i>
                    ุญุฐู
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- ุฑุณุงูุฉ ุฅุฐุง ูู ููู ููุงู ููุฑุฏูู -->
      {% if not suppliers %}
      <div class="card p-8 text-center">
        <i class="fas fa-truck text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">ูุง ููุฌุฏ ููุฑุฏูู</h3>
        <p class="text-gray-500 dark:text-gray-400 mb-4">ุงุจุฏุฃ ุจุฅุถุงูุฉ ุฃูู ููุฑุฏ ุฅูู ุงููุธุงู</p>
        <button onclick="showModal('addSupplierModal')" class="btn-primary">
          <i class="fas fa-plus ml-2"></i>
          ุฅุถุงูุฉ ุฃูู ููุฑุฏ
        </button>
      </div>
      {% endif %}
    </div>

    <!-- ุชุจููุจ ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช -->
    <div id="products-tab" class="tab-content">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
        <div>
          <h3 class="text-xl font-bold text-gray-900 dark:text-white">๐ฆ ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</h3>
          <p class="text-gray-600 dark:text-gray-400 mt-1">ุฅุฏุงุฑุฉ ููุชุฌุงุช ูููุงุฏ ุงููุธุงู</p>
        </div>
        <div class="flex gap-2">
          <div class="relative">
            <input type="text" id="productsSearch" placeholder="ุจุญุซ ูู ุงูููุชุฌุงุช..." 
                   class="form-input pr-10 dark:bg-gray-700 dark:border-gray-600 dark:text-white" onkeyup="searchTable('productsSearch', 'productsTable')">
            <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <button onclick="showModal('addProductModal')" class="btn-success flex items-center gap-2">
            <i class="fas fa-plus"></i>
            ุฅุถุงูุฉ ููุชุฌ
          </button>
        </div>
      </div>

      <!-- ุฌุฏูู ุงูููุชุฌุงุช -->
      <div class="table-container">
        <table class="w-full" id="productsTable">
          <thead class="table-header dark:bg-gray-800">
            <tr>
              <th class="p-4 cursor-pointer" onclick="sortTable('productsTable', 0)"># <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 cursor-pointer" onclick="sortTable('productsTable', 1)">ุงุณู ุงูููุชุฌ <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 cursor-pointer" onclick="sortTable('productsTable', 2)">ุงูุชุตููู <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 cursor-pointer" onclick="sortTable('productsTable', 3)">ุนุฏุฏ ุงููุดุชุฑูุงุช <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4">ุชุงุฑูุฎ ุงูุฅุถุงูุฉ</th>
              <th class="p-4">ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody>
            {% for product in products %}
            <tr class="border-t hover:bg-gray-50 dark:hover:bg-gray-700 dark:border-gray-600">
              <td class="p-4 font-mono text-sm text-gray-500 dark:text-gray-400">#{{ product.id }}</td>
              <td class="p-4">
                <div class="font-semibold text-gray-900 dark:text-white">{{ product.name }}</div>
              </td>
              <td class="p-4">
                {% if product.category %}
                <span class="badge" style="background: {{ product.category.color }}; color: white;">
                  <i class="fas {{ product.category.icon }} ml-1"></i>
                  {{ product.category.name }}
                </span>
                {% else %}
                <span class="text-gray-500 dark:text-gray-400 text-sm">ุจุฏูู ุชุตููู</span>
                {% endif %}
              </td>
              <td class="p-4 text-center">
                <span class="badge {% if product.product_purchases|length > 0 %}badge-info{% else %}badge-gray{% endif %}">
                  {{ product.product_purchases|length }}
                </span>
              </td>
              <td class="p-4 text-sm text-gray-600 dark:text-gray-400">
                {{ product.created_at.strftime('%Y-%m-%d') }}
              </td>
              <td class="p-4">
                <div class="flex flex-col gap-2">
                  <button onclick="editProduct({{ product.id }})" class="btn-warning text-sm flex items-center gap-1">
                    <i class="fas fa-edit"></i>
                    ุชุนุฏูู
                  </button>
                  <button onclick="confirmDeleteProduct({{ product.id }}, '{{ product.name }}')" 
                         class="btn-danger text-sm flex items-center gap-1"
                         {% if product.product_purchases|length > 0 %}disabled title="ูุง ูููู ุญุฐู ููุชุฌ ูุฑุชุจุท ุจูุดุชุฑูุงุช"{% endif %}>
                    <i class="fas fa-trash"></i>
                    ุญุฐู
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- ุฑุณุงูุฉ ุฅุฐุง ูู ููู ููุงู ููุชุฌุงุช -->
      {% if not products %}
      <div class="card p-8 text-center">
        <i class="fas fa-box text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">ูุง ููุฌุฏ ููุชุฌุงุช</h3>
        <p class="text-gray-500 dark:text-gray-400 mb-4">ุงุจุฏุฃ ุจุฅุถุงูุฉ ุฃูู ููุชุฌ ุฅูู ุงููุธุงู</p>
        <button onclick="showModal('addProductModal')" class="btn-primary">
          <i class="fas fa-plus ml-2"></i>
          ุฅุถุงูุฉ ุฃูู ููุชุฌ
        </button>
      </div>
      {% endif %}
    </div>

    <!-- ุชุจููุจ ุงูุชุตูููุงุช -->
    <div id="categories-tab" class="tab-content">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
        <div>
          <h3 class="text-xl font-bold text-gray-900 dark:text-white">๐ ุฅุฏุงุฑุฉ ุงูุชุตูููุงุช</h3>
          <p class="text-gray-600 dark:text-gray-400 mt-1">ุฅุฏุงุฑุฉ ุชุตูููุงุช ุงููุตุงุฑูู ูุงูููุชุฌุงุช</p>
        </div>
        <div class="flex gap-2">
          <div class="relative">
            <input type="text" id="categoriesSearch" placeholder="ุจุญุซ ูู ุงูุชุตูููุงุช..." 
                   class="form-input pr-10 dark:bg-gray-700 dark:border-gray-600 dark:text-white" onkeyup="searchTable('categoriesSearch', 'categoriesTable')">
            <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <button onclick="showModal('addCategoryModal')" class="btn-success flex items-center gap-2">
            <i class="fas fa-plus"></i>
            ุฅุถุงูุฉ ุชุตููู
          </button>
        </div>
      </div>

      <!-- ุดุจูุฉ ุงูุชุตูููุงุช -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="categoriesTable">
        {% for category in expense_categories %}
        <div class="card p-6 hover:shadow-lg transition-all duration-300">
          <div class="flex items-center gap-4 mb-4">
            <div class="text-3xl">{{ category.icon }}</div>
            <div class="flex-1">
              <h4 class="font-semibold text-lg text-gray-900 dark:text-white">{{ category.name }}</h4>
              <p class="text-sm text-gray-600 dark:text-gray-400">{{ category.category_expenses|length }} ูุตุฑูู</p>
            </div>
          </div>
          
          <div class="flex items-center justify-between mb-4">
            <div class="w-8 h-8 rounded border dark:border-gray-600" style="background: {{ category.color }}"></div>
            <span class="text-sm font-mono text-gray-500 dark:text-gray-400">{{ category.color }}</span>
          </div>
          
          <div class="flex gap-2">
            <button onclick="editCategory({{ category.id }})" class="btn-warning flex-1 flex items-center justify-center gap-1">
              <i class="fas fa-edit"></i>
              ุชุนุฏูู
            </button>
            <button onclick="confirmDeleteCategory({{ category.id }}, '{{ category.name }}')" 
                   class="btn-danger flex items-center justify-center gap-1 px-3"
                   {% if category.category_expenses|length > 0 %}disabled title="ูุง ูููู ุญุฐู ุชุตููู ูุฑุชุจุท ุจูุตุงุฑูู"{% endif %}>
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- ุฑุณุงูุฉ ุฅุฐุง ูู ููู ููุงู ุชุตูููุงุช -->
      {% if not expense_categories %}
      <div class="card p-8 text-center">
        <i class="fas fa-folder text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">ูุง ุชูุฌุฏ ุชุตูููุงุช</h3>
        <p class="text-gray-500 dark:text-gray-400 mb-4">ุงุจุฏุฃ ุจุฅุถุงูุฉ ุฃูู ุชุตููู ุฅูู ุงููุธุงู</p>
        <button onclick="showModal('addCategoryModal')" class="btn-primary">
          <i class="fas fa-plus ml-2"></i>
          ุฅุถุงูุฉ ุฃูู ุชุตููู
        </button>
      </div>
      {% endif %}
    </div>

    <!-- ุชุจููุจ ุฅุฏุงุฑุฉ ุงูุนูุงู -->
    <div id="workers-tab" class="tab-content">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
        <div>
          <h3 class="text-xl font-bold text-gray-900 dark:text-white">๐ท ุฅุฏุงุฑุฉ ุญุณุงุจุงุช ุงูุนูุงู</h3>
          <p class="text-gray-600 dark:text-gray-400 mt-1">ุฅุฏุงุฑุฉ ุญุณุงุจุงุช ุชุณุฌูู ุฏุฎูู ุงูุนูุงู - ุตูุงุญูุงุช ูุญุฏูุฏุฉ</p>
        </div>
        <div class="flex gap-2">
          <div class="relative">
            <input type="text" id="workersSearch" placeholder="ุจุญุซ ูู ุงูุนูุงู..." 
                   class="form-input pr-10 dark:bg-gray-700 dark:border-gray-600 dark:text-white" onkeyup="searchTable('workersSearch', 'workersTable')">
            <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
        </div>
      </div>

      <!-- ุฅุญุตุงุฆูุงุช ุงูุนูุงู -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-blue-600">{{ workers|length }}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ุฅุฌูุงูู ุงูุนูุงู</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-green-600">{{ workers|selectattr('is_login_active', 'equalto', true)|list|length }}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ุญุณุงุจุงุช ูุดุทุฉ</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-purple-600">{{ workers|selectattr('last_login')|list|length }}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ุฏุฎููุง ุงููุธุงู</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-2xl font-bold text-orange-600">{{ workers|selectattr('is_active', 'equalto', true)|list|length }}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">ุนูุงู ูุดุทูู</div>
        </div>
      </div>

      <!-- ุฌุฏูู ุงูุนูุงู -->
      <div class="table-container">
        <table class="w-full" id="workersTable">
          <thead class="table-header dark:bg-gray-800">
            <tr>
              <th class="p-4 cursor-pointer" onclick="sortTable('workersTable', 0)"># <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 cursor-pointer" onclick="sortTable('workersTable', 1)">ุงุณู ุงูุนุงูู <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4">ูุนูููุงุช ุงูุญุณุงุจ</th>
              <th class="p-4 cursor-pointer" onclick="sortTable('workersTable', 3)">ุญุงูุฉ ุงูุญุณุงุจ <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4 cursor-pointer" onclick="sortTable('workersTable', 4)">ุขุฎุฑ ุฏุฎูู <i class="fas fa-sort ml-1"></i></th>
              <th class="p-4">ุงูุนูููุงุช</th>
            </tr>
          </thead>
          <tbody>
            {% for worker in workers %}
            <tr class="border-t hover:bg-gray-50 dark:hover:bg-gray-700 dark:border-gray-600">
              <td class="p-4 font-mono text-sm text-gray-500 dark:text-gray-400">#{{ worker.id }}</td>
              <td class="p-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center text-white font-semibold">
                    {{ worker.name[0]|upper }}
                  </div>
                  <div>
                    <div class="font-semibold text-gray-900 dark:text-white">{{ worker.name }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">{{ worker.phone }}</div>
                  </div>
                </div>
              </td>
              <td class="p-4">
                <div class="space-y-1 text-sm">
                  <div class="text-gray-600 dark:text-gray-300 flex items-center gap-2">
                    <i class="fas fa-user text-gray-400"></i>
                    {{ worker.username }}
                  </div>
                  <div class="text-gray-500 dark:text-gray-400 flex items-center gap-2">
                    <i class="fas fa-key text-gray-400"></i>
                    <span class="font-mono">{{ worker.get_original_password() }}</span>
                  </div>
                </div>
              </td>
              <td class="p-4">
                <div class="space-y-2">
                  {% if worker.is_login_active %}
                  <span class="badge badge-success flex items-center gap-1 w-fit">
                    <i class="fas fa-check-circle"></i>
                    ูุดุท
                  </span>
                  {% else %}
                  <span class="badge badge-danger flex items-center gap-1 w-fit">
                    <i class="fas fa-pause-circle"></i>
                    ุบูุฑ ูุดุท
                  </span>
                  {% endif %}
                  <div class="text-xs text-gray-500 dark:text-gray-400">
                    {% if worker.is_active %}
                    <span class="text-green-600">ุนุงูู ูุดุท</span>
                    {% else %}
                    <span class="text-red-600">ุนุงูู ูุฌูุฏ</span>
                    {% endif %}
                  </div>
                </div>
              </td>
              <td class="p-4">
                <div class="text-sm text-gray-600 dark:text-gray-300">
                  {% if worker.last_login %}
                  <div>{{ worker.last_login.strftime('%Y-%m-%d') }}</div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">{{ worker.last_login.strftime('%H:%M') }}</div>
                  {% else %}
                  <span class="text-gray-400">ูู ูุณุฌู ุฏุฎูู</span>
                  {% endif %}
                </div>
              </td>
              <td class="p-4">
                <div class="flex flex-col gap-2">
                  <button onclick="resetWorkerPassword({{ worker.id }}, '{{ worker.name }}')"
                         class="flex items-center gap-2 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300 p-2 rounded-lg hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors text-sm">
                    <i class="fas fa-key text-xs"></i>
                    ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ
                  </button>
                  
                  <button onclick="toggleWorkerLogin({{ worker.id }}, {{ worker.is_login_active|lower }})"
                         class="flex items-center gap-2 {% if worker.is_login_active %}text-orange-600 hover:text-orange-800 dark:text-orange-400 dark:hover:text-orange-300{% else %}text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300{% endif %} p-2 rounded-lg hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-colors text-sm">
                    <i class="fas {% if worker.is_login_active %}fa-pause{% else %}fa-play{% endif %} text-xs"></i>
                    {{ "ุฅููุงู" if worker.is_login_active else "ุชูุนูู" }} ุงูุญุณุงุจ
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- ุฑุณุงูุฉ ุฅุฐุง ูู ููู ููุงู ุนูุงู -->
      {% if not workers %}
      <div class="card p-8 text-center">
        <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">ูุง ููุฌุฏ ุนูุงู</h3>
        <p class="text-gray-500 dark:text-gray-400 mb-4">ูุชู ุฅุถุงูุฉ ุงูุนูุงู ูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุนูุงู</p>
        <a href="{{ url_for('workers') }}" class="btn-primary">
          <i class="fas fa-users ml-2"></i>
          ุงูุฐูุงุจ ูุฅุฏุงุฑุฉ ุงูุนูุงู
        </a>
      </div>
      {% endif %}
    </div>

    <!-- ุชุจููุจ ุงููุณุฎ ุงูุงุญุชูุงุทู -->
    <div id="backup-tab" class="tab-content">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- ุงููุณุฎ ุงูุงุญุชูุงุทู -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
              <i class="fas fa-download text-blue-600 dark:text-blue-400 text-xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">ุงููุณุฎ ุงูุงุญุชูุงุทู</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</p>
            </div>
          </div>
          
          <div class="space-y-4">
            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
              <div class="flex items-center gap-3">
                <i class="fas fa-info-circle text-blue-600 text-xl"></i>
                <div>
                  <h4 class="font-medium text-blue-900 dark:text-blue-100">ูุนูููุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู</h4>
                  <p class="text-sm text-blue-700 dark:text-blue-300 mt-1">
                    ุงููุณุฎ ุงูุงุญุชูุงุทู ูุญูุธ ุฌููุน ุจูุงูุงุช ุงููุธุงู ุจูุง ูู ุฐูู ุงูุทูุจูุงุชุ ุงูุนูุงูุ ุงููุตุงุฑููุ ูุงูุฏููู.
                  </p>
                </div>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4 text-sm">
              <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div class="text-2xl font-bold text-gray-700 dark:text-gray-300">{{ total_orders }}</div>
                <div class="text-gray-600 dark:text-gray-400 mt-1">ุทูุจูุฉ</div>
              </div>
              <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div class="text-2xl font-bold text-gray-700 dark:text-gray-300">{{ total_workers }}</div>
                <div class="text-gray-600 dark:text-gray-400 mt-1">ุนุงูู</div>
              </div>
              <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div class="text-2xl font-bold text-gray-700 dark:text-gray-300">{{ total_expenses }}</div>
                <div class="text-gray-600 dark:text-gray-400 mt-1">ูุตุฑูู</div>
              </div>
              <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div class="text-2xl font-bold text-gray-700 dark:text-gray-300">{{ total_debts }}</div>
                <div class="text-gray-600 dark:text-gray-400 mt-1">ุฏูู</div>
              </div>
            </div>
            
            <button onclick="createBackup()" class="btn-success w-full flex items-center justify-center gap-2">
              <i class="fas fa-download"></i>
              ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ
            </button>
          </div>
        </div>

        <!-- ุงุณุชุนุงุฏุฉ ุงููุณุฎ -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
              <i class="fas fa-upload text-green-600 dark:text-green-400 text-xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">ุงุณุชุนุงุฏุฉ ุงููุณุฎ</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">ุงุณุชุนุงุฏุฉ ุงููุธุงู ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ</p>
            </div>
          </div>
          
          <div class="space-y-4">
            <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
              <div class="flex items-center gap-3">
                <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                <div>
                  <h4 class="font-medium text-yellow-900 dark:text-yellow-100">ุชุญุฐูุฑ ููู</h4>
                  <p class="text-sm text-yellow-700 dark:text-yellow-300 mt-1">
                    ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุณุชุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงูุญุงููุฉ ูุชุณุชุจุฏููุง ุจุงูุจูุงูุงุช ูู ุงููุณุฎุฉ.
                  </p>
                </div>
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                ุงุฎุชูุงุฑ ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
              </label>
              <input type="file" id="backupFile" accept=".db,.sqlite,.backup" class="form-input dark:bg-gray-700 dark:border-gray-600 dark:text-white">
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ุงููููุงุช ุงููุฏุนููุฉ: .db, .sqlite, .backup</p>
            </div>
            
            <button onclick="restoreBackup()" class="btn-warning w-full flex items-center justify-center gap-2">
              <i class="fas fa-upload"></i>
              ุงุณุชุนุงุฏุฉ ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ
            </button>
          </div>
        </div>
      </div>

      <!-- ุณุฌู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ -->
      <div class="card p-6 mt-8">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
            <i class="fas fa-history text-purple-600 dark:text-purple-400 text-xl"></i>
          </div>
          <div>
            <h3 class="text-xl font-bold text-gray-900 dark:text-white">ุณุฌู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ</h3>
            <p class="text-gray-600 dark:text-gray-400 text-sm">ุนุฑุถ ูุฅุฏุงุฑุฉ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงูุณุงุจูุฉ</p>
          </div>
        </div>

        <div class="table-container">
          <table class="w-full">
            <thead class="table-header dark:bg-gray-800">
              <tr>
                <th class="p-4">ุงุณู ุงูููู</th>
                <th class="p-4">ุงูุญุฌู</th>
                <th class="p-4">ุชุงุฑูุฎ ุงูุฅูุดุงุก</th>
                <th class="p-4">ุงูุฅุฌุฑุงุกุงุช</th>
              </tr>
            </thead>
            <tbody id="backupHistory">
              <!-- ุณูุชู ููุคู ุจุงูุฌุงูุงุณูุฑูุจุช -->
            </tbody>
          </table>
        </div>

        <div id="noBackupsMessage" class="card p-8 text-center hidden">
          <i class="fas fa-history text-4xl text-gray-300 mb-4"></i>
          <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">ูุง ุชูุฌุฏ ูุณุฎ ุงุญุชูุงุทูุฉ</h3>
          <p class="text-gray-500 dark:text-gray-400 mb-4">ูู ุจุฅูุดุงุก ุฃูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูููุธุงู</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ========== ุฌููุน ุงูููุฏุงูุงุช ========== -->

<!-- ููุฏุงู ุฅุถุงูุฉ ูุฏูุฑ -->
<div id="addUserModal" class="modal">
  <div class="modal-content w-full max-w-md">
    <div class="p-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white">๐ค ุฅุถุงูุฉ ูุฏูุฑ ุดุงูู ุฌุฏูุฏ</h3>
        <button onclick="hideModal('addUserModal')" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-xl transition-colors">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form method="POST" action="{{ url_for('add_settings_user') }}" class="space-y-4" id="addUserForm">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            <i class="fas fa-user ml-2 text-gray-400"></i>
            ุงุณู ุงููุณุชุฎุฏู *
          </label>
          <input type="text" name="username" required class="form-input dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="ุงุณู ุงููุณุชุฎุฏู" 
                 pattern="[a-zA-Z0-9_]{3,20}" title="ูุฌุจ ุฃู ูููู ุงุณู ุงููุณุชุฎุฏู ุจูู 3 ู 20 ุญุฑู (ุฃุญุฑู ุฅูุฌููุฒูุฉุ ุฃุฑูุงูุ _)">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            <i class="fas fa-envelope ml-2 text-gray-400"></i>
            ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
          </label>
          <input type="email" name="email" class="form-input dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="email@example.com">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            <i class="fas fa-lock ml-2 text-gray-400"></i>
            ูููุฉ ุงููุฑูุฑ *
          </label>
          <input type="password" name="password" required class="form-input dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="ูููุฉ ุงููุฑูุฑ" 
                 minlength="6" id="userPassword">
          <div class="password-strength mt-2 hidden">
            <div class="flex gap-1">
              <div class="h-1 flex-1 bg-gray-200 rounded"></div>
              <div class="h-1 flex-1 bg-gray-200 rounded"></div>
              <div class="h-1 flex-1 bg-gray-200 rounded"></div>
            </div>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="passwordStrengthText"></p>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            <i class="fas fa-user-tag ml-2 text-gray-400"></i>
            ุงูุงุณู ุงููุงูู
          </label>
          <input type="text" name="full_name" class="form-input dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="ุงูุงุณู ุงููุงูู">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            <i class="fas fa-phone ml-2 text-gray-400"></i>
            ุฑูู ุงููุงุชู
          </label>
          <input type="tel" name="phone" class="form-input dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="+213 XXX XX XX XX">
        </div>
        
        <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
          <div class="flex items-center gap-2 text-blue-700 dark:text-blue-300">
            <i class="fas fa-info-circle"></i>
            <span class="text-sm">ูุฐุง ุงููุฏูุฑ ุณูููู ูุฏูู ุฌููุน ุงูุตูุงุญูุงุช ูู ุงููุธุงู</span>
          </div>
        </div>

        <div class="flex gap-3 pt-4">
          <button type="button" onclick="hideModal('addUserModal')" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
            ุฅูุบุงุก
          </button>
          <button type="submit" class="flex-1 btn-success flex items-center justify-center gap-2">
            <i class="fas fa-save"></i>
            ุญูุธ ุงููุฏูุฑ ุงูุดุงูู
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ุจุงูู ุงูููุฏุงูุงุช (ุชุนุฏูู ูุฏูุฑุ ููุฑุฏููุ ููุชุฌุงุชุ ุชุตูููุงุช) -->
<!-- ุณูุชู ุชุถููููุง ุจููุณ ุงูููุท ูุน ุงูุชุนุฏููุงุช ุงููุงุฒูุฉ -->

<!-- ููุฏุงู ุชุฃููุฏ ุงูุญุฐู -->
<div id="confirmDeleteModal" class="modal">
  <div class="modal-content w-full max-w-md">
    <div class="p-6 text-center">
      <div class="w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="fas fa-exclamation-triangle text-red-600 dark:text-red-400 text-2xl"></i>
      </div>
      
      <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2" id="confirmDeleteTitle">ุชุฃููุฏ ุงูุญุฐู</h3>
      <p class="text-gray-600 dark:text-gray-400 mb-6" id="confirmDeleteMessage">ูู ุฃูุช ูุชุฃูุฏ ูู ุฃูู ุชุฑูุฏ ุงูุญุฐูุ</p>
      
      <div class="flex gap-3">
        <button onclick="hideModal('confirmDeleteModal')" class="flex-1 btn-secondary">
          ุฅูุบุงุก
        </button>
        <button onclick="proceedWithDelete()" class="flex-1 btn-danger flex items-center justify-center gap-2">
          <i class="fas fa-trash"></i>
          ูุนูุ ุงุญุฐู
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ููุฏุงู ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ -->
<div id="resetPasswordModal" class="modal">
  <div class="modal-content w-full max-w-md">
    <div class="p-6 text-center">
      <div class="w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="fas fa-key text-green-600 dark:text-green-400 text-2xl"></i>
      </div>
      
      <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2" id="resetPasswordTitle">ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ</h3>
      <p class="text-gray-600 dark:text-gray-400 mb-4" id="resetPasswordMessage"></p>
      
      <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-4">
        <div class="font-mono text-lg font-bold text-gray-800 dark:text-gray-200" id="newPasswordDisplay"></div>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ</p>
      </div>
      
      <div class="flex gap-3">
        <button onclick="hideModal('resetPasswordModal')" class="flex-1 btn-secondary">
          ุฅุบูุงู
        </button>
        <button onclick="copyPassword()" class="flex-1 btn-success flex items-center justify-center gap-2">
          <i class="fas fa-copy"></i>
          ูุณุฎ ูููุฉ ุงููุฑูุฑ
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// ========== ุงููุชุบูุฑุงุช ุงูุนุงูุฉ ==========
let currentDeleteAction = null;
let currentDeleteId = null;
let currentDeleteType = null;
let currentNewPassword = '';

// ========== ุฅุฏุงุฑุฉ ุงูุชุจููุจุงุช ==========
function showTab(tabName) {
  // ุฅุฎูุงุก ุฌููุน ุงููุญุชููุงุช
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // ุฅุฒุงูุฉ ุงููุดุท ูู ุฌููุน ุงูุฃุฒุฑุงุฑ
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
    btn.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
  });
  
  // ุฅุธูุงุฑ ุงููุญุชูู ุงููุทููุจ
  const targetTab = document.getElementById(tabName + '-tab');
  if (targetTab) {
    targetTab.classList.add('active');
  }
  
  // ุชูุนูู ุงูุฒุฑ ุงููุทููุจ
  const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
  if (activeBtn) {
    activeBtn.classList.add('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
    activeBtn.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
  }
  
  // ุญูุธ ุงูุชุจููุจ ุงููุดุท ูู localStorage
  localStorage.setItem('activeSettingsTab', tabName);
  
  // ุชุญููู ุจูุงูุงุช ุฅุถุงููุฉ ุญุณุจ ุงูุชุจููุจ
  if (tabName === 'backup') {
    loadBackupHistory();
  }
}

// ========== ูุธุงุฆู ุงูุจุญุซ ูุงูุชุฑุชูุจ ==========
function searchTable(inputId, tableId) {
  const input = document.getElementById(inputId);
  const table = document.getElementById(tableId);
  if (!table) return;
  
  const rows = table.getElementsByTagName('tbody')[0]?.getElementsByTagName('tr') || [];
  const filter = input.value.toLowerCase();
  
  for (let row of rows) {
    const text = row.textContent.toLowerCase();
    row.style.display = text.includes(filter) ? '' : 'none';
  }
}

function sortTable(tableId, columnIndex) {
  const table = document.getElementById(tableId);
  if (!table) return;
  
  const tbody = table.getElementsByTagName('tbody')[0];
  const rows = Array.from(tbody.getElementsByTagName('tr'));
  const isNumeric = !isNaN(parseFloat(rows[0]?.cells[columnIndex]?.textContent));
  
  rows.sort((a, b) => {
    const aValue = a.cells[columnIndex].textContent.trim();
    const bValue = b.cells[columnIndex].textContent.trim();
    
    if (isNumeric) {
      return parseFloat(aValue) - parseFloat(bValue);
    } else {
      return aValue.localeCompare(bValue, 'ar');
    }
  });
  
  // ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูุตููู
  rows.forEach(row => tbody.appendChild(row));
}

// ========== ูุธุงุฆู ุฅุฏุงุฑุฉ ุงููุฏูุฑูู ==========
async function editUser(userId) {
  try {
    const response = await fetch(`/api/user/${userId}`);
    const user = await response.json();
    
    if (user.success) {
      document.getElementById('editUserId').value = user.id;
      document.getElementById('editUsername').value = user.username;
      document.getElementById('editEmail').value = user.email || '';
      document.getElementById('editFullName').value = user.full_name || '';
      document.getElementById('editPhone').value = user.phone || '';
      
      // ุชุญุฏูุซ action ุงูุฎุงุต ุจุงููููุฐุฌ
      document.getElementById('editUserForm').action = `/settings/user/edit/${userId}`;
      
      showModal('editUserModal');
    } else {
      showToast('ุญุฏุซ ุฎุทุฃ ูู ุฌูุจ ุจูุงูุงุช ุงููุฏูุฑ', 'error');
    }
  } catch (error) {
    console.error('Error:', error);
    showToast('ุญุฏุซ ุฎุทุฃ ูู ุฌูุจ ุจูุงูุงุช ุงููุฏูุฑ', 'error');
  }
}

async function resetUserPassword(userId, username) {
  if (confirm(`ูู ุชุฑูุฏ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ูุฑูุฑ ุงููุฏูุฑ "${username}"ุ`)) {
    try {
      const response = await fetch(`/settings/user/reset-password/${userId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      });
      
      const result = await response.json();
      
      if (result.success) {
        currentNewPassword = result.new_password;
        document.getElementById('resetPasswordTitle').textContent = `ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ูุฑูุฑ ${username}`;
        document.getElementById('resetPasswordMessage').textContent = `ุชู ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ูุฑูุฑ ุงููุฏูุฑ "${username}" ุจูุฌุงุญ`;
        document.getElementById('newPasswordDisplay').textContent = result.new_password;
        showModal('resetPasswordModal');
      } else {
        showToast(result.error, 'error');
      }
    } catch (error) {
      console.error('Error:', error);
      showToast('ุญุฏุซ ุฎุทุฃ ูู ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ', 'error');
    }
  }
}

async function toggleUserStatus(userId, isActive) {
  const action = isActive ? 'ุฅููุงู' : 'ุชูุนูู';
  if (confirm(`ูู ุชุฑูุฏ ${action} ูุฐุง ุงููุฏูุฑุ`)) {
    try {
      const response = await fetch(`/settings/user/toggle/${userId}`, { 
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      });
      
      const result = await response.json();
      
      if (result.success) {
        showToast(result.message, 'success');
        setTimeout(() => location.reload(), 1000);
      } else {
        showToast(result.error, 'error');
      }
    } catch (error) {
      console.error('Error:', error);
      showToast('ุญุฏุซ ุฎุทุฃ ูู ุชุบููุฑ ุญุงูุฉ ุงููุฏูุฑ', 'error');
    }
  }
}

function confirmDeleteUser(userId, username) {
  currentDeleteId = userId;
  currentDeleteType = 'user';
  currentDeleteAction = () => deleteUser(userId);
  
  document.getElementById('confirmDeleteTitle').textContent = 'ุญุฐู ุงููุฏูุฑ';
  document.getElementById('confirmDeleteMessage').textContent = `ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงููุฏูุฑ "${username}"ุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.`;
  
  showModal('confirmDeleteModal');
}

async function deleteUser(userId) {
  try {
    const response = await fetch(`/settings/user/delete/${userId}`, { 
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      showToast(result.message, 'success');
      setTimeout(() => location.reload(), 1000);
    } else {
      showToast(result.error, 'error');
    }
  } catch (error) {
    console.error('Error:', error);
    showToast('ุญุฏุซ ุฎุทุฃ ูู ุญุฐู ุงููุฏูุฑ', 'error');
  }
}

// ========== ูุธุงุฆู ุฅุฏุงุฑุฉ ุงูุนูุงู ==========
async function resetWorkerPassword(workerId, workerName) {
  if (confirm(`ูู ุชุฑูุฏ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ูุฑูุฑ ุงูุนุงูู "${workerName}"ุ`)) {
    try {
      const response = await fetch(`/workers/${workerId}/reset_password`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      });
      
      const result = await response.json();
      
      if (result.success) {
        currentNewPassword = result.new_password;
        document.getElementById('resetPasswordTitle').textContent = `ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ูุฑูุฑ ${workerName}`;
        document.getElementById('resetPasswordMessage').textContent = `ุชู ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ูุฑูุฑ ุงูุนุงูู "${workerName}" ุจูุฌุงุญ`;
        document.getElementById('newPasswordDisplay').textContent = result.new_password;
        showModal('resetPasswordModal');
      } else {
        showToast(result.error, 'error');
      }
    } catch (error) {
      console.error('Error:', error);
      showToast('ุญุฏุซ ุฎุทุฃ ูู ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ', 'error');
    }
  }
}

async function toggleWorkerLogin(workerId, isActive) {
  const action = isActive ? 'ุฅููุงู' : 'ุชูุนูู';
  if (confirm(`ูู ุชุฑูุฏ ${action} ุญุณุงุจ ุชุณุฌูู ุฏุฎูู ูุฐุง ุงูุนุงููุ`)) {
    try {
      const response = await fetch(`/workers/${workerId}/toggle_login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      });
      
      const result = await response.json();
      
      if (result.success) {
        showToast(result.message, 'success');
        setTimeout(() => location.reload(), 1000);
      } else {
        showToast(result.error, 'error');
      }
    } catch (error) {
      console.error('Error:', error);
      showToast('ุญุฏุซ ุฎุทุฃ ูู ุชุบููุฑ ุญุงูุฉ ุงูุญุณุงุจ', 'error');
    }
  }
}

// ========== ูุธุงุฆู ุงููุณุฎ ุงูุงุญุชูุงุทู ==========
async function createBackup() {
  if (confirm('ูู ุชุฑูุฏ ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ')) {
    try {
      showToast('ุฌุงุฑู ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ...', 'info');
      
      const response = await fetch('/api/backup/create', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      });
      
      const result = await response.json();
      
      if (result.success) {
        showToast('ุชู ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ', 'success');
        loadBackupHistory();
      } else {
        showToast(result.error, 'error');
      }
    } catch (error) {
      console.error('Error:', error);
      showToast('ุญุฏุซ ุฎุทุฃ ูู ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
    }
  }
}

async function restoreBackup() {
  const fileInput = document.getElementById('backupFile');
  const file = fileInput.files[0];
  
  if (!file) {
    showToast('ูุฑุฌู ุงุฎุชูุงุฑ ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
    return;
  }
  
  if (!confirm('ุชุญุฐูุฑ: ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุณุชุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงูุญุงููุฉ. ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ')) {
    return;
  }
  
  try {
    showToast('ุฌุงุฑู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ...', 'info');
    
    const formData = new FormData();
    formData.append('backup_file', file);
    
    const response = await fetch('/api/backup/restore', {
      method: 'POST',
      body: formData
    });
    
    const result = await response.json();
    
    if (result.success) {
      showToast('ุชู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ', 'success');
      setTimeout(() => location.reload(), 2000);
    } else {
      showToast(result.error, 'error');
    }
  } catch (error) {
    console.error('Error:', error);
    showToast('ุญุฏุซ ุฎุทุฃ ูู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
  }
}

async function loadBackupHistory() {
  try {
    const response = await fetch('/api/backup/history');
    const result = await response.json();
    
    const backupHistory = document.getElementById('backupHistory');
    const noBackupsMessage = document.getElementById('noBackupsMessage');
    
    if (result.success && result.backups.length > 0) {
      backupHistory.innerHTML = result.backups.map(backup => `
        <tr class="border-t hover:bg-gray-50 dark:hover:bg-gray-700 dark:border-gray-600">
          <td class="p-4 font-medium text-gray-900 dark:text-white">${backup.filename}</td>
          <td class="p-4 text-sm text-gray-600 dark:text-gray-400">${backup.size}</td>
          <td class="p-4 text-sm text-gray-600 dark:text-gray-400">${backup.created_at}</td>
          <td class="p-4">
            <div class="flex gap-2">
              <button onclick="downloadBackup('${backup.filename}')" class="btn-success text-sm flex items-center gap-1">
                <i class="fas fa-download"></i>
                ุชุญููู
              </button>
              <button onclick="deleteBackup('${backup.filename}')" class="btn-danger text-sm flex items-center gap-1">
                <i class="fas fa-trash"></i>
                ุญุฐู
              </button>
            </div>
          </td>
        </tr>
      `).join('');
      
      backupHistory.style.display = '';
      noBackupsMessage.classList.add('hidden');
    } else {
      backupHistory.style.display = 'none';
      noBackupsMessage.classList.remove('hidden');
    }
  } catch (error) {
    console.error('Error loading backup history:', error);
  }
}

async function downloadBackup(filename) {
  try {
    const response = await fetch(`/api/backup/download/${filename}`);
    if (response.ok) {
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
      document.body.removeChild(a);
    } else {
      showToast('ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
    }
  } catch (error) {
    console.error('Error:', error);
    showToast('ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
  }
}

async function deleteBackup(filename) {
  if (confirm(`ูู ุชุฑูุฏ ุญุฐู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ "${filename}"ุ`)) {
    try {
      const response = await fetch(`/api/backup/delete/${filename}`, {
        method: 'DELETE'
      });
      
      const result = await response.json();
      
      if (result.success) {
        showToast('ุชู ุญุฐู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ', 'success');
        loadBackupHistory();
      } else {
        showToast(result.error, 'error');
      }
    } catch (error) {
      console.error('Error:', error);
      showToast('ุญุฏุซ ุฎุทุฃ ูู ุญุฐู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
    }
  }
}

// ========== ูุธุงุฆู ุงููุณุงุนุฏุฉ ==========
function copyPassword() {
  navigator.clipboard.writeText(currentNewPassword).then(() => {
    showToast('ุชู ูุณุฎ ูููุฉ ุงููุฑูุฑ ุฅูู ุงูุญุงูุธุฉ', 'success');
  }).catch(() => {
    showToast('ูุดู ูู ูุณุฎ ูููุฉ ุงููุฑูุฑ', 'error');
  });
}

function showToast(message, type = 'success') {
  const toast = document.createElement('div');
  toast.className = `fixed top-4 left-4 z-50 p-4 rounded-lg shadow-lg transform transition-all duration-300 ${
    type === 'success' ? 'bg-green-500 text-white' : 
    type === 'error' ? 'bg-red-500 text-white' : 
    type === 'info' ? 'bg-blue-500 text-white' : 
    'bg-gray-500 text-white'
  }`;
  toast.textContent = message;
  toast.style.opacity = '0';
  toast.style.transform = 'translateY(-20px)';
  
  document.body.appendChild(toast);
  
  // ุฅุธูุงุฑ ุงูุฑุณุงูุฉ
  setTimeout(() => {
    toast.style.opacity = '1';
    toast.style.transform = 'translateY(0)';
  }, 100);
  
  // ุฅุฎูุงุก ุงูุฑุณุงูุฉ ุจุนุฏ 3 ุซูุงู
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(-20px)';
    setTimeout(() => {
      if (toast.parentNode) {
        toast.parentNode.removeChild(toast);
      }
    }, 300);
  }, 3000);
}

// ุชููุฆุฉ ุงููุธุงู
document.addEventListener('DOMContentLoaded', function() {
    initializeSettingsSystem();
    loadSystemData();
});

function initializeSettingsSystem() {
    // ุงุณุชุนุงุฏุฉ ุงูุชุจููุจ ุงููุดุท
    const activeTab = localStorage.getItem('activeSettingsTab') || 'users';
    showTab(activeTab);
    
    // ุชููุฆุฉ ููุชูู ุงูุฃููุงู
    initializeColorPickers();
    
    // ุชููุฆุฉ ุชุญูู ูููุงุช ุงููุฑูุฑ
    initializePasswordValidation();
    
    // ุชุญููู ุงูุจูุงูุงุช ุงูุฃูููุฉ
    loadInitialData();
}

function initializeColorPickers() {
    // ุฑุจุท ููุชูู ุงูุฃููุงู ูุน ุงูุญููู ุงููุตูุฉ
    document.querySelectorAll('.color-picker-group').forEach(group => {
        const picker = group.querySelector('input[type="color"]');
        const text = group.querySelector('input[type="text"]');
        const preview = group.querySelector('.color-preview');
        
        if (picker && text) {
            picker.addEventListener('input', function() {
                text.value = this.value;
                if (preview) preview.style.backgroundColor = this.value;
            });
            
            text.addEventListener('input', function() {
                if (this.value.match(/^#[0-9A-F]{6}$/i)) {
                    picker.value = this.value;
                    if (preview) preview.style.backgroundColor = this.value;
                }
            });
        }
    });
}

function initializePasswordValidation() {
    const passwordInputs = document.querySelectorAll('input[type="password"]');
    passwordInputs.forEach(input => {
        input.addEventListener('input', function() {
            validatePasswordStrength(this);
        });
    });
}

function validatePasswordStrength(input) {
    const strengthContainer = input.parentNode.querySelector('.password-strength');
    if (!strengthContainer) return;
    
    const strengthBars = strengthContainer.querySelectorAll('.strength-bar');
    const strengthText = strengthContainer.querySelector('.strength-text');
    
    if (input.value.length === 0) {
        strengthContainer.classList.add('hidden');
        return;
    }
    
    strengthContainer.classList.remove('hidden');
    
    let strength = 0;
    if (input.value.length >= 6) strength++;
    if (input.value.match(/[a-z]/) && input.value.match(/[A-Z]/)) strength++;
    if (input.value.match(/\d/) && input.value.match(/[^a-zA-Z\d]/)) strength++;
    
    strengthBars.forEach((bar, index) => {
        bar.className = `strength-bar h-1 flex-1 rounded ${
            index < strength ? 
            (strength === 1 ? 'bg-red-500' :
             strength === 2 ? 'bg-yellow-500' : 'bg-green-500') :
            'bg-gray-200'
        }`;
    });
    
    const strengthLabels = ['ุถุนููุฉ ุฌุฏุงู', 'ุถุนููุฉ', 'ุฌูุฏุฉ', 'ูููุฉ'];
    strengthText.textContent = strengthLabels[strength] || 'ุถุนููุฉ';
    strengthText.className = `strength-text text-xs mt-1 ${
        strength <= 1 ? 'text-red-500' :
        strength === 2 ? 'text-yellow-500' : 'text-green-500'
    }`;
}

async function loadInitialData() {
    try {
        // ุชุญููู ุฅุญุตุงุฆูุงุช ุงููุธุงู
        await loadSystemStats();
        
        // ุชุญููู ุณุฌู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุฅุฐุง ูุงู ุงูุชุจููุจ ูุดุท
        if (localStorage.getItem('activeSettingsTab') === 'backup') {
            await loadBackupHistory();
        }
    } catch (error) {
        console.error('Error loading initial data:', error);
    }
}

async function loadSystemStats() {
    try {
        const response = await fetch('/api/system/stats');
        if (response.ok) {
            const stats = await response.json();
            updateStatsDisplay(stats);
        }
    } catch (error) {
        console.error('Error loading system stats:', error);
    }
}

function updateStatsDisplay(stats) {
    // ุชุญุฏูุซ ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ูู ุงููุงุฌูุฉ
    const statElements = {
        'total-orders': stats.total_orders,
        'total-workers': stats.total_workers,
        'total-expenses': stats.total_expenses,
        'total-debts': stats.total_debts
    };
    
    Object.keys(statElements).forEach(key => {
        const element = document.getElementById(key);
        if (element) {
            element.textContent = statElements[key];
        }
    });
}

// ========== ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงููุญุณู ==========

class NotificationSystem {
    constructor() {
        this.container = this.createContainer();
    }
    
    createContainer() {
        const container = document.createElement('div');
        container.className = 'fixed top-4 right-4 z-50 space-y-2 max-w-sm';
        document.body.appendChild(container);
        return container;
    }
    
    show(message, type = 'success', duration = 5000) {
        const toast = document.createElement('div');
        toast.className = `p-4 rounded-lg shadow-lg transform transition-all duration-300 ${
            this.getToastClasses(type)
        }`;
        toast.innerHTML = `
            <div class="flex items-center gap-3">
                <i class="${this.getToastIcon(type)} text-lg"></i>
                <div class="flex-1">
                    <div class="font-medium">${this.getToastTitle(type)}</div>
                    <div class="text-sm opacity-90">${message}</div>
                </div>
                <button onclick="this.parentElement.parentElement.remove()" class="opacity-70 hover:opacity-100 transition-opacity">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        
        this.container.appendChild(toast);
        
        // ุฅุธูุงุฑ ุงูุฑุณุงูุฉ
        setTimeout(() => {
            toast.classList.remove('opacity-0', 'translate-x-full');
        }, 10);
        
        // ุฅุฎูุงุก ุชููุงุฆู
        if (duration > 0) {
            setTimeout(() => {
                this.hide(toast);
            }, duration);
        }
        
        return toast;
    }
    
    hide(toast) {
        toast.classList.add('opacity-0', 'translate-x-full');
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }
    
    getToastClasses(type) {
        const classes = {
            success: 'bg-green-500 text-white border-l-4 border-green-600',
            error: 'bg-red-500 text-white border-l-4 border-red-600',
            warning: 'bg-yellow-500 text-white border-l-4 border-yellow-600',
            info: 'bg-blue-500 text-white border-l-4 border-blue-600'
        };
        return classes[type] || classes.info;
    }
    
    getToastIcon(type) {
        const icons = {
            success: 'fas fa-check-circle',
            error: 'fas fa-exclamation-circle',
            warning: 'fas fa-exclamation-triangle',
            info: 'fas fa-info-circle'
        };
        return icons[type] || icons.info;
    }
    
    getToastTitle(type) {
        const titles = {
            success: 'ูุฌุงุญ',
            error: 'ุฎุทุฃ',
            warning: 'ุชุญุฐูุฑ',
            info: 'ูุนูููุฉ'
        };
        return titles[type] || titles.info;
    }
}

// ุชููุฆุฉ ูุธุงู ุงูุฅุดุนุงุฑุงุช
const notifications = new NotificationSystem();

// ุฏุงูุฉ ูุณุงุนุฏุฉ ููุฅุดุนุงุฑุงุช
function showToast(message, type = 'success', duration = 5000) {
    return notifications.show(message, type, duration);
}

// ========== ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงุฐุฌ ==========

class FormManager {
    constructor() {
        this.forms = new Map();
    }
    
    registerForm(formId, options = {}) {
        const form = document.getElementById(formId);
        if (!form) return;
        
        this.forms.set(formId, { form, options });
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            await this.handleSubmit(formId);
        });
    }
    
    async handleSubmit(formId) {
        const { form, options } = this.forms.get(formId);
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn?.innerHTML;
        
        try {
            // ุชุนุทูู ุงูุฒุฑ ุฃุซูุงุก ุงูุฅุฑุณุงู
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ุฌุงุฑู ุงูุญูุธ...';
            }
            
            const formData = new FormData(form);
            const response = await fetch(form.action, {
                method: form.method,
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                showToast(result.message, 'success');
                
                // ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ ุฅุฐุง ูุงู ูุทููุจุงู
                if (options.resetOnSuccess) {
                    form.reset();
                }
                
                // ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุฅุฐุง ูุงู ูุทููุจุงู
                if (options.reloadOnSuccess) {
                    setTimeout(() => location.reload(), 1000);
                }
                
                // ุงุณุชุฏุนุงุก ุฑุฏ ูุนู ูุฎุตุต
                if (options.onSuccess) {
                    options.onSuccess(result);
                }
            } else {
                showToast(result.error, 'error');
                
                if (options.onError) {
                    options.onError(result);
                }
            }
        } catch (error) {
            console.error('Form submission error:', error);
            showToast('ุญุฏุซ ุฎุทุฃ ูู ุงูุฅุฑุณุงู', 'error');
        } finally {
            // ุฅุนุงุฏุฉ ุชูููู ุงูุฒุฑ
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }
    }
}

// ุชููุฆุฉ ูุฏูุฑ ุงูููุงุฐุฌ
const formManager = new FormManager();

// ุชุณุฌูู ุงูููุงุฐุฌ ุงูุฑุฆูุณูุฉ
document.addEventListener('DOMContentLoaded', function() {
    formManager.registerForm('addUserForm', {
        resetOnSuccess: true,
        reloadOnSuccess: true
    });
    
    formManager.registerForm('addSupplierForm', {
        resetOnSuccess: true,
        reloadOnSuccess: true
    });
    
    formManager.registerForm('addProductForm', {
        resetOnSuccess: true,
        reloadOnSuccess: true
    });
    
    formManager.registerForm('addCategoryForm', {
        resetOnSuccess: true,
        reloadOnSuccess: true
    });
});

// ========== ูุธุงู ุฅุฏุงุฑุฉ ุงูุฌุฏุงูู ==========

class TableManager {
    constructor() {
        this.tables = new Map();
    }
    
    initializeTable(tableId, options = {}) {
        const table = document.getElementById(tableId);
        if (!table) return;
        
        this.tables.set(tableId, { table, options });
        this.addSorting(table);
        this.addPagination(table, options);
    }
    
    addSorting(table) {
        const headers = table.querySelectorAll('th[onclick*="sortTable"]');
        headers.forEach(header => {
            header.style.cursor = 'pointer';
            header.addEventListener('click', function() {
                const columnIndex = Array.from(this.parentNode.children).indexOf(this);
                sortTable(table.id, columnIndex);
            });
        });
    }
    
    addPagination(table, options) {
        if (!options.pagination) return;
        
        const itemsPerPage = options.itemsPerPage || 10;
        const tbody = table.querySelector('tbody');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        
        if (rows.length <= itemsPerPage) return;
        
        this.createPaginationControls(table, rows, itemsPerPage);
    }
    
    createPaginationControls(table, rows, itemsPerPage) {
        const totalPages = Math.ceil(rows.length / itemsPerPage);
        const controls = document.createElement('div');
        controls.className = 'flex justify-center items-center gap-2 mt-4';
        
        for (let i = 0; i < totalPages; i++) {
            const button = document.createElement('button');
            button.className = 'px-3 py-1 rounded border dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700';
            button.textContent = i + 1;
            button.addEventListener('click', () => this.showPage(table, rows, i, itemsPerPage));
            controls.appendChild(button);
        }
        
        table.parentNode.appendChild(controls);
        this.showPage(table, rows, 0, itemsPerPage);
    }
    
    showPage(table, rows, pageIndex, itemsPerPage) {
        const start = pageIndex * itemsPerPage;
        const end = start + itemsPerPage;
        
        // ุฅุฎูุงุก ุฌููุน ุงูุตููู
        rows.forEach(row => row.style.display = 'none');
        
        // ุฅุธูุงุฑ ุงูุตููู ูู ุงูุตูุญุฉ ุงููุญุฏุฏุฉ
        rows.slice(start, end).forEach(row => {
            row.style.display = '';
        });
    }
}

// ุชููุฆุฉ ูุฏูุฑ ุงูุฌุฏุงูู
const tableManager = new TableManager();

// ========== ูุธุงู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููุญุณู ==========

async function loadBackupHistory() {
    try {
        const response = await fetch('/api/backup/history');
        const result = await response.json();
        
        const backupHistory = document.getElementById('backupHistory');
        const noBackupsMessage = document.getElementById('noBackupsMessage');
        
        if (result.success && result.backups.length > 0) {
            backupHistory.innerHTML = result.backups.map(backup => `
                <tr class="border-t hover:bg-gray-50 dark:hover:bg-gray-700 dark:border-gray-600">
                    <td class="p-4">
                        <div class="font-medium text-gray-900 dark:text-white">${backup.filename}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">${backup.description || 'ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูููุธุงู'}</div>
                    </td>
                    <td class="p-4 text-sm text-gray-600 dark:text-gray-400">${backup.size}</td>
                    <td class="p-4 text-sm text-gray-600 dark:text-gray-400">${backup.created_at}</td>
                    <td class="p-4">
                        <div class="flex gap-2">
                            <button onclick="downloadBackup('${backup.filename}')" 
                                    class="btn-success text-sm flex items-center gap-1">
                                <i class="fas fa-download"></i>
                                ุชุญููู
                            </button>
                            <button onclick="restoreBackupFile('${backup.filename}')" 
                                    class="btn-warning text-sm flex items-center gap-1">
                                <i class="fas fa-upload"></i>
                                ุงุณุชุนุงุฏุฉ
                            </button>
                            <button onclick="deleteBackup('${backup.filename}')" 
                                    class="btn-danger text-sm flex items-center gap-1">
                                <i class="fas fa-trash"></i>
                                ุญุฐู
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            backupHistory.style.display = '';
            noBackupsMessage.classList.add('hidden');
        } else {
            backupHistory.style.display = 'none';
            noBackupsMessage.classList.remove('hidden');
        }
    } catch (error) {
        console.error('Error loading backup history:', error);
        showToast('ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุณุฌู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ', 'error');
    }
}

async function restoreBackupFile(filename) {
    if (!confirm(`ุชุญุฐูุฑ: ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ "${filename}" ุณุชุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงูุญุงููุฉ. ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ`)) {
        return;
    }
    
    try {
        showToast('ุฌุงุฑู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ...', 'info');
        
        const response = await fetch(`/api/backup/restore/${filename}`, {
            method: 'POST'
        });
        
        const result = await response.json();
        
        if (result.success) {
            showToast('ุชู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ', 'success');
            setTimeout(() => location.reload(), 2000);
        } else {
            showToast(result.error, 'error');
        }
    } catch (error) {
        console.error('Error restoring backup:', error);
        showToast('ุญุฏุซ ุฎุทุฃ ูู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
    }
}

// ========== ูุธุงู ุงูุงุณุชูุฑุงุฏ ูุงูุชุตุฏูุฑ ==========

async function exportSystemData() {
    try {
        showToast('ุฌุงุฑู ุชุตุฏูุฑ ุจูุงูุงุช ุงููุธุงู...', 'info');
        
        const response = await fetch('/api/system/export');
        if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `system_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showToast('ุชู ุชุตุฏูุฑ ุจูุงูุงุช ุงููุธุงู ุจูุฌุงุญ', 'success');
        } else {
            showToast('ุญุฏุซ ุฎุทุฃ ูู ุชุตุฏูุฑ ุงูุจูุงูุงุช', 'error');
        }
    } catch (error) {
        console.error('Error exporting data:', error);
        showToast('ุญุฏุซ ุฎุทุฃ ูู ุชุตุฏูุฑ ุงูุจูุงูุงุช', 'error');
    }
}

async function importSystemData() {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = '.json';
    
    fileInput.addEventListener('change', async function() {
        if (!this.files.length) return;
        
        const file = this.files[0];
        if (!confirm(`ุชุญุฐูุฑ: ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ุณูุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงูุญุงููุฉ. ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ`)) {
            return;
        }
        
        try {
            showToast('ุฌุงุฑู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช...', 'info');
            
            const formData = new FormData();
            formData.append('import_file', file);
            
            const response = await fetch('/api/system/import', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                showToast('ุชู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ุจูุฌุงุญ', 'success');
                setTimeout(() => location.reload(), 2000);
            } else {
                showToast(result.error, 'error');
            }
        } catch (error) {
            console.error('Error importing data:', error);
            showToast('ุญุฏุซ ุฎุทุฃ ูู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช', 'error');
        }
    });
    
    fileInput.click();
}

// ========== ูุธุงู ุงููุฑุงูุจุฉ ูุงูุตุญุฉ ==========

async function checkSystemHealth() {
    try {
        const response = await fetch('/api/system/health');
        const result = await response.json();
        
        if (result.healthy) {
            showToast('ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ', 'success');
        } else {
            showToast(`ูุดุงูู ูู ุงููุธุงู: ${result.issues.join(', ')}`, 'warning');
        }
    } catch (error) {
        console.error('Error checking system health:', error);
        showToast('ุญุฏุซ ุฎุทุฃ ูู ูุญุต ุตุญุฉ ุงููุธุงู', 'error');
    }
}

async function clearSystemCache() {
    try {
        const response = await fetch('/api/system/clear-cache', {
            method: 'POST'
        });
        
        const result = await response.json();
        
        if (result.success) {
            showToast('ุชู ูุณุญ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุจูุฌุงุญ', 'success');
        } else {
            showToast(result.error, 'error');
        }
    } catch (error) {
        console.error('Error clearing cache:', error);
        showToast('ุญุฏุซ ุฎุทุฃ ูู ูุณุญ ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ', 'error');
    }
}

// ========== ูุธุงู ุงูุฃูุงู ูุงููุฑุงูุจุฉ ==========

function monitorUserActivity() {
    // ูุฑุงูุจุฉ ุงููุดุงุท ุงููุดุจูู
    let inactivityTimer;
    
    function resetTimer() {
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(() => {
            showToast('ุชู ุงูุชุดุงู ุนุฏู ูุดุงุทุ ุณูุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุชููุงุฆูุงู ูุฑูุจุงู', 'warning');
        }, 10 * 60 * 1000); // 10 ุฏูุงุฆู
    }
    
    // ุฅุนุงุฏุฉ ุชุนููู ุงููุคูุช ุนูุฏ ุฃู ูุดุงุท
    ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
        document.addEventListener(event, resetTimer, false);
    });
    
    resetTimer();
}

// ุจุฏุก ูุฑุงูุจุฉ ุงููุดุงุท
document.addEventListener('DOMContentLoaded', monitorUserActivity);


function initializeSettings() {
  // ุฑุจุท ุฃููุงู ุงูููุชูู ูุน ุงูุญููู ุงููุตูุฉ
  const colorPicker = document.getElementById('colorPicker');
  const colorText = document.getElementById('colorText');
  const colorPreview = document.getElementById('colorPreview');
  
  if (colorPicker && colorText) {
    colorPicker.addEventListener('input', function() {
      colorText.value = this.value;
      if (colorPreview) {
        colorPreview.style.backgroundColor = this.value;
      }
    });
    
    colorText.addEventListener('input', function() {
      if (this.value.match(/^#[0-9A-F]{6}$/i)) {
        colorPicker.value = this.value;
        if (colorPreview) {
          colorPreview.style.backgroundColor = this.value;
        }
      }
    });
  }
  
  // ุชุญูู ูู ููุฉ ูููุฉ ุงููุฑูุฑ
  const passwordInput = document.getElementById('userPassword');
  if (passwordInput) {
    passwordInput.addEventListener('input', function() {
      const strengthContainer = this.parentNode.querySelector('.password-strength');
      const strengthBars = strengthContainer.querySelectorAll('div > div');
      const strengthText = document.getElementById('passwordStrengthText');
      
      if (this.value.length === 0) {
        strengthContainer.classList.add('hidden');
        return;
      }
      
      strengthContainer.classList.remove('hidden');
      
      let strength = 0;
      if (this.value.length >= 6) strength++;
      if (this.value.match(/[a-z]/) && this.value.match(/[A-Z]/)) strength++;
      if (this.value.match(/\d/) && this.value.match(/[^a-zA-Z\d]/)) strength++;
      
      strengthBars.forEach((bar, index) => {
        if (index < strength) {
          bar.className = `h-1 flex-1 rounded ${
            strength === 1 ? 'bg-red-500' :
            strength === 2 ? 'bg-yellow-500' :
            'bg-green-500'
          }`;
        } else {
          bar.className = 'h-1 flex-1 bg-gray-200 rounded';
        }
      });
      
      strengthText.textContent = 
        strength === 0 ? 'ุถุนููุฉ ุฌุฏุงู' :
        strength === 1 ? 'ุถุนููุฉ' :
        strength === 2 ? 'ุฌูุฏุฉ' :
        'ูููุฉ';
      
      strengthText.className = `text-xs mt-1 ${
        strength === 0 ? 'text-red-500' :
        strength === 1 ? 'text-red-500' :
        strength === 2 ? 'text-yellow-500' :
        'text-green-500'
      }`;
    });
  }
}
</script>

<style>
.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  backdrop-filter: blur(4px);
}

.modal.active {
  display: flex;
  align-items: center;
  justify-content: center;
  animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal-content {
  background: white;
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.2);
  max-width: 90%;
  max-height: 90%;
  overflow: auto;
  animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* ุชุฎุตูุตุงุช ูููุถุน ุงูุฏุงูู */
.dark .modal-content {
  background: #1f2937;
  color: #f9fafb;
}

.dark .table-header {
  background: #111827;
}

.dark .card {
  background: #1f2937;
  border-color: #374151;
}

.dark .form-input,
.dark .form-select {
  background: #374151;
  border-color: #4b5563;
  color: #f9fafb;
}

.dark .form-input:focus,
.dark .form-select:focus {
  border-color: #3b82f6;
  ring-color: #3b82f6;
}
</style>
{% endblock %}