{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto">
  <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
    <p class="text-gray-600 mt-2">Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© ÙˆØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</p>
  </div>

  <!-- ÙÙ„ØªØ±Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
  <div class="card p-6 mb-6">
    <div class="flex flex-wrap gap-4 items-center">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</label>
        <select id="timePeriod" class="select select-bordered">
          <option value="today">Ø§Ù„ÙŠÙˆÙ…</option>
          <option value="week">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
          <option value="month" selected>Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</option>
          <option value="quarter">Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹</option>
          <option value="year">Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©</option>
          <option value="custom">Ù…Ø®ØµØµ</option>
        </select>
      </div>
      <div id="customDateRange" class="hidden flex gap-2">
        <input type="date" id="startDate" class="input input-bordered">
        <input type="date" id="endDate" class="input input-bordered">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
        <select id="reportType" class="select select-bordered">
          <option value="overview">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</option>
          <option value="financial">Ù…Ø§Ù„ÙŠ</option>
          <option value="operations">ØªØ´ØºÙŠÙ„ÙŠ</option>
          <option value="performance">Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ù…Ø§Ù„</option>
          <option value="inventory">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</option>
        </select>
      </div>
      <button onclick="generateReport()" class="mt-6 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
        ğŸ”„ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
      </button>
    </div>
  </div>

  <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª -->
    <div class="card p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª</p>
          <p class="text-2xl font-bold text-gray-900 mt-2" id="totalOrders">{{ total_orders }}</p>
          <div class="flex items-center mt-2">
            <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full" id="paidPercentage">
              {% if total_orders > 0 %}
              {{ "%.1f"|format((paid_orders / total_orders * 100)) }}%
              {% else %}0%{% endif %} Ù…Ø¯ÙÙˆØ¹Ø©
            </span>
          </div>
        </div>
        <div class="p-3 bg-blue-100 rounded-full">
          <i class="fas fa-box text-blue-600 text-xl"></i>
        </div>
      </div>
      <div class="mt-4 text-xs text-gray-500">
        <div class="flex justify-between">
          <span>Ù…Ø¹Ù„Ù‚Ø©:</span>
          <span id="pendingOrders">{{ pending_orders }}</span>
        </div>
        <div class="flex justify-between">
          <span>Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°:</span>
          <span id="inProgressOrders">{{ in_progress_orders }}</span>
        </div>
      </div>
    </div>

    <!-- Ø§Ù„Ø¹Ù…Ø§Ù„ -->
    <div class="card p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ø§Ù„</p>
          <p class="text-2xl font-bold text-gray-900 mt-2" id="totalWorkers">{{ total_workers }}</p>
          <div class="flex items-center mt-2">
            <span class="text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded-full" id="totalSalaries">
              {{ "%.2f"|format(total_salaries) }} Ø¯Ø¬ Ù…Ø³ØªØ­Ù‚Ø©
            </span>
          </div>
        </div>
        <div class="p-3 bg-green-100 rounded-full">
          <i class="fas fa-users text-green-600 text-xl"></i>
        </div>
      </div>
      <div class="mt-4 text-xs text-gray-500">
        <div class="flex justify-between">
          <span>Ù†Ø´Ø·ÙŠÙ†:</span>
          <span id="activeWorkers">{{ active_workers }}</span>
        </div>
        <div class="flex justify-between">
          <span>Ù…ØªÙˆØ³Ø· Ø¥Ù†ØªØ§Ø¬ÙŠØ©:</span>
          <span id="avgEfficiency">{{ "%.1f"|format(average_worker_efficiency) }}%</span>
        </div>
      </div>
    </div>

    <!-- Ø§Ù„Ø¯ÙŠÙˆÙ† -->
    <div class="card p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©</p>
          <p class="text-2xl font-bold text-gray-900 mt-2" id="totalDebts">{{ total_debts }}</p>
          <div class="flex items-center mt-2">
            <span class="text-xs text-red-600 bg-red-100 px-2 py-1 rounded-full" id="debtAmount">
              {{ "%.2f"|format(total_debts_amount) }} Ø¯Ø¬
            </span>
          </div>
        </div>
        <div class="p-3 bg-red-100 rounded-full">
          <i class="fas fa-money-bill-wave text-red-600 text-xl"></i>
        </div>
      </div>
      <div class="mt-4 text-xs text-gray-500">
        <div class="flex justify-between">
          <span>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø¯Ø§Ø¯:</span>
          <span id="paymentRate">{{ "%.1f"|format(debt_payment_rate) }}%</span>
        </div>
        <div class="flex justify-between">
          <span>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯ÙŠÙ†:</span>
          <span id="avgDebt">{{ "%.2f"|format(average_debt) }} Ø¯Ø¬</span>
        </div>
      </div>
    </div>

    <!-- Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª -->
    <div class="card p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</p>
          <p class="text-2xl font-bold text-gray-900 mt-2" id="totalRevenue">{{ "%.2f"|format(total_orders_amount) }} Ø¯Ø¬</p>
          <div class="flex items-center mt-2">
            <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full" id="profitMargin">
              {{ "%.1f"|format(profit_margin) }}% Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­
            </span>
          </div>
        </div>
        <div class="p-3 bg-purple-100 rounded-full">
          <i class="fas fa-chart-line text-purple-600 text-xl"></i>
        </div>
      </div>
      <div class="mt-4 text-xs text-gray-500">
        <div class="flex justify-between">
          <span>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­:</span>
          <span id="netProfit" class="{% if net_profit >= 0 %}text-green-600{% else %}text-red-600{% endif %}">
            {{ "%.2f"|format(net_profit) }} Ø¯Ø¬
          </span>
        </div>
        <div class="flex justify-between">
          <span>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø·Ù„Ø¨ÙŠØ©:</span>
          <span id="avgOrder">{{ "%.2f"|format(average_order_value) }} Ø¯Ø¬</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    
    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ“¦ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h3>
      <div class="space-y-6">
        <!-- ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©</h4>
          <div class="space-y-3" id="orderStatusDistribution">
            {% for status in order_status_distribution %}
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">{{ status.name }}</span>
              <div class="flex items-center gap-3">
                <div class="w-32 bg-gray-200 rounded-full h-2">
                  <div class="h-2 rounded-full" style="width: {{ status.percentage }}%; background-color: {{ status.color }}"></div>
                </div>
                <span class="text-sm font-medium text-gray-900">{{ status.count }}</span>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>

        <!-- Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø±Ø¨Ø­ÙŠØ© -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø±Ø¨Ø­ÙŠØ©</h4>
          <div class="grid grid-cols-2 gap-4" id="revenueAnalysis">
            <div class="text-center p-4 bg-green-50 rounded-lg">
              <div class="text-2xl font-bold text-green-600">{{ "%.2f"|format(total_orders_amount) }} Ø¯Ø¬</div>
              <div class="text-sm text-green-700 mt-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª</div>
            </div>
            <div class="text-center p-4 bg-blue-50 rounded-lg">
              <div class="text-2xl font-bold text-blue-600" id="avgOrderValue">
                {{ "%.2f"|format(average_order_value) }} Ø¯Ø¬
              </div>
              <div class="text-sm text-blue-700 mt-1">Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</div>
            </div>
            <div class="text-center p-4 bg-purple-50 rounded-lg">
              <div class="text-2xl font-bold text-purple-600">{{ "%.2f"|format(net_profit) }} Ø¯Ø¬</div>
              <div class="text-sm text-purple-700 mt-1">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div>
            </div>
            <div class="text-center p-4 bg-orange-50 rounded-lg">
              <div class="text-2xl font-bold text-orange-600">{{ "%.1f"|format(profit_margin) }}%</div>
              <div class="text-sm text-orange-700 mt-1">Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­</div>
            </div>
          </div>
        </div>

        <!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø£Ø¯Ø§Ø¡Ù‹</h4>
          <div class="space-y-2" id="topProducts">
            {% for product in top_products %}
            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
              <span class="text-sm">{{ product.name }}</span>
              <div class="flex gap-4 text-xs">
                <span class="text-green-600">{{ product.orders }} Ø·Ù„Ø¨Ø§Øª</span>
                <span class="text-blue-600">{{ "%.2f"|format(product.revenue) }} Ø¯Ø¬</span>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ‘¥ ØªØ­Ù„ÙŠÙ„ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ù…Ø§Ù„</h3>
      <div class="space-y-6">
        <!-- Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª</h4>
          <div class="grid grid-cols-2 gap-4" id="salaryAnalysis">
            <div class="text-center p-4 bg-purple-50 rounded-lg">
              <div class="text-2xl font-bold text-purple-600">{{ "%.2f"|format(total_salaries) }} Ø¯Ø¬</div>
              <div class="text-sm text-purple-700 mt-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª</div>
            </div>
            <div class="text-center p-4 bg-orange-50 rounded-lg">
              <div class="text-2xl font-bold text-orange-600" id="avgSalary">
                {{ "%.2f"|format(average_salary) }} Ø¯Ø¬
              </div>
              <div class="text-sm text-orange-700 mt-1">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø§ØªØ¨</div>
            </div>
          </div>
        </div>

        <!-- Ø§Ù„ØºÙŠØ§Ø¨ ÙˆØ§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h4>
          <div class="space-y-3" id="attendanceAnalysis">
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨</span>
              <span class="font-semibold text-red-600" id="totalAbsences">{{ total_absences }} ÙŠÙˆÙ…</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ</span>
              <span class="font-semibold text-green-600" id="totalOutsideWork">{{ total_outside_work }} ÙŠÙˆÙ…</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-700">Ù…ØªÙˆØ³Ø· ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø¹Ù…Ø§Ù„</span>
              <span class="font-semibold text-blue-600">{{ "%.1f"|format(average_worker_efficiency) }}%</span>
            </div>
          </div>
        </div>

        <!-- Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ù…Ø§Ù„ Ø£Ø¯Ø§Ø¡Ù‹ -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ù…Ø§Ù„ Ø£Ø¯Ø§Ø¡Ù‹</h4>
          <div class="space-y-2" id="topWorkers">
            {% for worker in top_workers %}
            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
              <span class="text-sm">{{ worker.name }}</span>
              <div class="flex gap-4 text-xs">
                <span class="text-green-600">{{ worker.completed_orders }} Ù…ÙƒØªÙ…Ù„</span>
                <span class="text-blue-600">{{ "%.1f"|format(worker.efficiency) }}%</span>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    
    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ’° ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h3>
      <div class="space-y-6">
        <!-- ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ† -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</h4>
          <div class="space-y-3" id="debtDistribution">
            {% for debt_type in debt_distribution %}
            <div class="flex items-center justify-between p-3 rounded-lg" style="background-color: {{ debt_type.color }}20">
              <div class="flex items-center gap-3">
                <div class="w-3 h-3 rounded-full" style="background-color: {{ debt_type.color }}"></div>
                <span class="text-gray-700">{{ debt_type.name }}</span>
              </div>
              <div class="text-right">
                <div class="font-semibold" style="color: {{ debt_type.color }}">{{ debt_type.count }}</div>
                <div class="text-sm text-gray-500">{{ "%.2f"|format(debt_type.amount) }} Ø¯Ø¬</div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>

        <!-- Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø¯Ø§Ø¯ -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø¯Ø§Ø¯</h4>
          <div class="text-center p-6 bg-blue-50 rounded-lg">
            <div class="text-3xl font-bold text-blue-600" id="debtPaymentRate">
              {{ "%.1f"|format(debt_payment_rate) }}%
            </div>
            <div class="text-blue-700 mt-2">Ù…Ø¹Ø¯Ù„ Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ†</div>
          </div>
        </div>

        <!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠÙ† -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">Ø£ÙƒØ¨Ø± Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠÙ†</h4>
          <div class="space-y-2" id="topDebtors">
            {% for debtor in top_debtors %}
            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
              <span class="text-sm">{{ debtor.name }}</span>
              <div class="flex gap-4 text-xs">
                <span class="text-red-600">{{ "%.2f"|format(debtor.amount) }} Ø¯Ø¬</span>
                <span class="text-orange-600">{{ debtor.days }} ÙŠÙˆÙ…</span>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ›’ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
      <div class="space-y-6">
        <!-- Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h4>
          <div class="grid grid-cols-2 gap-4" id="expenseDistribution">
            <div class="text-center p-4 bg-blue-50 rounded-lg">
              <div class="text-2xl font-bold text-blue-600" id="totalExpenses">{{ total_expenses_count }}</div>
              <div class="text-sm text-blue-700 mt-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</div>
            </div>
            <div class="text-center p-4 bg-green-50 rounded-lg">
              <div class="text-2xl font-bold text-green-600" id="expensesAmount">{{ "%.2f"|format(total_expenses_amount) }} Ø¯Ø¬</div>
              <div class="text-sm text-green-700 mt-1">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</div>
            </div>
          </div>
        </div>

        <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</h4>
          <div class="space-y-3" id="paymentStatus">
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-700">Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©</span>
              <span class="font-semibold text-green-600" id="paidExpenses">{{ paid_expenses }}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-700">Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©</span>
              <span class="font-semibold text-red-600" id="unpaidExpenses">{{ unpaid_expenses }}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-700">Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</span>
              <span class="font-semibold text-blue-600" id="avgPurchasePrice">{{ "%.2f"|format(average_purchase_price) }} Ø¯Ø¬</span>
            </div>
          </div>
        </div>

        <!-- Ø£ÙØ¶Ù„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">Ø£ÙØ¶Ù„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h4>
          <div class="space-y-2" id="topSuppliers">
            {% for supplier in top_suppliers %}
            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
              <span class="text-sm">{{ supplier.name }}</span>
              <div class="flex gap-4 text-xs">
                <span class="text-green-600">{{ supplier.purchases }} Ø¹Ù…Ù„ÙŠØ©</span>
                <span class="text-blue-600">{{ "%.2f"|format(supplier.amount) }} Ø¯Ø¬</span>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø§Ù„ÙŠ -->
  <div class="card p-6 mb-8">
    <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ’¹ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø§Ù„ÙŠ</h3>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6" id="financialPerformance">
      <!-- Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠ -->
      <div class="text-center p-4 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl">
        <i class="fas fa-money-bill-wave text-3xl mb-3"></i>
        <div class="text-2xl font-bold" id="cashFlow">{{ "%.2f"|format(cash_flow) }} Ø¯Ø¬</div>
        <div class="text-sm opacity-90">Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠ</div>
      </div>

      <!-- Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª -->
      <div class="text-center p-4 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl">
        <i class="fas fa-chart-line text-3xl mb-3"></i>
        <div class="text-2xl font-bold" id="totalRevenueCard">{{ "%.2f"|format(total_orders_amount) }} Ø¯Ø¬</div>
        <div class="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
      </div>

      <!-- Ø§Ù„Ù†ÙÙ‚Ø§Øª -->
      <div class="text-center p-4 bg-gradient-to-br from-red-500 to-red-600 text-white rounded-xl">
        <i class="fas fa-credit-card text-3xl mb-3"></i>
        <div class="text-2xl font-bold" id="totalExpensesCard">{{ "%.2f"|format(total_expenses_amount) }} Ø¯Ø¬</div>
        <div class="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†ÙÙ‚Ø§Øª</div>
      </div>

      <!-- Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± -->
      <div class="text-center p-4 bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl">
        <i class="fas fa-chart-pie text-3xl mb-3"></i>
        <div class="text-2xl font-bold" id="roi">{{ "%.1f"|format(roi) }}%</div>
        <div class="text-sm opacity-90">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</div>
      </div>
    </div>

    <!-- ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ -->
    <div class="mt-6 p-4 bg-gray-50 rounded-lg text-center">
      <div class="text-lg font-semibold text-gray-700">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div>
      <div class="text-3xl font-bold {% if net_profit >= 0 %}text-green-600{% else %}text-red-600{% endif %}" id="netProfitCard">
        {{ "%.2f"|format(net_profit) }} Ø¯Ø¬
      </div>
      <div class="text-sm text-gray-500 mt-1">Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­: <span id="profitMarginCard">{{ "%.1f"|format(profit_margin) }}%</span></div>
    </div>
  </div>

  <!-- ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù†Ù…Ùˆ ÙˆØ§Ù„Ù…Ù‚Ø§Ø±Ù†Ø§Øª -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    
    <!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù…Ùˆ -->
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù…Ùˆ ÙˆØ§Ù„Ù…Ù‚Ø§Ø±Ù†Ø§Øª</h3>
      <div class="space-y-6">
        <div class="grid grid-cols-2 gap-4" id="growthMetrics">
          <div class="text-center p-4 border border-gray-200 rounded-lg">
            <div class="text-sm text-gray-600">Ù†Ù…Ùˆ Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª</div>
            <div class="text-2xl font-bold {% if order_growth >= 0 %}text-green-600{% else %}text-red-600{% endif %}" id="orderGrowth">
              {{ "%+.1f"|format(order_growth) }}%
            </div>
          </div>
          <div class="text-center p-4 border border-gray-200 rounded-lg">
            <div class="text-sm text-gray-600">Ù†Ù…Ùˆ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
            <div class="text-2xl font-bold {% if revenue_growth >= 0 %}text-green-600{% else %}text-red-600{% endif %}" id="revenueGrowth">
              {{ "%+.1f"|format(revenue_growth) }}%
            </div>
          </div>
          <div class="text-center p-4 border border-gray-200 rounded-lg">
            <div class="text-sm text-gray-600">Ù†Ù…Ùˆ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
            <div class="text-2xl font-bold {% if customer_growth >= 0 %}text-green-600{% else %}text-red-600{% endif %}" id="customerGrowth">
              {{ "%+.1f"|format(customer_growth) }}%
            </div>
          </div>
          <div class="text-center p-4 border border-gray-200 rounded-lg">
            <div class="text-sm text-gray-600">ÙƒÙØ§Ø¡Ø© Ø§Ù„ØªÙƒÙ„ÙØ©</div>
            <div class="text-2xl font-bold {% if cost_efficiency >= 0 %}text-green-600{% else %}text-red-600{% endif %}" id="costEfficiency">
              {{ "%+.1f"|format(cost_efficiency) }}%
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ¯ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (KPI)</h3>
      <div class="space-y-4" id="kpiMetrics">
        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
          <span class="text-gray-700">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
          <span class="font-semibold text-blue-600" id="avgCompletionTime">{{ average_completion_time }} ÙŠÙˆÙ…</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
          <span class="text-gray-700">Ù…Ø¹Ø¯Ù„ Ø±Ø¶Ø§ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
          <span class="font-semibold text-green-600" id="customerSatisfaction">{{ customer_satisfaction }}%</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
          <span class="text-gray-700">ÙƒÙØ§Ø¡Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ø¯</span>
          <span class="font-semibold text-purple-600" id="materialEfficiency">{{ material_efficiency }}%</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
          <span class="text-gray-700">Ù…Ø¹Ø¯Ù„ Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
          <span class="font-semibold text-orange-600" id="inventoryTurnover">{{ inventory_turnover }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
  <div class="card p-6 mb-8">
    <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ” Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
    
    <!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø­ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†ØªØ¬ -->
    <div class="mb-6">
      <h4 class="font-semibold text-gray-900 mb-4">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø­ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†ØªØ¬</h4>
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left" id="productProfitabilityTable">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2">Ø§Ù„Ù…Ù†ØªØ¬</th>
              <th class="px-4 py-2">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</th>
              <th class="px-4 py-2">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th>
              <th class="px-4 py-2">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ</th>
              <th class="px-4 py-2">Ø§Ù„Ø±Ø¨Ø­</th>
              <th class="px-4 py-2">Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­</th>
            </tr>
          </thead>
          <tbody>
            {% for product in product_profitability %}
            <tr class="border-b">
              <td class="px-4 py-2">{{ product.name }}</td>
              <td class="px-4 py-2">{{ product.orders }}</td>
              <td class="px-4 py-2">{{ "%.2f"|format(product.revenue) }} Ø¯Ø¬</td>
              <td class="px-4 py-2">{{ "%.2f"|format(product.cost) }} Ø¯Ø¬</td>
              <td class="px-4 py-2 font-semibold {% if product.profit >= 0 %}text-green-600{% else %}text-red-600{% endif %}">
                {{ "%.2f"|format(product.profit) }} Ø¯Ø¬
              </td>
              <td class="px-4 py-2 {% if product.margin >= 0 %}text-green-600{% else %}text-red-600{% endif %}">
                {{ "%.1f"|format(product.margin) }}%
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ -->
    <div>
      <h4 class="font-semibold text-gray-900 mb-4">ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ</h4>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="costAnalysis">
        {% for category in cost_analysis %}
        <div class="text-center p-4 border rounded-lg">
          <div class="text-lg font-bold">{{ category.name }}</div>
          <div class="text-2xl font-bold text-red-600 mt-2">{{ "%.2f"|format(category.amount) }} Ø¯Ø¬</div>
          <div class="text-sm text-gray-500 mt-1">{{ "%.1f"|format(category.percentage) }}% Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ</div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª ÙˆØ§Ù„ØªÙˆÙ‚Ø¹Ø§Øª -->
  <div class="card p-6">
    <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ”® Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª ÙˆØ§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="forecasts">
      <div class="text-center p-4 bg-blue-50 rounded-lg">
        <div class="text-2xl font-bold text-blue-600" id="revenueForecast">{{ "%.2f"|format(revenue_forecast) }} Ø¯Ø¬</div>
        <div class="text-sm text-blue-700 mt-1">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…</div>
      </div>
      <div class="text-center p-4 bg-green-50 rounded-lg">
        <div class="text-2xl font-bold text-green-600" id="orderForecast">{{ order_forecast }}</div>
        <div class="text-sm text-green-700 mt-1">Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…</div>
      </div>
      <div class="text-center p-4 bg-purple-50 rounded-lg">
        <div class="text-2xl font-bold text-purple-600" id="expenseForecast">{{ "%.2f"|format(expense_forecast) }} Ø¯Ø¬</div>
        <div class="text-sm text-purple-700 mt-1">Ø§Ù„Ù†ÙÙ‚Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…</div>
      </div>
    </div>
  </div>

  <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ -->
  <div class="card p-6 mt-8 bg-gradient-to-r from-blue-500 to-purple-600 text-white">
    <h3 class="text-xl font-bold mb-4">ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø´Ø§Ù…Ù„</h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
      <div>
        <div class="text-2xl font-bold">{{ total_orders }}</div>
        <div class="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª</div>
      </div>
      <div>
        <div class="text-2xl font-bold">{{ "%.1f"|format(profit_margin) }}%</div>
        <div class="text-sm opacity-90">Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­</div>
      </div>
      <div>
        <div class="text-2xl font-bold">{{ "%.1f"|format(average_worker_efficiency) }}%</div>
        <div class="text-sm opacity-90">ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø¹Ù…Ø§Ù„</div>
      </div>
      <div>
        <div class="text-2xl font-bold">{{ "%.1f"|format(customer_satisfaction) }}%</div>
        <div class="text-sm opacity-90">Ø±Ø¶Ø§ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
      </div>
    </div>
  </div>
</div>

<!-- Ø³ØªØ§ÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠ -->
<style>
.card {
  transition: all 0.3s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
}

.progress-bar {
  transition: width 0.5s ease-in-out;
}

.bg-gradient-to-br {
  background-size: 200% 200%;
  animation: gradientShift 3s ease infinite;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* ØªØ®ØµÙŠØµ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
table {
  border-collapse: collapse;
  width: 100%;
}

th, td {
  border: 1px solid #e5e7eb;
  padding: 8px 12px;
  text-align: right;
}

th {
  background-color: #f9fafb;
  font-weight: 600;
}

/* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØµÙ…ÙŠÙ… Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 768px) {
  .grid-cols-4 {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .grid-cols-2 {
    grid-template-columns: 1fr;
  }
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© */
.stat-card {
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s;
}

.stat-card:hover::before {
  left: 100%;
}

/* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}
</style>

<script>
// ÙƒÙˆØ¯ JavaScript Ù…Ø­Ø³Ù†
document.addEventListener('DOMContentLoaded', function() {
  initializeStatsPage();
});

function initializeStatsPage() {
  // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØµØµ
  const timePeriodSelect = document.getElementById('timePeriod');
  const customDateRange = document.getElementById('customDateRange');
  
  timePeriodSelect.addEventListener('change', function() {
    if (this.value === 'custom') {
      customDateRange.classList.remove('hidden');
      initializeCustomDates();
    } else {
      customDateRange.classList.add('hidden');
    }
  });

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  setInterval(updateLiveStats, 30000); // ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
  
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
  loadInitialData();
}

function initializeCustomDates() {
  const today = new Date().toISOString().split('T')[0];
  const lastMonth = new Date();
  lastMonth.setMonth(lastMonth.getMonth() - 1);
  
  document.getElementById('endDate').value = today;
  document.getElementById('startDate').value = lastMonth.toISOString().split('T')[0];
}

function generateReport() {
  const timePeriod = document.getElementById('timePeriod').value;
  const reportType = document.getElementById('reportType').value;
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;
  
  showLoading();
  
  const params = new URLSearchParams({
    period: timePeriod,
    type: reportType
  });
  
  if (timePeriod === 'custom' && startDate && endDate) {
    params.append('start_date', startDate);
    params.append('end_date', endDate);
  }
  
  fetch(`/api/stats/generate?${params.toString()}`)
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        updateStatsDisplay(data.stats);
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
      } else {
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±', 'error');
      }
    })
    .catch(error => {
      console.error('Error generating report:', error);
      showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
    })
    .finally(() => {
      hideLoading();
    });
}

function updateLiveStats() {
  fetch('/api/stats/live')
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        updateStatsDisplay(data.stats, true);
      }
    })
    .catch(error => console.error('Error updating live stats:', error));
}

function updateStatsDisplay(stats, isLiveUpdate = false) {
  if (!stats) return;

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  if (stats.total_orders !== undefined) {
    document.getElementById('totalOrders').textContent = stats.total_orders;
  }
  if (stats.paid_orders !== undefined && stats.total_orders !== undefined) {
    const percentage = stats.total_orders > 0 ? (stats.paid_orders / stats.total_orders * 100) : 0;
    document.getElementById('paidPercentage').textContent = `${percentage.toFixed(1)}% Ù…Ø¯ÙÙˆØ¹Ø©`;
  }
  // ... ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©

  if (isLiveUpdate) {
    highlightChanges();
  }
}

function highlightChanges() {
  const elements = document.querySelectorAll('[id]');
  elements.forEach(element => {
    element.classList.add('highlight-change');
    setTimeout(() => {
      element.classList.remove('highlight-change');
    }, 2000);
  });
}

function loadInitialData() {
  // ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
  console.log('ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©...');
}

function showLoading() {
  // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
  const loadingElement = document.createElement('div');
  loadingElement.id = 'loadingOverlay';
  loadingElement.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
  loadingElement.innerHTML = `
    <div class="bg-white p-6 rounded-lg shadow-xl">
      <div class="flex items-center gap-3">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <span>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</span>
      </div>
    </div>
  `;
  document.body.appendChild(loadingElement);
}

function hideLoading() {
  const loadingElement = document.getElementById('loadingOverlay');
  if (loadingElement) {
    loadingElement.remove();
  }
}

function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
  
  notification.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300`;
  notification.textContent = message;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.classList.remove('translate-x-full');
  }, 100);
  
  setTimeout(() => {
    notification.classList.add('translate-x-full');
    setTimeout(() => {
      notification.remove();
    }, 300);
  }, 3000);
}

function exportReport(format) {
  const timePeriod = document.getElementById('timePeriod').value;
  const reportType = document.getElementById('reportType').value;
  
  showLoading();
  
  fetch(`/api/stats/export?format=${format}&period=${timePeriod}&type=${reportType}`)
    .then(response => {
      if (!response.ok) throw new Error('Network error');
      return response.blob();
    })
    .then(blob => {
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Ø§Ù„ØªÙ‚Ø±ÙŠØ±_${new Date().toISOString().split('T')[0]}.${format}`;
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
      document.body.removeChild(a);
      showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
    })
    .catch(error => {
      console.error('Export error:', error);
      showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±', 'error');
    })
    .finally(() => {
      hideLoading();
    });
}

function printReport() {
  window.print();
}

// Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª CSS Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
const style = document.createElement('style');
style.textContent = `
  .highlight-change {
    animation: highlight 2s ease;
  }
  
  @keyframes highlight {
    0% { background-color: transparent; }
    50% { background-color: #fef3c7; }
    100% { background-color: transparent; }
  }
  
  @media print {
    .no-print {
      display: none !important;
    }
    
    .card {
      break-inside: avoid;
    }
    
    body {
      font-size: 12pt;
    }
  }
`;
document.head.appendChild(style);
</script>

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
<div class="fixed bottom-6 left-6 flex gap-3 no-print">
  <button onclick="printReport()" class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-lg shadow-lg hover:bg-gray-50 transition-colors flex items-center gap-2">
    <i class="fas fa-print"></i>
    Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
  </button>
  <div class="relative group">
    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
      <i class="fas fa-download"></i>
      ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    </button>
    <div class="absolute bottom-full left-0 mb-2 hidden group-hover:block">
      <div class="bg-white border border-gray-200 rounded-lg shadow-lg p-2 min-w-40">
        <button onclick="exportReport('pdf')" class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded flex items-center gap-2">
          <i class="fas fa-file-pdf text-red-500"></i>
          PDF
        </button>
        <button onclick="exportReport('excel')" class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded flex items-center gap-2">
          <i class="fas fa-file-excel text-green-500"></i>
          Excel
        </button>
        <button onclick="exportReport('csv')" class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded flex items-center gap-2">
          <i class="fas fa-file-csv text-blue-500"></i>
          CSV
        </button>
      </div>
    </div>
  </div>
  <button onclick="updateLiveStats()" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-green-700 transition-colors flex items-center gap-2">
    <i class="fas fa-sync-alt"></i>
    ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†
  </button>
</div>

<!-- ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© -->
<div class="mt-8 text-center text-gray-500 text-sm no-print">
  <p>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdateTime">{{ now.strftime('%Y-%m-%d %H:%M') }}</span></p>
  <p class="mt-2">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù‚Ø¯Ù…Ø© Ø­Ø³Ø¨ Ø¢Ø®Ø± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
</div>
{% endblock %}